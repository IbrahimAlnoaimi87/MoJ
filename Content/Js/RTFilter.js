/*!
 ~/Rules/Script/Plugins.js
*/
function comparePluginSetting(n,t){var q=checkExists(n)?n:"False",r=checkExists(t)?t:"False";return q===r}var cachedPlugins=[],numberOfItemsToCache=20;function cachedPluginIndex(n){for(var t=0;t<cachedPlugins.length;t++)if(cachedPlugins[t].equals(n,!1))return t;return-1}function getCachedPluginResult(n){return cachedPlugins[n].cachedResult}function addPlugInToCache(n){var t=cachedPluginIndex(n);t===-1&&(cachedPlugins.length>=numberOfItemsToCache&&cachedPlugins.splice(0,1),cachedPlugins.push(n))}function GetContextTreeTransformer(){var n=new XslTransform;return n.importStylesheet(applicationRoot+"Rules/XSLT/ContextTree.xslt"),n.addParameter("Fields",ContextTree_TreeExtraHeading_Fields),n.addParameter("Controls",ContextTree_TreeExtraHeading_Controls),n.addParameter("Expressions",ContextTree_TreeExtraHeading_Expressions),n.addParameter("Methods",ContextTree_TreeExtraHeading_Methods),n.addParameter("Parameters",ContextTree_TreeExtraHeading_Parameters),n.addParameter("InputProperties",ContextTree_TreeExtraHeading_InputProperties),n.addParameter("ReturnProperties",ContextTree_TreeExtraHeading_ReturnProperties),n.addParameter("NoItemsToDisplay",ContextTree_NoItemsToDisplay),n.addParameter("Display",ContextTree_ListDisplay),n.addParameter("Edit",ContextTree_ListEdit),n.addParameter("Header",ContextTree_ListHeader),n.addParameter("Footer",ContextTree_ListFooter),n.addParameter("ControlMethodProperties",ContextTree_TreeExtraHeading_ControlMethodProperties),n.addParameter("ControlMethodResult",ContextTree_TreeExtraHeading_ControlMethodResult),n.addParameter("TitleSystemName",ContextTree_TitleSystemNameLabel),n.addParameter("TitleDescription",ContextTree_TitleDescriptionLabel),n}function ObjectFieldsContextPlugIn(){this.dataType="context"}ObjectFieldsContextPlugIn.prototype={filterXmlUsingSettings:function(n){if(this.Settings.includeTextFields||this.Settings.includeMemoFields||this.Settings.includeFileFields||this.Settings.includeImageFields||this.Settings.includeNumberFields||this.Settings.includeMultiValueFields||this.Settings.includeDecimalFields||this.Settings.includeXmlFields||this.Settings.includeHyperlinkFields||this.Settings.includeYesNoFields||this.Settings.includeAutonumberFields||this.Settings.includeAutoGuidFields||this.Settings.includeGuidFields){var t="";this.Settings.includeTextFields&&this.Settings.includeTextFields!=="False"||(t+="@SubType = 'Text'");this.Settings.includeMemoFields&&this.Settings.includeMemoFields!=="False"||(t.length>0&&(t+=" or "),t+="@SubType = 'Memo'");this.Settings.includeDecimalFields&&this.Settings.includeDecimalFields!=="False"||(t.length>0&&(t+=" or "),t+="@SubType = 'Decimal'");this.Settings.includeFileFields&&this.Settings.includeFileFields!=="False"||(t.length>0&&(t+=" or "),t+="@SubType = 'File'");this.Settings.includeImageFields&&this.Settings.includeImageFields!=="False"||(t.length>0&&(t+=" or "),t+="@SubType = 'Image'");this.Settings.includeNumberFields&&this.Settings.includeNumberFields!=="False"||(t.length>0&&(t+=" or "),t+="@SubType = 'Number'");this.Settings.includeMultiValueFields&&this.Settings.includeMultiValueFields!=="False"||(t.length>0&&(t+=" or "),t+="@SubType = 'MultiValue'");this.Settings.includeXmlFields&&this.Settings.includeXmlFields!=="False"||(t.length>0&&(t+=" or "),t+="@SubType = 'Xml'");this.Settings.includeHyperlinkFields&&this.Settings.includeHyperlinkFields!=="False"||(t.length>0&&(t+=" or "),t+="@SubType = 'HyperLink' or @SubType = 'Hyperlink'");this.Settings.includeAutonumberFields&&this.Settings.includeAutonumberFields!=="False"||(t.length>0&&(t+=" or "),t+="@SubType = 'Autonumber' or @SubType = 'AutoNumber'");this.Settings.includeAutoGuidFields&&this.Settings.includeAutoGuidFields!=="False"||(t.length>0&&(t+=" or "),t+="@SubType = 'AutoGuid'");this.Settings.includeGuidFields&&this.Settings.includeGuidFields!=="False"||(t.length>0&&(t+=" or "),t+="@SubType = 'Guid'");this.Settings.includeYesNoFields&&this.Settings.includeYesNoFields!=="False"||(t.length>0&&(t+=" or "),t+="@SubType = 'YesNo'");this.Settings.includeDateTimeFields&&this.Settings.includeDateTimeFields!=="False"||(t.length>0&&(t+=" or "),t+="@SubType = 'DateTime'");t.length>0&&removeXmlNodes(n,"//Item["+t+"]")}},equals:function(n){return(this.resultName===n.resultName)?comparePluginSetting(this.Settings.includeTextFields,n.Settings.includeTextFields)?comparePluginSetting(this.Settings.includeMemoFields,n.Settings.includeMemoFields)?comparePluginSetting(this.Settings.includeNumberFields,n.Settings.includeNumberFields)?comparePluginSetting(this.Settings.includeDecimalFields,n.Settings.includeDecimalFields)?comparePluginSetting(this.Settings.includeFileFields,n.Settings.includeFileFields)?comparePluginSetting(this.Settings.includeImageFields,n.Settings.includeImageFields)?comparePluginSetting(this.Settings.includeHyperlinkFields,n.Settings.includeHyperlinkFields)?comparePluginSetting(this.Settings.includeXmlFields,n.Settings.includeXmlFields)?comparePluginSetting(this.Settings.includeMultivalueFields,n.Settings.includeMultivalueFields)?comparePluginSetting(this.Settings.includeAutonumberFields,n.Settings.includeAutonumberFields)?comparePluginSetting(this.Settings.includeAutoGuidFields,n.Settings.includeAutoGuidFields)?comparePluginSetting(this.Settings.includeGuidFields,n.Settings.includeGuidFields)?comparePluginSetting(this.Settings.skipViewRightsCheck,n.Settings.skipViewRightsCheck)?!0:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1}};function ControlsContextPlugIn(){this.dataType="context"}ControlsContextPlugIn.prototype={filterXmlUsingSettings:function(n){if(this.Settings.includeInputControls||this.Settings.includeListingControls||this.Settings.includeDisplayControls||this.Settings.includeActionControls||this.Settings.includeLayoutControls||this.Settings.includeCanvasControls||this.Settings.includeExecutionControls){var t="",q="";if(this.Settings.includeInputControls&&this.Settings.includeInputControls!=="False"||(t+="text() = 'Input' or text() = 0"),this.Settings.includeListingControls&&this.Settings.includeListingControls!=="False"||(t.length>0&&(t+=" or "),t+="text() = 'Listing' or text() = 1"),this.Settings.includeActionControls&&this.Settings.includeActionControls!=="False"||(t.length>0&&(t+=" or "),t+="text() = 'Action' or text() = 3"),this.Settings.includeDisplayControls&&this.Settings.includeDisplayControls!=="False"||(t.length>0&&(t+=" or "),t+="text() = 'Display' or text() = 2"),this.Settings.includeLayoutControls&&this.Settings.includeLayoutControls!=="False"||(t.length>0&&(t+=" or "),t+="text() = 'Layout' or text() = 4"),this.Settings.includeCanvasControls&&this.Settings.includeCanvasControls!=="False"?(q.length>0&&(q+=" or "),q+="((Category = 'Canvas' or Category = 6) and (@SubType!='Column') and (@SubType!='Panel')",q+=this.Settings.includeAreaItemProperties&&this.Settings.includeAreaItemProperties!=="False"?" and (@SubType!='AreaItem'))":" or (@SubType='AreaItem'))"):(q.length>0&&(q+=" or "),q+="((Category = 'Canvas' or Category = 6)",q+=this.Settings.includeAreaItemProperties&&this.Settings.includeAreaItemProperties!=="False"?" and (@SubType!='AreaItem'))":" or (@SubType='AreaItem'))"),this.Settings.filterSubTypes&&this.Settings.filterSubTypes!=""){for(var f=this.Settings.filterSubTypes.split("|"),u="",r=0;r<f.length;r++)r>0&&(u+=" and "),u+="@SubType != '"+f[r]+"'";removeXmlNodes(n,"//Item[(@ItemType = 'Control') and ({0})]".format(u))}this.Settings.includeExecutionControls&&this.Settings.includeExecutionControls!=="False"||(t.length>0&&(t+=" or "),t+="text() = 'Execution' or text() = 7");t.length>0&&removeXmlNodes(n,"//Item[Category["+t+"] and @ItemType = 'Control']");q.length>0&&removeXmlNodes(n,"//Item["+q+" and @ItemType = 'Control']");removeXmlNodes(n,"//Item[@ItemType='Control' and (@SubType='ListTable' or @SubType='ToolbarTable')]")}},equals:function(n){return(this.resultName===n.resultName)?comparePluginSetting(this.Settings.viewID,n.Settings.viewID)?comparePluginSetting(this.Settings.includeInputControls,n.Settings.includeInputControls)?comparePluginSetting(this.Settings.includeListingControls,n.Settings.includeListingControls)?comparePluginSetting(this.Settings.includeDisplayControls,n.Settings.includeDisplayControls)?comparePluginSetting(this.Settings.includeActionControls,n.Settings.includeActionControls)?comparePluginSetting(this.Settings.includeLayoutControls,n.Settings.includeLayoutControls)?comparePluginSetting(this.Settings.includeExecutionControls,n.Settings.includeExecutionControls)?comparePluginSetting(this.Settings.includeExpressions,n.Settings.includeExpressions)?comparePluginSetting(this.Settings.includeCanvasControls,n.Settings.includeCanvasControls)?comparePluginSetting(this.Settings.includeControlMethods,n.Settings.includeControlMethods)?comparePluginSetting(this.Settings.includeControlMethodParameters,n.Settings.includeControlMethodParameters)?comparePluginSetting(this.Settings.includeAreaItemProperties,n.Settings.includeAreaItemProperties)?comparePluginSetting(this.Settings.skipViewRightsCheck,n.Settings.skipViewRightsCheck)?!0:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1}};function ViewContextPlugIn(n){this.unitTestReturnMethod=n;this.dataType="context"}ViewContextPlugIn.prototype={initialize:function(){var _this=this;this.initializeSubObjects();var k=cachedPluginIndex(this);if(k!==-1){this.dataReturned(getCachedPluginResult(k));return}if(this.Settings.isCurrent==="True"){if(!SourceCode.Forms.Designers.View.ViewDesigner._getViewMethods){popupManager.showWarning("Invalid Configuration: Cannot find Current View");return}if(this.Settings.includeObjectDetails&&this.Settings.includeObjectDetails!=="False"||this.Settings.includeFields&&this.Settings.includeFields!=="False"||this.Settings.includeControls&&this.Settings.includeControls!=="False"||this.Settings.includeExpressions&&this.Settings.includeExpressions!=="False"||this.Settings.includeMethodParameters&&this.Settings.includeMethodParameters!=="False"||this.Settings.includeRequiredProperties&&this.Settings.includeRequiredProperties!=="False"||this.Settings.includeOptionalProperties&&this.Settings.includeOptionalProperties!=="False"||this.Settings.includeResultProperties&&this.Settings.includeResultProperties!=="False"||!(this.Settings.includeMethods&&this.Settings.includeMethods==="True"||this.Settings.includeViewMethods&&this.Settings.includeViewMethods==="True")){var d;checkExists(SourceCode.Forms.Designers.Rule.tmpContextDefinition)&&SourceCode.Forms.Designers.Rule.tmpContextDefinition.selectSingleNode("//Views/View")!==null&&(d=SourceCode.Forms.Designers.Rule.tmpContextDefinition);var viewUtilsXml=parseXML(SourceCode.Forms.Designers.View.ViewDesigner._getViewObjects(this.Settings.includeControlProperties==="True"||this.Settings.includeControlFields==="True",d));if(this.Settings.includeParameters&&this.Settings.includeParameters!=="False"){if(_this.Settings.includeViewParameterEvents&&_this.Settings.includeViewParameterEvents.toUpperCase()==="TRUE")for(var at=parseXML(jQuery.ajax({data:{method:"getItems",resultTypes:"ViewParameterEvents"},url:applicationRoot+"Utilities/AJAXcall.ashx",type:"POST",async:!1,error:function(n,t){popupManager.showError(n+", "+t)},dataType:"text"}).responseText),g=viewUtilsXml.selectNodes("Items/Item/Items/Item[@ItemType='ViewParameter']"),vt=g.length,y=0;y<vt;y++){var yt=at.selectSingleNode("Items").cloneNode(!0),pt=g[y];pt.appendChild(yt)}}else removeXmlNodes(viewUtilsXml,"/Items/Item/Items/Item[@ItemType='ViewParameter']");if(this.Settings.includeFields&&this.Settings.includeFields!=="False"||removeXmlNodes(viewUtilsXml,"/Items/Item/Items/Item[@ItemType='FieldContext']"),this.Settings.includeControls&&this.Settings.includeControls!=="False"||removeXmlNodes(viewUtilsXml,"/Items/Item/Items/Item[@ItemType='Control']"),this.Settings.includeControlProperties&&this.Settings.includeControlProperties!=="False"){if(checkExists(_this.Settings.includeControlProperties)&&_this.Settings.includeControlProperties.toLowerCase()==="true"){var n=null;if(checkExistsNotEmpty(_this.Settings.viewControlID)&&(n=_this.Settings.viewControlID),checkExistsNotEmpty(_this.Settings.formControlID)&&(n=_this.Settings.formControlID),n!==null)for(var o=viewUtilsXml.selectNodes("//Items/Item[(@ItemType='Control') and (@Guid='{0}')]".format(n)),nt=o.length,q=0;q<nt;q++){var r=o[q],tt=r.getAttribute("Guid"),qt=r.getAttribute("SubType");SourceCode.Forms.Designers.Common.getControlTypeProperties({node:r,controlID:tt,controlType:qt})}}}else removeXmlNodes(viewUtilsXml,"/Items/Item/Items/Item[@ItemType='Control']/Items/Item[@ItemType='ControlProperty']");if(this.Settings.includeControlFields&&this.Settings.includeControlFields!=="False"){if((!this.Settings.includeControlProperties||this.Settings.includeControlProperties==="False")&&checkExists(_this.Settings.includeControlFields)&&_this.Settings.includeControlFields.toLowerCase()==="true"){var n=null;if(checkExistsNotEmpty(_this.Settings.viewControlID)&&(n=_this.Settings.viewControlID),checkExistsNotEmpty(_this.Settings.formControlID)&&(n=_this.Settings.formControlID),n!==null)for(var o=viewUtilsXml.selectNodes("//Items/Item[(@ItemType='Control') and (@Guid='{0}')]".format(n)),nt=o.length,q=0;q<nt;q++){var r=o[q],tt=r.getAttribute("Guid"),qt=r.getAttribute("SubType");SourceCode.Forms.Designers.Common.getControlTypeProperties({node:r,controlID:tt,controlType:qt})}}}else removeXmlNodes(viewUtilsXml,"/Items/Item/Items/Item[@ItemType='Control']/Items/Item[@ItemType='ControlField']");if(this.Settings.includeFields&&this.Settings.includeFields!=="False"&&this.Settings.includeControls){var rt="/Items/Item/Items/Item[@ItemType='Control']";this.Settings.viewControlID&&(rt+="[ContextID='"+this.Settings.viewControlID+"']");for(var p=viewUtilsXml.selectNodes(rt),s=0;s<p.length;s++){var h=p[s].getAttribute("Guid"),ut=SourceCode.Forms.Designers.View.controlPropertiesXML.selectSingleNode("Control[@ID='{0}']".format(h)).getAttribute("FieldID");if(ut){var t=viewUtilsXml.selectSingleNode("/Items/Item/Items/Item[@ItemType='FieldContext']/Items/Item[@Guid='{0}']".format(ut));if(t){var ft=t.selectSingleNode("ObjectGuid").text+"_"+t.selectSingleNode("PropertyName").text;t.getAttribute("FieldControl")!==null&&(h=t.getAttribute("FieldControl")+","+h);t.setAttribute("FieldControl",h);t.setAttribute("FieldObject",ft);p[s].setAttribute("ControlField",ft)}}}}if(this.Settings.includeExpressions&&this.Settings.includeExpressions!=="False"||removeXmlNodes(viewUtilsXml,"/Items/Item/Items/Item[@ItemType='Expression']"),this.Settings.includeObjectDetails&&this.Settings.includeObjectDetails==="True"){var et=this.objectPlugIn.setResultTypes(),ot=SourceCode.Forms.Designers.View.ViewDesigner._getViewMethods(),localMethodsIncluded=!1,c;if(checkExistsNotEmpty(ot)){var wt=parseXML(ot);if(c=wt.selectSingleNode("Items"),this.Settings.includeViewMethods&&this.Settings.includeViewMethods==="True"){var st="";this.Settings.method&&(st="[Name='{0}']".format(this.Settings.method));for(var ht=c.selectNodes("Item[@ItemType='ViewMethod']{0}".format(st)),bt=viewUtilsXml.selectSingleNode("Items/Item[@ItemType='View']/Items"),w=0,kt=ht.length;w<kt;w++)bt.appendChild(ht[w].cloneNode(!0));localMethodsIncluded=!0}}if(!this.Settings.viewControlID&&checkExists(c)){var b=c.selectSingleNode("Item[@ItemType='Object']").getAttribute("Guid");$chk(b)?jQuery.ajax({data:{method:"getItems",targetType:"Object",targetID:b,resultTypes:et},global:!1,url:applicationRoot+"Utilities/AJAXcall.ashx",dataType:"text",type:"POST",async:!0,error:function(n,t){popupManager.showError(n+", "+t)},success:function(httpResponse){if(SourceCode.Forms.ExceptionHandler.isException(httpResponse)){SourceCode.Forms.ExceptionHandler.handleException(httpResponse);return}with(_this){var objectClonedNode=parseXML(httpResponse).selectSingleNode("/Items/Item[@ItemType='Object']").cloneNode(!0);viewUtilsXml.selectSingleNode("/Items/Item[@ItemType='View']/Items").appendChild(objectClonedNode);var contextTypeEl=viewUtilsXml.createElement("ContextType");if(contextTypeEl.appendChild(viewUtilsXml.createTextNode("Primary")),viewUtilsXml.selectSingleNode("/Items/Item[@ItemType='View']/Items/Item[@ItemType = 'Object']").appendChild(contextTypeEl),viewUtilsXml.selectSingleNode("/Items/Item[@ItemType='View']/Items/Item[@ItemType = 'Object']").appendChild(viewUtilsXml.selectSingleNode("/Items/Item[@ItemType='View']/Items/Item[@ItemType = 'Object']/Items")),!localMethodsIncluded&&_this.Settings.includeViewMethods&&_this.Settings.includeViewMethods==="True"){var viewMethods=parseXML(SourceCode.Forms.Designers.View.ViewDesigner._getViewMethods()),nodeToAppendTo=viewUtilsXml.selectSingleNode("/Items/Item[@ItemType='View']/Items");cloneNodes(nodeToAppendTo,viewMethods,"//Item[@ItemType='ViewMethod']")}_this.dataReturned(viewUtilsXml.xml)}}}):_this.dataReturned(viewUtilsXml.xml)}else if(this.Settings.viewControlID){var l=parseXML(SourceCode.Forms.Designers.View.ViewDesigner._getViewListControls()).selectSingleNode("/Items/Item[@ItemType='Control' and @Guid='"+this.Settings.viewControlID+"']"),a=null;if(checkExists(l)){a=l.selectSingleNode("AssociationSO");var ct=l.selectSingleNode("IsComposite");if(checkExists(ct)&&ct.text.toUpperCase()==="TRUE"&&checkExists(this.Settings.compositeObjToUse)&&this.Settings.compositeObjToUse.toUpperCase()==="DISPLAY"){var lt=l.selectSingleNode("DisplaySO");checkExistsNotEmpty(lt)&&(a=lt)}}if(!checkExists(a)){this.dataReturned("<Items/>");return}var b=a.text;jQuery.ajax({data:{method:"getItems",targetType:"Object",targetID:b,resultTypes:et},url:applicationRoot+"Utilities/AJAXcall.ashx",dataType:"text",type:"POST",async:!0,error:function(n,t){popupManager.showError(n+", "+t)},global:!1,success:function(n){if(SourceCode.Forms.ExceptionHandler.isException(n)){SourceCode.Forms.ExceptionHandler.handleException(n);return}viewUtilsXml=_this.updateViewXmlWithGetItemsResponse(n,_this.Settings.viewControlID,viewUtilsXml);_this.dataReturned(viewUtilsXml.xml)}})}}else if(this.Settings.includeControlTypeEvents&&this.Settings.includeControlTypeEvents==="True")jQuery.ajax({data:{method:"getItems",resultTypes:"ControlTypeEvents"},url:applicationRoot+"Utilities/AJAXcall.ashx",type:"POST",async:!0,error:function(n,t){popupManager.showError(n+", "+t)},dataType:"text",global:!1,success:function(httpResponse){if(SourceCode.Forms.ExceptionHandler.isException(httpResponse)){SourceCode.Forms.ExceptionHandler.handleException(httpResponse);return}with(_this,viewUtilsXml){for(var controlsXml=parseXML(httpResponse),controls=viewUtilsXml.selectNodes("/Items/Item/Items/Item[@ItemType='Control']"),m=0;m<controls.length;m++){var controlItemsNode=controlsXml.selectSingleNode("/Items/Item[Name='"+controls[m].getAttribute("SubType")+"']/Items");controlItemsNode&&controls[m].appendChild(controlItemsNode.cloneNode(!0))}_this.dataReturned(viewUtilsXml.xml)}}});else if(checkExists(this.Settings.includeControlMethods)&&this.Settings.includeControlMethods==="True"){var v="ControlMethods";this.Settings.includeControlMethodParameters&&this.Settings.includeControlMethodParameters==="True"&&(v+="|ControlMethodParameters");jQuery.ajax({data:{method:"getItems",resultTypes:v},url:applicationRoot+"Utilities/AJAXcall.ashx",type:"POST",async:!0,error:function(n,t){popupManager.showError(n+", "+t)},dataType:"text",global:!1,success:function(n){if(SourceCode.Forms.ExceptionHandler.isException(n)){SourceCode.Forms.ExceptionHandler.handleException(n);return}for(var o=parseXML(n),s="/Items/Item/Items/Item[@ItemType='Control'"+(checkExists(_this.Settings.viewControlID)?" and @Guid='{0}']".format(_this.Settings.viewControlID):"]"),q=viewUtilsXml.selectNodes(s),t=0;t<q.length;t++){var r=q[t].selectSingleNode("Items");checkExists(r)||(r=viewUtilsXml.createElement("Items"),q[t].appendChild(r));var f="/Items/Item[Name='{0}']/Items/Item".format(q[t].getAttribute("SubType"));checkExists(_this.Settings.controlMethodName)&&(f+="[Name='{0}']".format(_this.Settings.controlMethodName));for(var e=o.selectNodes(f),u=0,h=e.length;u<h;u++)r.appendChild(e[u].cloneNode(!0))}_this.dataReturned(viewUtilsXml.xml)}})}else this.dataReturned(viewUtilsXml.xml)}else{var f=SourceCode.Forms.Designers.View.ViewDesigner._getViewMethods();if(this.Settings.includeViewMethods&&this.Settings.includeViewMethods!=="False"){if(!this.Settings.includeMethods||this.Settings.includeMethods==="False"){var e=parseXML(f);removeXmlNodes(e,"//Item[@ItemType = 'Method']");f=e.xml}}else{var e=parseXML(f);removeXmlNodes(e,"//Item[@ItemType = 'ViewMethod']");f=e.xml}this.dataReturned(f)}}else if(this.Settings.viewControlID&&this.Settings.includeObjectDetails&&this.Settings.includeObjectDetails==="True"){var v=this.setResultTypes(),u=this.Settings.skipViewRightsCheck;u===undefined&&(u=!0);jQuery.ajax({data:{method:"getItems",targetType:"View",targetID:this.Settings.viewID,resultTypes:v,includeHidden:u},url:applicationRoot+"Utilities/AJAXcall.ashx",dataType:"text",type:"POST",async:!0,error:function(n,t){popupManager.showError(n+", "+t)},global:!1,success:function(httpResponse){if(SourceCode.Forms.ExceptionHandler.isException(httpResponse)){SourceCode.Forms.ExceptionHandler.handleException(httpResponse);return}with(_this){var temp=_this.objectPlugIn.setResultTypes(),tmpXmlDoc=parseXML(httpResponse),viewElem=tmpXmlDoc.selectSingleNode("Items/Item[(@ItemType='View')]"),associationSONode=viewElem.selectSingleNode("Items/Item[(@ItemType='Control') and (@Guid='"+_this.Settings.viewControlID+"')]"),soIdToUse=null;if(checkExists(associationSONode)){soIdToUse=associationSONode.selectSingleNode("AssociationSO");var isComposite=associationSONode.selectSingleNode("IsComposite");if(checkExists(isComposite)&&isComposite.text.toUpperCase()==="TRUE"&&checkExists(_this.Settings.compositeObjToUse)&&_this.Settings.compositeObjToUse.toUpperCase()==="DISPLAY"){var displaySO=associationSONode.selectSingleNode("DisplaySO");checkExistsNotEmpty(displaySO)&&(soIdToUse=displaySO)}}else if(checkExists(_this.Settings.compositeObjToUse))if(_this.Settings.compositeObjToUse.toUpperCase()==="DISPLAY"){var nodeToRemove=viewElem.selectSingleNode('Items[Item[@SubType="Composite"] and count(Item[@ItemType="Object"])=2]/Item[@ItemType="Object" and @SubType="Composite"]');checkExists(nodeToRemove)&&nodeToRemove.parentNode.removeChild(nodeToRemove)}else if(_this.Settings.compositeObjToUse.toUpperCase()==="VALUE"){var nodeToRemove=viewElem.selectSingleNode('Items[Item[@SubType="Composite"] and count(Item[@ItemType="Object"])=2]/Item[@ItemType="Object" and @SubType="User"]');checkExists(nodeToRemove)&&nodeToRemove.parentNode.removeChild(nodeToRemove)}if(checkExists(soIdToUse)&&soIdToUse.text!==""){var controlSOID=soIdToUse.text;jQuery.ajax({data:{method:"getItems",targetType:"Object",targetID:controlSOID,resultTypes:temp},url:applicationRoot+"Utilities/AJAXcall.ashx",dataType:"text",type:"POST",async:!0,error:function(n,t){popupManager.showError(n+", "+t)},global:!1,success:function(httpResponse){if(SourceCode.Forms.ExceptionHandler.isException(httpResponse)){SourceCode.Forms.ExceptionHandler.handleException(httpResponse);return}with(_this){for(var fieldNode=tmpXmlDoc.selectSingleNode("/Items/Item[@ItemType='View']/Items"),fieldNodeChildren=fieldNode.selectNodes("Item[not(@ItemType='FieldContext' and not(@SubType))]"),f=0;f<fieldNodeChildren.length;f++)fieldNode.removeChild(fieldNodeChildren[f]);var soNode=parseXML(httpResponse).selectSingleNode("/Items/Item[@ItemType='Object']");if(soNode!==null){var clonedItemNode=soNode.cloneNode(!0);fieldNode.appendChild(clonedItemNode);var contextTypeEl=tmpXmlDoc.createElement("ContextType");contextTypeEl.appendChild(tmpXmlDoc.createTextNode("Association"));var controlEl=tmpXmlDoc.createElement("ControlID");controlEl.appendChild(tmpXmlDoc.createTextNode(_this.Settings.viewControlID));var newSONode=tmpXmlDoc.selectSingleNode("/Items/Item[@ItemType='View']/Items/Item[@ItemType = 'Object']");newSONode.appendChild(contextTypeEl);newSONode.appendChild(controlEl);newSONode.appendChild(newSONode.selectSingleNode("Items"))}_this.dataReturned(tmpXmlDoc.xml)}}})}else _this.dataReturned(tmpXmlDoc.xml)}}})}else{var v=this.setResultTypes();if(!this.Settings.viewID){jQuery("#ruleWizardPopup").modalize(!1).showBusy(!1);popupManager.popUps.length<2&&popupManager.showWarning("ViewContextPlugin Error: The required parameter viewID was not specified.");return}var u=this.Settings.skipViewRightsCheck;u===undefined&&(u=!0);jQuery.ajax({data:{method:"getItems",targetType:"View",targetID:this.Settings.viewID,resultTypes:v,includeHidden:u},url:applicationRoot+"Utilities/AJAXcall.ashx",type:"POST",async:!0,error:function(n,t){popupManager.showError(n+", "+t)},dataType:"text",global:!1,success:function(n){if(SourceCode.Forms.ExceptionHandler.isException(n)){SourceCode.Forms.ExceptionHandler.handleException(n);return}var xmlDoc=parseXML(n);with(_this){if(checkExists(_this.Settings.includeControlProperties)&&_this.Settings.includeControlProperties.toLowerCase()==="true"){var controlsForProperties=xmlDoc.selectNodes("//Items/Item[@ItemType='Control']"),controlsForPropertiesLength=controlsForProperties.length,settingsControlID=null;if(checkExists(_this.Settings.viewControlID)&&_this.Settings.viewControlID!==""&&(settingsControlID=_this.Settings.viewControlID),checkExists(_this.Settings.formControlID)&&_this.Settings.formControlID!==""&&(settingsControlID=_this.Settings.formControlID),settingsControlID!==null)for(var currentControlNodes=xmlDoc.selectNodes("//Items/Item[(@ItemType='Control') and (@Guid='{0}')]".format(settingsControlID)),currentControlNodesLength=currentControlNodes.length,c=0;c<currentControlNodesLength;c++){var currentControlNode=currentControlNodes[c],currentControlID=currentControlNode.getAttribute("Guid"),currentControlType=currentControlNode.getAttribute("SubType");SourceCode.Forms.Designers.Common.getControlTypeProperties({node:currentControlNode,controlID:currentControlID,controlType:currentControlType})}else for(var c=0;c<controlsForPropertiesLength;c++){var currentControlNode=controlsForProperties[c];currentControlNode.setAttribute("HasProperties","True")}}_this.dataReturned(xmlDoc.xml)}}})}},initializeSubObjects:function(){this.controlsPlugIn===undefined&&(this.controlsPlugIn=new ControlsContextPlugIn,this.controlsPlugIn.Settings={includeInputControls:this.Settings.includeInputControls,includeListingControls:this.Settings.includeListingControls,includeActionControls:this.Settings.includeActionControls,includeDisplayControls:this.Settings.includeDisplayControls,includeLayoutControls:this.Settings.includeLayoutControls,includeCanvasControls:this.Settings.includeCanvasControls,includeExecutionControls:this.Settings.includeExecutionControls,includeControlMethods:this.Settings.includeControlMethods,includeControlMethodParameters:this.Settings.includeControlMethodParameters,includeExpressions:this.Settings.includeExpressions,includeAreaItemProperties:this.Settings.includeAreaItemProperties,filterSubTypes:this.Settings.filterSubTypes,skipViewRightsCheck:this.Settings.skipViewRightsCheck},this.resultName&&(this.controlsPlugIn.resultName=this.resultName));this.objectPlugIn===undefined&&(this.objectPlugIn=new ObjectContextPlugIn,this.objectPlugIn.Settings={objectID:this.Settings.objectID,method:this.Settings.method,includeProperties:this.Settings.includeProperties,includeMethods:this.Settings.includeMethods,includeListMethods:this.Settings.includeListMethods,includeSingleMethods:this.Settings.includeSingleMethods,includeLoadMethods:this.Settings.includeLoadMethods,includeCreateMethods:this.Settings.includeCreateMethods,includeUpdateMethods:this.Settings.includeUpdateMethods,includeDeleteMethods:this.Settings.includeDeleteMethods,includeExecuteMethods:this.Settings.includeExecuteMethods,includeMethodParameters:this.Settings.includeMethodParameters,includeRequiredProperties:this.Settings.includeRequiredProperties,includeOptionalProperties:this.Settings.includeOptionalProperties,includeResultProperties:this.Settings.includeResultProperties,includeTextFields:this.Settings.includeTextFields,includeMemoFields:this.Settings.includeMemoFields,includeNumberFields:this.Settings.includeNumberFields,includeDecimalFields:this.Settings.includeDecimalFields,includeImageFields:this.Settings.includeImageFields,includeFileFields:this.Settings.includeFileFields,includeHyperlinkFields:this.Settings.includeHyperlinkFields,includeMultivalueFields:this.Settings.includeMultivalueFields,includeXmlFields:this.Settings.includeXmlFields,skipViewRightsCheck:this.Settings.skipViewRightsCheck},this.resultName&&(this.objectPlugIn.resultName=this.resultName),this.objectPlugIn.initializeSubObjects())},setResultTypes:function(){this.initializeSubObjects();var n="";this.Settings.includeFields&&this.Settings.includeFields==="True"&&(n+="ViewFields");this.Settings.includeControls&&this.Settings.includeControls==="True"&&(n.length>0&&(n+="|"),n+="ViewControls");this.Settings.includeObjectDetails&&this.Settings.includeObjectDetails==="True"&&(n.length>0&&(n+="|"),n+=this.Settings.viewControlID?"ControlObjects":"Objects");this.Settings.includeViewMethods&&this.Settings.includeViewMethods==="True"&&(n.length>0&&(n+="|"),n+="ViewMethods");this.Settings.includeViewEvents&&this.Settings.includeViewEvents==="True"&&(n.length>0&&(n+="|"),n+="ViewEvents");this.Settings.includeMethods&&this.Settings.includeMethods==="True"&&(n.length>0&&(n+="|"),n+="ObjectMethods");this.Settings.includeParameters&&this.Settings.includeParameters==="True"&&(n.length>0&&(n+="|"),n+="ViewParameters");this.Settings.includeViewParameterEvents&&this.Settings.includeViewParameterEvents==="True"&&(n.length>0&&(n+="|"),n+="ViewParameterEvents");this.Settings.includeControlTypeEvents&&this.Settings.includeControlTypeEvents==="True"&&(n.length>0&&(n+="|"),n+="ControlTypeEvents");this.Settings.includeExpressions&&this.Settings.includeExpressions==="True"&&(n.length>0&&(n+="|"),n+="ViewExpressions");this.Settings.includeControlMethods&&this.Settings.includeControlMethods==="True"&&(n.length>0&&(n+="|"),n+="ControlMethods");this.Settings.includeControlMethodParameters&&this.Settings.includeControlMethodParameters==="True"&&(n.length>0&&(n+="|"),n+="ControlMethodParameters");this.Settings.includeControlFields&&this.Settings.includeControlFields==="True"&&(n.length>0&&(n+="|"),n+="ControlFields");var t=this.objectPlugIn.setResultTypes();return t&&(n+="|"+t),n},updateViewXmlWithGetItemsResponse:function(n,t,q){if(!checkExists(q))return null;var u=q.selectSingleNode("/Items/Item[@ItemType='View']/Items"),f=parseXML(n).selectSingleNode("/Items/Item[@ItemType='Object']");checkExists(u)&&checkExists(f)&&u.appendChild(f.cloneNode(!0));var e=q.createElement("ContextType");e.appendChild(q.createTextNode("Association"));var o=q.createElement("ControlID");o.appendChild(q.createTextNode(t));var r=q.selectSingleNode("/Items/Item[@ItemType='View']/Items/Item[@ItemType = 'Object']");return checkExists(r)&&(r.appendChild(e),r.appendChild(o),r.appendChild(r.selectSingleNode("Items"))),q},dataReturned:function(n){if(SourceCode.Forms.ExceptionHandler.isException(n)){SourceCode.Forms.ExceptionHandler.handleException(n);return}var t=parseXML(n);if(this.filterXmlUsingSettings(t),this.Settings.cachePlugin&&this.Settings.cachePlugin==="True"&&(this.cachedResult=t.xml,addPlugInToCache(this)),this.dataType==="target|context"){var q=jQuery.Event();q.type=this.pluginReturnedId;q.detail={xml:t,type:"target",resultName:this.resultName};jQuery(document.body).trigger(q);var r=GetContextTreeTransformer();this.Settings.subformID&&(r.addParameter("SubFormID",this.Settings.subformID),this.updateSubFormInstanceName(t));this.Settings.objectDraggable&&r.addParameter("objectDraggable",this.Settings.objectDraggable);this.Settings.instanceID&&r.addParameter("InstanceID",this.Settings.instanceID);this.Settings.subformInstanceID&&r.addParameter("SubFormInstanceID",this.Settings.subformInstanceID);t=tryParseXML(r.transformToText(t.xml));var q=jQuery.Event();q.type=this.pluginReturnedId;q.detail={xml:t,type:"context",resultName:this.resultName};jQuery(document.body).trigger(q)}else{if(this.dataType==="context"){var r=GetContextTreeTransformer();this.Settings.subformID&&(r.addParameter("SubFormID",this.Settings.subformID),this.updateSubFormInstanceName(t));this.Settings.objectDraggable&&r.addParameter("objectDraggable",this.Settings.objectDraggable);this.Settings.instanceID&&r.addParameter("InstanceID",this.Settings.instanceID);this.Settings.subformInstanceID&&r.addParameter("SubFormInstanceID",this.Settings.subformInstanceID);t=tryParseXML(r.transformToText(t.xml))}else this.Settings.subformID&&this.updateSubFormInstanceName(t);var q=jQuery.Event();q.type=this.pluginReturnedId;q.detail={xml:t,type:this.dataType,resultName:this.resultName};jQuery(document.body).trigger(q)}this.unitTestReturnMethod&&this.unitTestReturnMethod(q)},updateSubFormInstanceName:function(n){var o=SourceCode.Forms.WizardContainer.currentRuleWizardContext.toLowerCase(),q,r=SourceCode.Forms.WizardContainer.stateID,u,s=SourceCode.Forms.Designers.Rule.tmpContextDefinition;q=o==="form"?"/SourceCode.Forms/Forms/Form/States/State"+(r?"[@ID='"+r+"']":"[@IsBase='True']"):"/SourceCode.Forms/Views/View";var f=s.selectSingleNode(q+"/Events/Event[Handlers/Handler/Actions/Action[(@Type='Popup') and (@SubFormID='"+this.Settings.subformID+"')]]");if(f){u=f.selectSingleNode("Properties/Property[Name='RuleFriendlyName']/Value").text;var e=n.selectSingleNode("Items/Item[(@ItemType='View') and (@Guid='"+this.Settings.viewID+"')]"),t=e.selectSingleNode("DisplayName"),h=t.text+" - ("+u+")";e.setAttribute("SubFormID",this.Settings.subformID);t.firstChild&&t.removeChild(t.firstChild);t.appendChild(t.ownerDocument.createTextNode(h))}},filterXmlUsingSettings:function(n){if(this.initializeSubObjects(),this.Settings.viewControlID&&(this.Settings.includeObjectDetails&&this.Settings.includeObjectDetails==="True"?removeXmlNodes(n,"//Item[(ControlID != '"+this.Settings.viewControlID+"' or @ItemType='Control' or not(ControlID)) and @ItemType = 'Object']"):removeXmlNodes(n,"//Item[@ItemType = 'Control' and @Guid != '"+this.Settings.viewControlID+"']"),this.Settings.includeFields&&this.Settings.viewControlID&&removeXmlNodes(n,"/Items/Item/Items/Item[@ItemType='FieldContext']/Items/Item[(not(ContextID) or  ContextID!='{0}') and (not(@ContextID) or @ContextID!='{0}')]".format(this.Settings.viewControlID))),checkExists(this.Settings.includeControlMethods)&&this.Settings.includeControlMethods==="True"&&(removeXmlNodes(n,"//Item[not(Items/Item[@ItemType = 'ControlMethod']) and @ItemType = 'Control']"),checkExists(this.Settings.controlMethodName)&&removeXmlNodes(n,"//Item[Name != '"+this.Settings.controlMethodName+"' and @ItemType = 'ControlMethod']")),checkExists(this.Settings.includeViewParameterEvents)&&this.Settings.includeViewParameterEvents==="True"&&checkExists(this.Settings.viewParameterID)&&removeXmlNodes(n,"//Item[Name != '"+this.Settings.viewParameterID+"' and @ItemType = 'ViewParameter']"),this.Settings.includeListViews||this.Settings.includeCaptureViews||this.Settings.includeCaptureListViews){var t="";this.Settings.includeListViews&&this.Settings.includeListViews!=="False"||(t+="@SubType = 'List'");this.Settings.includeCaptureViews&&this.Settings.includeCaptureViews!=="False"||(t.length>0&&(t+=" or "),t+="@SubType = 'Capture'");this.Settings.includeCaptureListViews&&this.Settings.includeCaptureListViews!=="False"||(t.length>0&&(t+=" or "),t+="@SubType = 'CaptureList'");t.length>0&&removeXmlNodes(n,"//Item[@ItemType = 'View' and ("+t+")]")}if(checkExists(this.Settings.useRuntimeSearchableFields)&&this.Settings.useRuntimeSearchableFields.toLowerCase()==="true"&&checkExists(this.Settings.runtimeFilterFields)){for(var q="",r=this.Settings.runtimeFilterFields,u=r.length;u--;){var f=r[u];q+=" and @Guid != '"+f.getAttribute("ID")+"'"}q.length>0&&removeXmlNodes(n,"//Item[@ItemType = 'ViewField'"+q+"]")}this.controlsPlugIn.filterXmlUsingSettings(n);this.objectPlugIn.filterXmlUsingSettings(n)},equals:function(n,t,q){return!(n instanceof ViewContextPlugIn)&&!(t||q)?!1:(this.initializeSubObjects(),!(this.resultName===n.resultName))?!1:!comparePluginSetting(this.Settings.isCurrent,n.Settings.isCurrent)&&(!t||n instanceof ViewContextPlugIn)?!1:(!this.Settings.isCurrent||this.Settings.isCurrent==="False")&&(!n.Settings.isCurrent||n.Settings.isCurrent==="False")&&n instanceof ViewContextPlugIn&&this.Settings.viewID!==n.Settings.viewID?!1:!this.Settings.formID&&n.Settings.formID||this.Settings.formID&&!n.Settings.formID||this.Settings.formID!==n.Settings.formID?!1:this.Settings.viewControlID!==n.Settings.viewControlID?!1:comparePluginSetting(this.Settings.includeControls,n.Settings.includeControls)?comparePluginSetting(this.Settings.includeFields,n.Settings.includeFields)?comparePluginSetting(this.Settings.includeParameters,n.Settings.includeParameters)?!comparePluginSetting(this.Settings.includeViewParameterEvents,n.Settings.includeViewParameterEvents)||!comparePluginSetting(this.Settings.viewParameterID,n.Settings.viewParameterID)?!1:comparePluginSetting(this.Settings.includeExpressions,n.Settings.includeExpressions)?comparePluginSetting(this.Settings.includeControlProperties,n.Settings.includeControlProperties)?comparePluginSetting(this.Settings.includeObjectDetails,n.Settings.includeObjectDetails)?comparePluginSetting(this.Settings.includeControlMethods,n.Settings.includeControlMethods)?comparePluginSetting(this.Settings.includeControlMethodParameters,n.Settings.includeControlMethodParameters)?comparePluginSetting(this.Settings.includeControlTypeEvents,n.Settings.includeControlTypeEvents)?comparePluginSetting(this.Settings.includeViewMethods,n.Settings.includeViewMethods)?comparePluginSetting(this.Settings.includeViewEvents,n.Settings.includeViewEvents)?comparePluginSetting(this.Settings.includeListViews,n.Settings.includeListViews)?comparePluginSetting(this.Settings.includeCaptureViews,n.Settings.includeCaptureViews)?comparePluginSetting(this.Settings.includeCaptureListViews,n.Settings.includeCaptureListViews)?comparePluginSetting(this.Settings.includeControlFields,n.Settings.includeControlFields)?comparePluginSetting(this.Settings.objectDraggable,n.Settings.objectDraggable)?comparePluginSetting(this.Settings.skipViewRightsCheck,n.Settings.skipViewRightsCheck)?this.Settings.controlMethodName!==n.Settings.controlMethodName?!1:this.Settings.method!==n.Settings.method?!1:comparePluginSetting(this.Settings.useRuntimeSearchableFields,n.Settings.useRuntimeSearchableFields)?this.Settings.runtimeFilterFields!==n.Settings.runtimeFilterFields?!1:this.controlsPlugIn.equals(n.controlsPlugIn,t,q)?this.objectPlugIn.equals(n.objectPlugIn,t,q)?comparePluginSetting(this.Settings.includeAreaItemProperties,n.Settings.includeAreaItemProperties)?!0:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1}};function ObjectContextPlugIn(n){this.unitTestReturnMethod=n;this.dataType="context"}ObjectContextPlugIn.prototype={initialize:function(){this.initializeSubObjects();var n=cachedPluginIndex(this);if(n!==-1){this.dataReturned(getCachedPluginResult(n));return}var _this=this,t=this.Settings.objectID;if(!this.Settings.objectID){jQuery("#ruleWizardPopup").modalize(!1).showBusy(!1);popupManager.popUps.length<2&&popupManager.showWarning("The required parameter objectID was not specified");return}jQuery.ajax({data:{method:"getItems",targetType:"Object",targetID:t,resultTypes:this.setResultTypes()},url:applicationRoot+"Utilities/AJAXcall.ashx",type:"POST",async:!0,error:function(n,t){popupManager.showError(n+", "+t)},dataType:"text",global:!1,success:function(httpResponse){with(_this)_this.dataReturned(httpResponse)}})},setResultTypes:function(){var n="";return this.Settings.includeProperties&&this.Settings.includeProperties==="True"&&(n="ObjectProperties"),this.Settings.includeMethods&&this.Settings.includeMethods==="True"&&(n.length>0&&(n+="|"),n+="ObjectMethods"),this.Settings.includeMethodParameters&&this.Settings.includeMethodParameters==="True"&&(n.length>0&&(n+="|"),n+="MethodParameters"),this.Settings.includeRequiredProperties&&this.Settings.includeRequiredProperties==="True"&&(n.length>0&&(n+="|"),n+="MethodRequiredProperties"),this.Settings.includeOptionalProperties&&this.Settings.includeOptionalProperties==="True"&&(n.length>0&&(n+="|"),n+="MethodOptionalProperties"),this.Settings.includeResultProperties&&this.Settings.includeResultProperties==="True"&&(n.length>0&&(n+="|"),n+="MethodResultProperties"),n},initializeSubObjects:function(){this.objectFieldsPlugIn===undefined&&(this.objectFieldsPlugIn=new ObjectFieldsContextPlugIn,this.objectFieldsPlugIn.Settings={includeTextFields:this.Settings.includeTextFields,includeMemoFields:this.Settings.includeMemoFields,includeNumberFields:this.Settings.includeNumberFields,includeDecimalFields:this.Settings.includeDecimalFields,includeImageFields:this.Settings.includeImageFields,includeFileFields:this.Settings.includeFileFields,includeHyperlinkFields:this.Settings.includeHyperlinkFields,includeMultivalueFields:this.Settings.includeMultivalueFields,includeXmlFields:this.Settings.includeXmlFields,skipViewRightsCheck:this.Settings.skipViewRightsCheck},this.resultName&&(this.objectFieldsPlugIn.resultName=this.resultName))},dataReturned:function(n){if(SourceCode.Forms.ExceptionHandler.isException(n)){SourceCode.Forms.ExceptionHandler.handleException(n);return}var q=parseXML(n);if(this.filterXmlUsingSettings(q),this.Settings.cachePlugin&&this.Settings.cachePlugin==="True"&&(this.cachedResult=q.xml,addPlugInToCache(this)),this.dataType==="target|context"){var t=jQuery.Event();t.type=this.pluginReturnedId;t.detail={xml:q,type:"target",resultName:this.resultName};jQuery(document.body).trigger(t);var r=GetContextTreeTransformer();this.Settings.objectDraggable&&r.addParameter("objectDraggable",this.Settings.objectDraggable);q=parseXML(r.transformToText(q.xml));var t=jQuery.Event();t.type=this.pluginReturnedId;t.detail={xml:q,type:"context",resultName:this.resultName};jQuery(document.body).trigger(t)}else{if(this.dataType==="context"){var r=GetContextTreeTransformer();this.Settings.objectDraggable&&r.addParameter("objectDraggable",this.Settings.objectDraggable);q=parseXML(r.transformToText(q.xml))}var t=jQuery.Event();t.type=this.pluginReturnedId;t.detail={xml:q,type:this.dataType,resultName:this.resultName};jQuery(document.body).trigger(t)}this.unitTestReturnMethod&&this.unitTestReturnMethod(t)},filterXmlUsingSettings:function(n){this.initializeSubObjects();this.Settings.method&&removeXmlNodesParentNode(n,"//Item[@ItemType ='Method' or @ItemType='ViewMethod']/Name[. != '"+this.Settings.method+"']");this.Settings.includeMethods&&this.Settings.includeMethods!=="False"||removeXmlNodes(n,"//Item[@ItemType='Method']");var r=!1;this.Settings.includeSingleMethods||this.Settings.includeListMethods||this.Settings.includeLoadMethods||this.Settings.includeUpdateMethods||this.Settings.includeCreateMethods||this.Settings.includeDeleteMethods||this.Settings.includeExecuteMethods||(r=!0);var q="";if(!r&&(this.Settings.includeListMethods&&this.Settings.includeListMethods!=="False"||(q+="@SubType = 'list'"),!this.Settings.includeSingleMethods||this.Settings.includeSingleMethods==="False")){q.length>0&&(q+=" or ");var t="";this.Settings.includeLoadMethods&&this.Settings.includeLoadMethods!=="False"||(t+="@SubType = 'read'");this.Settings.includeUpdateMethods&&this.Settings.includeUpdateMethods!=="False"||(t.length>0&&(t+=" or "),t+="@SubType = 'update'");this.Settings.includeCreateMethods&&this.Settings.includeCreateMethods!=="False"||(t.length>0&&(t+=" or "),t+="@SubType = 'create'");this.Settings.includeDeleteMethods&&this.Settings.includeDeleteMethods!=="False"||(t.length>0&&(t+=" or "),t+="@SubType = 'delete'");this.Settings.includeExecuteMethods&&this.Settings.includeExecuteMethods!=="False"||(t.length>0&&(t+=" or "),t+="@SubType = 'execute'");q+=t}q.length>0&&removeXmlNodes(n,"//Item["+q+"]")},equals:function(n,t,q){return!(n instanceof ObjectContextPlugIn)&&!(t||q)?!1:(this.initializeSubObjects(),!(this.resultName===n.resultName))?!1:!t&&!comparePluginSetting(this.Settings.method,n.Settings.method)?!1:n instanceof ObjectContextPlugIn&&(this.Settings.objectID!==n.Settings.objectID||this.Settings.method!==n.Settings.method)?!1:!t&&this.Settings.viewControlID!==n.Settings.viewControlID?!1:comparePluginSetting(this.Settings.includeProperties,n.Settings.includeProperties)?comparePluginSetting(this.Settings.includeMethods,n.Settings.includeMethods)?comparePluginSetting(this.Settings.includeMethodParameters,n.Settings.includeMethodParameters)?comparePluginSetting(this.Settings.includeRequiredProperties,n.Settings.includeRequiredProperties)?comparePluginSetting(this.Settings.includeOptionalProperties,n.Settings.includeOptionalProperties)?comparePluginSetting(this.Settings.includeResultProperties,n.Settings.includeResultProperties)?comparePluginSetting(this.Settings.includeSingleMethods,n.Settings.includeSingleMethods)?comparePluginSetting(this.Settings.includeListMethods,n.Settings.includeListMethods)?comparePluginSetting(this.Settings.includeLoadMethods,n.Settings.includeLoadMethods)?comparePluginSetting(this.Settings.includeCreateMethods,n.Settings.includeCreateMethods)?comparePluginSetting(this.Settings.includeUpdateMethods,n.Settings.includeUpdateMethods)?comparePluginSetting(this.Settings.includeDeleteMethods,n.Settings.includeDeleteMethods)?comparePluginSetting(this.Settings.includeExecuteMethods,n.Settings.includeExecuteMethods)?comparePluginSetting(this.Settings.skipViewRightsCheck,n.Settings.skipViewRightsCheck)?this.objectFieldsPlugIn.equals(n.objectFieldsPlugIn,!0,!0):!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1}};function FormContextPlugIn(n){this.unitTestReturnMethod=n;this.dataType="context"}FormContextPlugIn.prototype={initialize:function(){var _this=this;this.initializeSubObjects();var v=cachedPluginIndex(this);if(v!==-1){this.dataReturned(getCachedPluginResult(v));return}if(this.Settings.isCurrent==="True"){if(!SourceCode.Forms.Designers.Form._getViews){popupManager.showWarning("Invalid Configuration: Cannot find Current Form");return}var tt=this.Settings.includeViews&&this.Settings.includeViews==="True",formXml=parseXML(SourceCode.Forms.Designers.Form._getFormXml(tt)),n=formXml.selectSingleNode("/Items/Item[@ItemType='Form']/Items");if(this.Settings.includeFormControls&&this.Settings.includeFormControls==="True"){var y=parseXML(SourceCode.Forms.Designers.Form._getControls(this.Settings.includeControlProperties&&this.Settings.includeControlProperties==="True"),!0);cloneItemTypeNodes(n,y,"Control",!0)}if(this.Settings.includeFormProperties&&this.Settings.includeFormProperties=="True"){var p=formXml.selectSingleNode("Items/Item[@ItemType='Form']"),qt=p.getAttribute("Guid");SourceCode.Forms.Designers.Common.getControlTypeProperties({node:p,controlID:qt,controlType:"Form"})}if(this.Settings.includeAreaItemProperties&&this.Settings.includeAreaItemProperties=="True")for(var u=formXml.selectNodes("Items/Item[@ItemType='Form']/Items/Item[@ItemType='Control' and @SubType='AreaItem']"),c=0;c<u.length;c++){var w=u[c],rt=w.getAttribute("Guid");SourceCode.Forms.Designers.Common.getControlTypeProperties({node:w,controlID:rt,controlType:"AreaItem"})}if(this.Settings.includeParameters&&this.Settings.includeParameters==="True"){var ut=SourceCode.Forms.Designers.Form._getParameters();if(cloneItemTypeNodes(n,ut,"FormParameter",!0),this.Settings.includeFormParameterEvents&&this.Settings.includeFormParameterEvents.toUpperCase()==="TRUE")for(var t=parseXML(jQuery.ajax({data:{method:"getItems",resultTypes:"FormParameterEvents"},url:applicationRoot+"Utilities/AJAXcall.ashx",type:"POST",async:!1,error:function(n,t){popupManager.showError(n+", "+t)},dataType:"text"}).responseText),b=n.selectNodes("//Item[@ItemType='FormParameter']"),ft=b.length,l=0;l<ft;l++){var et=t.selectSingleNode("Items").cloneNode(!0),ot=b[l];ot.appendChild(et)}}if(this.Settings.includeFormPanels&&this.Settings.includeFormPanels==="True"){var st=parseXML(SourceCode.Forms.Designers.Form._getPanels());cloneItemTypeNodes(n,st,"Panel",!0)}if(this.Settings.includeExpressions&&this.Settings.includeExpressions==="True"){var k;checkExists(SourceCode.Forms.Designers.Rule.tmpContextDefinition)&&SourceCode.Forms.Designers.Rule.tmpContextDefinition.selectSingleNode("//Forms/Form")!==null&&(k=SourceCode.Forms.Designers.Rule.tmpContextDefinition.selectSingleNode("//Forms/Form"));var ht=SourceCode.Forms.Designers.Form._getExpressions({getSimpleExpression:!0},k);cloneItemTypeNodes(n,ht,"Expression",!0)}if(this.Settings.includeControlTypeEvents&&this.Settings.includeControlTypeEvents==="True"){var t=jQuery.ajax({data:{method:"getItems",resultTypes:"ControlTypeEvents"},url:applicationRoot+"Utilities/AJAXcall.ashx",type:"POST",async:!1,error:function(n,t){popupManager.showError(n+", "+t)},dataType:"text"}).responseText;if(SourceCode.Forms.ExceptionHandler.isException(t)){SourceCode.Forms.ExceptionHandler.handleException(t);return}for(var y=parseXML(t),a=formXml.selectNodes("/Items/Item/Items/Item[@ItemType='Control']"),f=0;f<a.length;f++){var d=y.selectSingleNode("/Items/Item[Name='"+a[f].getAttribute("SubType")+"']/Items");d&&a[f].appendChild(d.cloneNode(!0))}}if(this.Settings.includeFormEvents&&this.Settings.includeFormEvents==="True"){var t=jQuery.ajax({data:{method:"getItems",resultTypes:"FormEvents"},url:applicationRoot+"Utilities/AJAXcall.ashx",type:"POST",error:function(n,t){popupManager.showError(n+", "+t)},dataType:"text",async:!1}).responseText;if(SourceCode.Forms.ExceptionHandler.isException(t)){SourceCode.Forms.ExceptionHandler.handleException(t);return}var ct=parseXML(t);cloneItemTypeNodes(n,ct,"FormEvent")}if(this.Settings.includeFields&&this.Settings.includeFields==="True"||this.Settings.includeObjects&&this.Settings.includeObjects==="True"||this.Settings.includeControls&&this.Settings.includeControls==="True"||this.Settings.includeExpressions&&this.Settings.includeExpressions==="True"||this.Settings.includeControlFields&&this.Settings.includeControlFields==="True"||this.Settings.includeParameters&&this.Settings.includeParameters==="True"){for(var resultTypes=this.viewPlugIn.setResultTypes(),e="",u=formXml.selectNodes("/Items/Item[@ItemType='Form']/Items/Item[@ItemType = 'View']"),o=0;o<u.length;o++)e+=u[o].getAttribute("Guid"),o<u.length-1&&(e+=",");if(e.length>0){var q=this.Settings.skipViewRightsCheck;q===undefined&&(q=!0);jQuery.ajax({data:{method:"getItems",targetType:"View",targetID:e,resultTypes:resultTypes,includeHidden:q},url:applicationRoot+"Utilities/AJAXcall.ashx",type:"POST",async:!1,error:function(n,t){popupManager.showError(n+", "+t)},dataType:"text",global:!1,success:function(httpResponse){if(SourceCode.Forms.ExceptionHandler.isException(httpResponse)){SourceCode.Forms.ExceptionHandler.handleException(httpResponse);return}with(_this,formXml)if(_this.Settings.viewControlID&&_this.Settings.includeObjectDetails&&_this.Settings.includeObjectDetails.toLowerCase()==="true"){var viewItemsXml=parseXML(httpResponse).selectSingleNode("Items/Item[@Guid='"+_this.Settings.viewID+"']/Items");if(viewItemsXml!==null){var viewItemsNode=viewItemsXml.cloneNode(!0),existingViewNode=formXml.selectSingleNode("Items/Item/Items/Item[(@ItemType='View') and (@Guid='"+_this.Settings.viewID+"')]");existingViewNode.appendChild(viewItemsNode);var objectAssocNode=parseXML(httpResponse).selectSingleNode("//Items/Item[@ItemType='Control' and @Guid='"+_this.Settings.viewControlID+"']"),soIdToUse=null;if(checkExists(objectAssocNode)){var soIdToUse=objectAssocNode.selectSingleNode("AssociationSO"),isComposite=objectAssocNode.selectSingleNode("IsComposite");if(checkExists(isComposite)&&isComposite.text.toUpperCase()==="TRUE"&&checkExists(_this.Settings.compositeObjToUse)&&_this.Settings.compositeObjToUse.toUpperCase()==="DISPLAY"){var displaySO=objectAssocNode.selectSingleNode("DisplaySO");checkExistsNotEmpty(displaySO)&&(soIdToUse=displaySO)}}if(!soIdToUse){_this.dataReturned("<Items/>");return}var objectID=soIdToUse.text;jQuery.ajax({data:{method:"getItems",targetType:"Object",targetID:objectID,resultTypes:resultTypes},url:applicationRoot+"Utilities/AJAXcall.ashx",dataType:"text",type:"POST",async:!1,error:function(n,t){popupManager.showError(n+", "+t)},global:!1,success:function(httpResponse){if(SourceCode.Forms.ExceptionHandler.isException(httpResponse)){SourceCode.Forms.ExceptionHandler.handleException(httpResponse);return}with(_this){for(var objectsToRemove=formXml.selectNodes("//Items/Item[(@ItemType='Object')]"),o=0;o<objectsToRemove.length;o++)objectsToRemove[o].parentNode.removeChild(objectsToRemove[o]);var fieldNode=formXml.selectSingleNode("//Items/Item[@ItemType='View' and (@Guid='"+_this.Settings.viewID+"')]/Items"),soNode=parseXML(httpResponse).selectSingleNode("/Items/Item[@ItemType='Object']");if(soNode!==null){var clonedItemNode=soNode.cloneNode(!0);fieldNode.appendChild(clonedItemNode);var contextTypeEl=formXml.createElement("ContextType");contextTypeEl.appendChild(formXml.createTextNode("Association"));var controlEl=formXml.createElement("ControlID");controlEl.appendChild(formXml.createTextNode(_this.Settings.viewControlID));var newSONode=formXml.selectSingleNode("Items/Item/Items/Item[@ItemType='View']/Items/Item[@ItemType = 'Object']");newSONode.appendChild(contextTypeEl);newSONode.appendChild(controlEl);newSONode.appendChild(newSONode.selectSingleNode("Items"))}}}})}else formXml=parseXML("<Items />")}else for(var viewDoc=parseXML(httpResponse),viewNodes=formXml.selectNodes("/Items/Item[@ItemType ='Form']/Items/Item[@ItemType = 'View']"),f=viewNodes.length-1;f>=0;f--){for(var currentViewNode=viewNodes[f],currentViewGuid=currentViewNode.getAttribute("Guid"),currentViewChildNodes=currentViewNode.childNodes,currentViewInstanceNode=currentViewNode.selectSingleNode("InstanceID").cloneNode(!0),currentViewDisplayNameNode=currentViewNode.selectSingleNode("DisplayName").cloneNode(!0);currentViewNode.childNodes.length>0;)currentViewNode.removeChild(currentViewNode.childNodes[0]);var newViewNode=viewDoc.selectSingleNode("/Items/Item[(@ItemType = 'View') and (@Guid = '"+currentViewGuid+"')]");if(newViewNode!==null){for(var newViewChildNodes=newViewNode.childNodes,n=0;n<newViewChildNodes.length;n++)if(newViewChildNodes[n].tagName!=="DisplayName"){var clonedNode=newViewChildNodes[n].cloneNode(!0);viewNodes[f].appendChild(currentViewDisplayNameNode);viewNodes[f].appendChild(currentViewInstanceNode);viewNodes[f].appendChild(clonedNode)}}else currentViewNode.parentNode.removeChild(currentViewNode)}}})}}if(checkExists(this.Settings.includeControlMethods)&&this.Settings.includeControlMethods==="True"){var resultTypes="ControlMethods";this.Settings.includeControlMethodParameters&&this.Settings.includeControlMethodParameters==="True"&&(resultTypes+="|ControlMethodParameters");jQuery.ajax({data:{method:"getItems",resultTypes:resultTypes},url:applicationRoot+"Utilities/AJAXcall.ashx",type:"POST",async:!1,error:function(n,t){popupManager.showError(n+", "+t)},dataType:"text",global:!1,success:function(t){if(SourceCode.Forms.ExceptionHandler.isException(t)){SourceCode.Forms.ExceptionHandler.handleException(t);return}for(var s=parseXML(t),h="//Item[@ItemType='Control'"+(checkExists(_this.Settings.viewControlID)?" and @Guid='{0}']".format(_this.Settings.viewControlID):checkExists(_this.Settings.formControlID)?" and @Guid='{0}']".format(_this.Settings.formControlID):"]"),u=n.selectNodes(h),q=0;q<u.length;q++){var r=u[q].selectSingleNode("Items");checkExists(r)||(r=formXml.createElement("Items"),u[q].appendChild(r));var o="/Items/Item[Name='{0}']/Items/Item".format(u[q].getAttribute("SubType"));checkExists(_this.Settings.controlMethodName)&&(o+="[Name='{0}']".format(_this.Settings.controlMethodName));for(var e=s.selectNodes(o),f=0,c=e.length;f<c;f++){var l=e[f].selectSingleNode("Name").text,a=r.selectSingleNode("Item[Name = '{0}' ]".format(l));checkExists(a)||r.appendChild(e[f].cloneNode(!0))}}}})}if(checkExists(this.Settings.includeControlProperties)&&this.Settings.includeControlProperties.toLowerCase()==="true"||checkExists(this.Settings.includeControlFields)&&this.Settings.includeControlFields.toLowerCase()==="true"){var g=formXml.selectNodes("//Items/Item[@ItemType='Control']"),lt=g.length,s=null;if(checkExists(this.Settings.viewControlID)&&this.Settings.viewControlID!==""&&(s=this.Settings.viewControlID),checkExists(this.Settings.formControlID)&&this.Settings.formControlID!==""&&(s=this.Settings.formControlID),s!==null)for(var nt=formXml.selectNodes("//Items/Item[(@ItemType='Control') and (@Guid='{0}')]".format(s)),at=nt.length,r=0;r<at;r++){var h=nt[r],vt=h.getAttribute("Guid"),yt=h.getAttribute("SubType");SourceCode.Forms.Designers.Common.getControlTypeProperties({node:h,controlID:vt,controlType:yt})}else for(var r=0;r<lt;r++){var h=g[r];h.setAttribute("HasProperties","True")}}this.dataReturned(formXml.xml)}else{var resultTypes=this.setResultTypes();if(!this.Settings.formID){jQuery("#ruleWizardPopup").modalize(!1).showBusy(!1);popupManager.popUps.length<2&&popupManager.showWarning("The required parameter formID was not specified");return}var q=this.Settings.skipViewRightsCheck;q===undefined&&(q=!0);jQuery.ajax({data:{method:"getItems",targetType:"Form",targetID:this.Settings.formID,resultTypes:resultTypes,includeHidden:q},url:applicationRoot+"Utilities/AJAXcall.ashx",type:"POST",async:!0,error:function(n,t){popupManager.showError(n+", "+t)},dataType:"text",global:!1,success:function(n){if(SourceCode.Forms.ExceptionHandler.isException(n)){SourceCode.Forms.ExceptionHandler.handleException(n);return}var xmlDoc=parseXML(n);with(_this){if(checkExists(_this.Settings.includeControlProperties)&&_this.Settings.includeControlProperties.toLowerCase()==="true"){var controlsForProperties=xmlDoc.selectNodes("//Items/Item[@ItemType='Control']"),controlsForPropertiesLength=controlsForProperties.length,settingsControlID=null;if(checkExists(_this.Settings.viewControlID)&&_this.Settings.viewControlID!==""&&(settingsControlID=_this.Settings.viewControlID),checkExists(_this.Settings.formControlID)&&_this.Settings.formControlID!==""&&(settingsControlID=_this.Settings.formControlID),settingsControlID!==null)for(var currentControlNodes=xmlDoc.selectNodes("//Items/Item[(@ItemType='Control') and (@Guid='{0}')]".format(settingsControlID)),currentControlNodesLength=currentControlNodes.length,c=0;c<currentControlNodesLength;c++){var currentControlNode=currentControlNodes[c],currentControlID=currentControlNode.getAttribute("Guid"),currentControlType=currentControlNode.getAttribute("SubType");SourceCode.Forms.Designers.Common.getControlTypeProperties({node:currentControlNode,controlID:currentControlID,controlType:currentControlType})}else for(var c=0;c<controlsForPropertiesLength;c++){var currentControlNode=controlsForProperties[c];currentControlNode.setAttribute("HasProperties","True")}}if(_this.Settings.includeFormProperties&&_this.Settings.includeFormProperties=="True"){var formNode=xmlDoc.selectSingleNode("Items/Item[@ItemType='Form']"),setPropertiesFormID=formNode.getAttribute("Guid");SourceCode.Forms.Designers.Common.getControlTypeProperties({node:formNode,controlID:setPropertiesFormID,controlType:"Form"})}if(_this.Settings.includeAreaItemProperties&&_this.Settings.includeAreaItemProperties==="True"){for(var viewItems=xmlDoc.selectNodes("Items/Item[@ItemType='Form']/Items/Item[@ItemType='View']/InstanceID"),areaItemXPath="Items/Item[@ItemType='Form']/Items/Item[(@ItemType='Control') and (@SubType='AreaItem')",areaItemsToRemoveXpath=areaItemXPath,areaIndex=0;areaIndex<viewItems.length;areaIndex++)areaItemXPath+=areaIndex===0?" and":" or",areaItemXPath+=" (@Guid='"+viewItems[areaIndex].text+"')",areaItemsToRemoveXpath+=" and (@Guid!='"+viewItems[areaIndex].text+"')";areaItemXPath+="]";areaItemsToRemoveXpath+="]";for(var areaItemItems=xmlDoc.selectNodes(areaItemXPath),areaItemItemsLength=areaItemItems.length,z=0;z<areaItemItemsLength;z++){var areaItemNode=areaItemItems[z],setPropertiesAreaItemID=areaItemNode.getAttribute("Guid"),viewItemForArea=xmlDoc.selectSingleNode("Items/Item[@ItemType='Form']/Items/Item[InstanceID='"+setPropertiesAreaItemID+"' and @ItemType='View']"),viewItemForAreaNameText,viewItemForAreaDisplayNameText;checkExists(viewItemForArea)&&(viewItemForAreaNameText=viewItemForArea.selectSingleNode("Name").text,viewItemForAreaDisplayNameText=viewItemForArea.selectSingleNode("DisplayName").text);var areaItemNameNode=areaItemNode.selectSingleNode("Name"),areaItemDisplayNameNode=areaItemNode.selectSingleNode("DisplayName");areaItemNameNode.removeChild(areaItemNameNode.firstChild);areaItemDisplayNameNode.removeChild(areaItemDisplayNameNode.firstChild);areaItemNameNode.appendChild(xmlDoc.createTextNode(viewItemForAreaNameText));areaItemDisplayNameNode.appendChild(xmlDoc.createTextNode(viewItemForAreaDisplayNameText));SourceCode.Forms.Designers.Common.getControlTypeProperties({node:areaItemNode,controlID:setPropertiesAreaItemID,controlType:"AreaItem"})}removeXmlNodes(xmlDoc,areaItemsToRemoveXpath)}_this.dataReturned(xmlDoc.xml)}}})}},setResultTypes:function(){var n="";if(this.Settings.includeParameters&&this.Settings.includeParameters==="True"&&(n+="FormParameters"),this.Settings.includeFormParameterEvents&&this.Settings.includeFormParameterEvents.toUpperCase()==="TRUE"&&(n.length>0&&(n+="|"),n+="FormParameterEvents"),this.Settings.includeFormPanels&&this.Settings.includeFormPanels==="True"&&(n.length>0&&(n+="|"),n+="FormPanels"),this.Settings.includeViews&&this.Settings.includeViews==="True"&&(n.length>0&&(n+="|"),n+="FormViews"),this.Settings.includeFormEvents&&this.Settings.includeFormEvents==="True"&&(n.length>0&&(n+="|"),n+="FormEvents"),this.Settings.includeFormControls==="True"&&(n.length>0&&(n+="|"),n+="FormControls"),this.Settings.includeControlTypeEvents&&this.Settings.includeControlTypeEvents==="True"&&(n.length>0&&(n+="|"),n+="ControlTypeEvents"),this.Settings.includeExpressions&&this.Settings.includeExpressions==="True"&&(n.length>0&&(n+="|"),n+="FormExpressions",n+="|ViewExpressions"),this.Settings.includeControlMethods&&this.Settings.includeControlMethods==="True"&&(n.length>0&&(n+="|"),n+="ControlMethods"),this.Settings.includeControlMethodParameters&&this.Settings.includeControlMethodParameters==="True"&&(n.length>0&&(n+="|"),n+="ControlMethodParameters"),this.Settings.includeFields&&this.Settings.includeFields==="True"||this.Settings.includeControls&&this.Settings.includeControls==="True"||this.Settings.includeObjects&&this.Settings.includeObjects==="True"||this.Settings.includeParameters&&this.Settings.includeParameters==="True"){var t=this.viewPlugIn.setResultTypes();t&&(n+="|"+t)}return n},initializeSubObjects:function(){this.controlsPlugIn===undefined&&(this.controlsPlugIn=new ControlsContextPlugIn,this.controlsPlugIn.Settings={includeInputControls:this.Settings.includeInputControls,includeListingControls:this.Settings.includeListingControls,includeActionControls:this.Settings.includeActionControls,includeDisplayControls:this.Settings.includeDisplayControls,includeLayoutControls:this.Settings.includeLayoutControls,includeCanvasControls:this.Settings.includeCanvasControls,includeExecutionControls:this.Settings.includeExecutionControls,includeControlMethods:this.Settings.includeControlMethods,includeControlMethodParameters:this.Settings.includeControlMethodParameters,includeExpressions:this.Settings.includeExpressions,includeAreaItemProperties:this.Settings.includeAreaItemProperties,filterSubTypes:this.Settings.filterSubTypes,skipViewRightsCheck:this.Settings.skipViewRightsCheck});this.viewPlugIn===undefined&&(this.viewPlugIn=new ViewContextPlugIn,this.viewPlugIn.Settings={includeParameters:this.Settings.includeParameters,viewControlID:this.Settings.viewControlID,method:this.Settings.method,objectID:this.Settings.objectID,includeFields:this.Settings.includeFields,includeControls:this.Settings.includeControls,includeInputControls:this.Settings.includeInputControls,includeListingControls:this.Settings.includeListingControls,includeActionControls:this.Settings.includeActionControls,includeDisplayControls:this.Settings.includeDisplayControls,includeLayoutControls:this.Settings.includeLayoutControls,includeCanvasControls:this.Settings.includeCanvasControls,includeExecutionControls:this.Settings.includeExecutionControls,includeTextFields:this.Settings.includeTextFields,includeMemoFields:this.Settings.includeMemoFields,includeNumberFields:this.Settings.includeNumberFields,includeDecimalFields:this.Settings.includeDecimalFields,includeImageFields:this.Settings.includeImageFields,includeFileFields:this.Settings.includeFileFields,includeHyperlinkFields:this.Settings.includeHyperlinkFields,includeMultivalueFields:this.Settings.includeMultivalueFields,includeXmlFields:this.Settings.includeXmlFields,includeControlTypeEvents:this.Settings.includeControlTypeEvents,includeViewMethods:this.Settings.includeViewMethods,includeViewEvents:this.Settings.includeViewEvents,includeMethods:this.Settings.includeMethods,includeListViews:this.Settings.includeListViews,includeCaptureViews:this.Settings.includeCaptureViews,includeCaptureListViews:this.Settings.includeCaptureListViews,includeObjectDetails:this.Settings.includeObjectDetails,includeMethodParameters:this.Settings.includeMethodParameters,includeRequiredProperties:this.Settings.includeRequiredProperties,includeOptionalProperties:this.Settings.includeOptionalProperties,includeResultProperties:this.Settings.includeResultProperties,includeExpressions:this.Settings.includeExpressions,includeControlMethods:this.Settings.includeControlMethods,includeControlMethodParameters:this.Settings.includeControlMethodParameters,includeControlProperties:this.Settings.includeControlProperties,useRuntimeSearchableFields:this.Settings.useRuntimeSearchableFields,runtimeFilterFields:this.Settings.runtimeFilterFields,includeViewParameterEvents:this.Settings.includeViewParameterEvents,includeAreaItemProperties:this.Settings.includeAreaItemProperties,includeControlFields:this.Settings.includeControlFields,skipViewRightsCheck:this.Settings.skipViewRightsCheck},this.viewPlugIn.initializeSubObjects())},dataReturned:function(n){if(SourceCode.Forms.ExceptionHandler.isException(n)){SourceCode.Forms.ExceptionHandler.handleException(n);return}var t=parseXML(n);if(this.filterXmlUsingSettings(t),this.Settings.cachePlugin&&this.Settings.cachePlugin==="True"&&(this.cachedResult=t.xml,addPlugInToCache(this)),this.dataType==="target|context"){var q=jQuery.Event();q.type=this.pluginReturnedId;q.detail={xml:t,type:"target",resultName:this.resultName};jQuery(document.body).trigger(q);var r=GetContextTreeTransformer();this.Settings.subformID&&(r.addParameter("SubFormID",this.Settings.subformID),this.updateSubFormInstanceName(t));this.Settings.objectDraggable&&r.addParameter("objectDraggable",this.Settings.objectDraggable);this.Settings.instanceID&&(r.addParameter("InstanceID",this.Settings.instanceID),this.updateSubFormInstanceName(t));this.Settings.subformInstanceID&&(r.addParameter("SubFormInstanceID",this.Settings.subformInstanceID),this.updateSubFormInstanceName(t));t=parseXML(r.transformToText(t.xml));var q=jQuery.Event();q.type=this.pluginReturnedId;q.detail={xml:t,type:"context",resultName:this.resultName};jQuery(document.body).trigger(q)}else{if(this.dataType==="context"){var r=GetContextTreeTransformer();this.Settings.subformID&&(r.addParameter("SubFormID",this.Settings.subformID),this.updateSubFormInstanceName(t));this.Settings.objectDraggable&&r.addParameter("objectDraggable",this.Settings.objectDraggable);this.Settings.instanceID&&(r.addParameter("InstanceID",this.Settings.instanceID),this.updateSubFormInstanceName(t));this.Settings.subformInstanceID&&(r.addParameter("SubFormInstanceID",this.Settings.subformInstanceID),this.updateSubFormInstanceName(t));t=parseXML(r.transformToText(t.xml))}else this.Settings.subformID&&this.updateSubFormInstanceName(t);var q=jQuery.Event();q.type=this.pluginReturnedId;q.detail={xml:t,type:this.dataType,resultName:this.resultName};jQuery(document.body).trigger(q)}this.unitTestReturnMethod&&this.unitTestReturnMethod(q)},updateSubFormInstanceName:function(n){var o=SourceCode.Forms.WizardContainer.currentRuleWizardContext.toLowerCase(),q,r=SourceCode.Forms.WizardContainer.stateID,u,s=SourceCode.Forms.Designers.Rule.tmpContextDefinition;q=o==="form"?"/SourceCode.Forms/Forms/Form/States/State"+(r?"[@ID='"+r+"']":"[@IsBase='True']"):"/SourceCode.Forms/Views/View";var f=s.selectSingleNode(q+"/Events/Event[Handlers/Handler/Actions/Action[(@Type='Open') and (@SubFormID='"+this.Settings.subformID+"')]]");if(f){u=f.selectSingleNode("Properties/Property[Name='RuleFriendlyName']/Value").text;var e=n.selectSingleNode("Items/Item[(@ItemType='Form') and (@Guid='"+this.Settings.formID+"')]"),t=e.selectSingleNode("DisplayName"),h=t.text+" - ("+u+")";e.setAttribute("SubFormID",this.Settings.subformID);t.firstChild&&t.removeChild(t.firstChild);t.appendChild(t.ownerDocument.createTextNode(h))}},equals:function(n){if(!(n instanceof FormContextPlugIn)||(this.initializeSubObjects(),this.resultName!==n.resultName)||!comparePluginSetting(this.Settings.isCurrent,n.Settings.isCurrent))return!1;if(this.Settings.isCurrent&&this.Settings.isCurrent!=="False"||n.Settings.isCurrent&&n.Settings.isCurrent!=="False"){if(this.Settings.viewID!==n.Settings.viewID)return!1}else if(this.Settings.formID!==n.Settings.formID)return!1;return comparePluginSetting(this.Settings.includeParameters,n.Settings.includeParameters)?!comparePluginSetting(this.Settings.includeFormParameterEvents,n.Settings.includeFormParameterEvents)||this.Settings.formParameterID!==n.Settings.formParameterID?!1:comparePluginSetting(this.Settings.includeViews,n.Settings.includeViews)?comparePluginSetting(this.Settings.includeListViews,n.Settings.includeListViews)?comparePluginSetting(this.Settings.includeCaptureViews,n.Settings.includeCaptureViews)?this.Settings.instanceID!==n.Settings.instanceID?!1:this.Settings.subformInstanceID!==n.Settings.subformInstanceID?!1:comparePluginSetting(this.Settings.includeFormEvents,n.Settings.includeFormEvents)?comparePluginSetting(this.Settings.includeFormPanels,n.Settings.includeFormPanels)?comparePluginSetting(this.Settings.includeControlProperties,n.Settings.includeControlProperties)?comparePluginSetting(this.Settings.includeFormProperties,n.Settings.includeFormProperties)?comparePluginSetting(this.Settings.includeAreaItemProperties,n.Settings.includeAreaItemProperties)?comparePluginSetting(this.Settings.includeExpressions,n.Settings.includeExpressions)?comparePluginSetting(this.Settings.includeControlMethods,n.Settings.includeControlMethods)?comparePluginSetting(this.Settings.includeControlMethodParameters,n.Settings.includeControlMethodParameters)?this.Settings.formControlID!==n.Settings.formControlID?!1:this.Settings.controlMethodName!==n.Settings.controlMethodName?!1:this.Settings.method!==n.Settings.method?!1:comparePluginSetting(this.Settings.skipViewRightsCheck,n.Settings.skipViewRightsCheck)?comparePluginSetting(this.Settings.includeAreaItemProperties,n.Settings.includeAreaItemProperties)?checkExists(this.viewPlugIn)&&checkExists(n.viewPlugIn)?this.viewPlugIn.equals(n.viewPlugIn,!0,!0):!0:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1:!1},filterXmlUsingSettings:function(n){var t=this.Settings.formControlID;checkExists(t)||(t=this.Settings.viewControlID);checkExists(t)&&removeXmlNodes(n,"//Item[@ItemType = 'Control' and @Guid != '"+t+"']");checkExists(this.Settings.includeControlMethods)&&this.Settings.includeControlMethods==="True"&&(removeXmlNodes(n,"//Item[@ItemType = 'Control' and not(Items/Item[@ItemType = 'ControlMethod']) ]"),checkExists(this.Settings.controlMethodName)&&removeXmlNodes(n,"//Item[Name != '"+this.Settings.controlMethodName+"' and @ItemType = 'ControlMethod']"));this.Settings.viewID&&removeXmlNodes(n,"//Item[@ItemType = 'View' and @Guid != '"+this.Settings.viewID+"']");this.Settings.method&&removeXmlNodes(n,"//Item[Name != '"+this.Settings.method+"' and @ItemType = 'FormEvent']");checkExistsNotEmptyGuid(this.Settings.instanceID)&&this.Settings.viewID&&removeXmlNodes(n,"//Item[(@ItemType = 'View') and (InstanceID/text() != '"+this.Settings.instanceID+"' or not(InstanceID))]");checkExistsNotEmptyGuid(this.Settings.subformInstanceID)&&this.Settings.viewID&&removeXmlNodes(n,"//Item[(@ItemType = 'View') and (InstanceID/text() != '"+this.Settings.subformInstanceID+"' or not(InstanceID))]");checkExists(this.Settings.includeFormParameterEvents)&&this.Settings.includeFormParameterEvents.toUpperCase()==="TRUE"&&checkExists(this.Settings.formParameterID)&&removeXmlNodes(n,"//Item[Name != '"+this.Settings.formParameterID+"' and @ItemType = 'FormParameter']");this.Settings.includeViews&&this.Settings.includeViews==="True"&&this.viewPlugIn.filterXmlUsingSettings(n);this.controlsPlugIn.filterXmlUsingSettings(n)}};function SystemVariablesItemsPlugIn(n){this.unitTestReturnMethod=n}SystemVariablesItemsPlugIn.prototype={initialize:function(){var _this=this,n=cachedPluginIndex(this);if(n!==-1){_this.dataReturned(getCachedPluginResult(n));return}var t=_this.setResultTypes();jQuery.ajax({data:{method:"getItems",resultTypes:t},dataType:"text",global:!1,success:function(httpResponse){with(_this)_this.dataReturned(httpResponse)},url:applicationRoot+"Utilities/AJAXcall.ashx",type:"POST",async:!1,error:function(n,t){popupManager.showError(n+", "+t)}})},dataReturned:function(n){if(SourceCode.Forms.ExceptionHandler.isException(n)){SourceCode.Forms.ExceptionHandler.handleException(n);return}this.cachedResult=n;addPlugInToCache(this);var t=jQuery.Event();t.type=this.pluginReturnedId;t.detail={xml:parseXML(n),type:this.dataType,resultName:this.resultName};jQuery(document.body).trigger(t);this.unitTestReturnMethod&&this.unitTestReturnMethod(t)},equals:function(n){return(n instanceof SystemVariablesItemsPlugIn)?(this.resultName===n.resultName)?comparePluginSetting(this.Settings.includeRenderModeVars,n.Settings.includeRenderModeVars)?!0:!1:!1:!1},setResultTypes:function(){var n="";return this.Settings.includeRenderModeVars&&this.Settings.includeRenderModeVars==="True"&&(n+="RenderModes"),n}};function SystemVariablesContextPlugIn(n){this.unitTestReturnMethod=n;this.dataType="context"}SystemVariablesContextPlugIn.prototype={initialize:function(){var n=this.Settings.includeAll?"True":"False",t=cachedPluginIndex(this);if(t!==-1){this.dataReturned(getCachedPluginResult(t));return}var q=this.Settings.includeCurrentUser?this.Settings.includeCurrentUser:n,r=this.Settings.includeCurrentDate?this.Settings.includeCurrentDate:n,u=this.Settings.includeCurrentDateOnly?this.Settings.includeCurrentDateOnly:n,f=this.Settings.includeCurrentTime?this.Settings.includeCurrentTime:n,e=this.Settings.includeCurrentUserFQN?this.Settings.includeCurrentUserFQN:n,o=this.Settings.includeCurrentDisplayName?this.Settings.includeCurrentDisplayName:n,s=this.Settings.includeCurrentDescription?this.Settings.includeCurrentDescription:n,h=this.Settings.includeEmail?this.Settings.includeEmail:n,c=this.Settings.includeManagerFQN?this.Settings.includeManagerFQN:n,l=this.Settings.includeCurrentUserName?this.Settings.includeCurrentUserName:n,a=this.Settings.includeScreenHeight?this.Settings.includeScreenHeight:n,v=this.Settings.includeScreenWidth?this.Settings.includeScreenWidth:n,y=this.Settings.includeBrowserPlatform?this.Settings.includeBrowserPlatform:n,p=this.Settings.includeBrowserUsersAgent?this.Settings.includeBrowserUsersAgent:n,w=this.Settings.includeBrowserCulture?this.Settings.includeBrowserCulture:n,b=this.Settings.includeErrorVars?this.Settings.includeErrorVars:n,k=this.Settings.includeRenderModeVars?this.Settings.includeRenderModeVars:n,d=this.Settings.includeWorkflowVars?this.Settings.includeWorkflowVars:n,_this=this;jQuery.ajax({data:{method:"getSystemVariables",showUserName:q,showDate:r,showDateOnly:u,showTime:f,showFQN:e,showDisplayName:o,showDescription:s,showEmail:h,showManagerFQN:c,showCurrentUserName:l,showScreenHeight:a,showScreenWidth:v,showBrowserPlatform:y,showBrowserUsersAgent:p,showBrowserCulture:w,showErrorVars:b,showRenderModeVars:k,showWorkflowVars:d},dataType:"text",global:!1,success:function(httpResponse){with(_this)_this.dataReturned(httpResponse)},url:applicationRoot+"Utilities/AJAXcall.ashx",type:"POST",async:!0,error:function(n,t){popupManager.showError(n+", "+t)}})},dataReturned:function(n){if(SourceCode.Forms.ExceptionHandler.isException(n)){SourceCode.Forms.ExceptionHandler.handleException(n);return}this.cachedResult=n;addPlugInToCache(this);var t=jQuery.Event();t.type=this.pluginReturnedId;t.detail={xml:parseXML(n),type:this.dataType,resultName:this.resultName};jQuery(document.body).trigger(t);this.unitTestReturnMethod&&this.unitTestReturnMethod(t)},equals:function(n){return(n instanceof SystemVariablesContextPlugIn)?(this.resultName===n.resultName)?comparePluginSetting(this.Settings.includeWorkflowVars,n.Settings.includeWorkflowVars)?comparePluginSetting(this.Settings.includeAll,n.Settings.includeAll)?!0:!1:!1:!1:!1}};function EnvironmentFieldsContextPlugIn(n){this.unitTestReturnMethod=n;this.dataType="context"}EnvironmentFieldsContextPlugIn.prototype={initialize:function(){var _this=this,n=cachedPluginIndex(this);if(n!==-1){this.dataReturned(getCachedPluginResult(n));return}jQuery.ajax({data:{method:"getEnvironmentFields"},dataType:"text",global:!1,success:function(httpResponse){with(_this)_this.dataReturned(httpResponse)},url:applicationRoot+"Utilities/AJAXcall.ashx",type:"POST",async:!1,error:function(n,t){popupManager.showError(n+", "+t)}})},dataReturned:function(n){if(SourceCode.Forms.ExceptionHandler.isException(n)){SourceCode.Forms.ExceptionHandler.handleException(n);return}this.cachedResult=n;addPlugInToCache(this);var t=jQuery.Event();t.type=this.pluginReturnedId;t.detail={xml:parseXML(n),type:this.dataType,resultName:this.resultName};jQuery(document.body).trigger(t);this.unitTestReturnMethod&&this.unitTestReturnMethod(t)},equals:function(n){return(n instanceof EnvironmentFieldsContextPlugIn)?(this.resultName===n.resultName)?!0:!1:!1}};function ControlTypeEventPlugIn(n){this.unitTestReturnMethod=n}ControlTypeEventPlugIn.prototype={initialize:function(){var n=cachedPluginIndex(this);if(n!==-1){this.dataReturned(getCachedPluginResult(n));return}if(this.Settings.includeControlTypeEvents&&this.Settings.includeControlTypeEvents==="True"){var t=this.Settings.controlType;this.Settings.viewControlID&&this.Settings.isCurrent&&(t=parseXML(SourceCode.Forms.Designers.View.ViewDesigner._getViewObjects()).selectSingleNode("/Items/Item[@ItemType='View']/Items/Item[@ItemType='Control' Guid = '"+this.Settings.viewControlID+"']").getAttribute("SubType"));var _this=this;jQuery.ajax({data:{method:"getItems",targetType:"ControlType",targetID:t,resultTypes:"ControlTypeEvents"},url:applicationRoot+"Utilities/AJAXcall.ashx",type:"POST",async:!0,error:function(n,t){popupManager.showError(n+", "+t)},dataType:"text",global:!1,success:function(httpResponse){with(_this)_this.dataReturned(httpResponse)}})}},dataReturned:function(n){if(!SourceCode.Forms.ExceptionHandler.handleException(n)){this.cachedResult=n;addPlugInToCache(this);var t=jQuery.Event();t.type=this.pluginReturnedId;t.detail={xml:parseXML(n),type:this.dataType,resultName:this.resultName};jQuery(document.body).trigger(t);this.unitTestReturnMethod&&this.unitTestReturnMethod(t)}},equals:function(n){return(n instanceof ControlTypeEventPlugIn)?(this.resultName===n.resultName)?comparePluginSetting(this.Settings.controlType,n.Settings.controlType)?!0:!1:!1:!1}};function SubViewContextPlugIn(n){this.unitTestReturnMethod=n}SubViewContextPlugIn.prototype=$.extend({},ViewContextPlugIn.prototype,{initialize:function(){if(this.Settings.isCurrent&&this.Settings.isCurrent==="True"){var vt=SourceCode.Forms.WizardContainer.currentRuleWizardContext.toLowerCase(),w,qt=SourceCode.Forms.WizardContainer.stateID;SourceCode.Forms.Designers.Common.Context.ensureDefinitionIsReadyForDependancyChecks(SourceCode.Forms.Designers.Rule.tmpContextDefinition);var rt=SourceCode.Forms.Designers.Rule.tmpContextDefinition;w=vt==="form"?"/SourceCode.Forms/Forms/Form/States/State"+(qt?"[@ID='"+qt+"']":"[@IsBase='True']"):"/SourceCode.Forms/Views/View";for(var s=rt.selectNodes(w+"/Events/Event[not(@SubFormID)]/Handlers/Handler/Actions/Action[@Type='Popup']"),n=parseXML("<Items />"),b=jQuery("#"+this.Settings.controlID),r=[],ut=[],ft=[],et=[],yt=b.closest("li.action"),pt=yt.attr("id"),q=0;q<s.length;q++){var u=s[q].selectSingleNode("Properties/Property[Name='ViewID']/Value").text;r.push(u);var wt=s[q].getAttribute("SubFormID");ut.push(wt);var bt=s[q].getAttribute("InstanceID");ft.push(bt)}if(this.Settings.controlID||popupManager.showWarning("Invalid Configuration: No controlID supplied"),this.Settings.controlID&&b.closest("ul.rulesUl.handler:not(.rulesImageWrapper)")!=="ruleDefinitionRulesArea")for(var ot=jQuery("ul.rulesUl.handler:not(.rulesImageWrapper)").find("li.action:not([id="+pt+"])"),k=0;k<ot.length;k++){var h=ot.eq(k);if($chk(h.data("xml"))){var kt=h.data("xml").getAttribute("Type");if(kt==="Popup"&&b[0].parentNode.parentNode.parentNode.id!==h.attr("id"))for(var st=jQuery(h.find("div.rule-item-wrapper>div")[0]).children("a"),d=0;d<st.length;d++){var c=jQuery(st[d]);if(c.data("xml").getAttribute("Name")==="View"){var e=c.data("value");if(e&&r.indexOf(e)===-1){r.push(e);et.push(e);var ht=c.text();n||(n=parseXML("<Items />"));var t=n.createElement("Item"),l=n.createElement("DisplayName"),a=n.createElement("Name"),ct=n.createTextNode(ht.xmlEncode());subformID=c.data("data").getAttribute("SubFormID");t.setAttribute("ItemType","View");t.setAttribute("Guid",e);t.setAttribute("SubFormID",subformID);a.appendChild(ct);l.appendChild(ct);t.appendChild(a);t.appendChild(l);n.selectSingleNode("Items").appendChild(t)}}}}}if(r.length>0){var f=this.Settings.skipViewRightsCheck;f===undefined&&(f=!0);var o=jQuery.ajax({data:{method:"getItems",targetType:"View",targetID:r.join(","),resultTypes:"Views",includeHidden:f},dataType:"text",global:!1,async:!1,url:applicationRoot+"Utilities/AJAXcall.ashx",type:"POST",error:function(n,t){popupManager.showError(n+", "+t)}});if(SourceCode.Forms.ExceptionHandler.isException(o.responseText)){SourceCode.Forms.ExceptionHandler.handleException(o.responseText);return}o=o.responseText;var g=parseXML(o);this.filterXmlUsingSettings(g);for(var q=0;q<r.length;q++){var u=r[q],lt=ut[q],v=ft[q],nt=g.selectSingleNode("/Items/Item[@ItemType='View' and @Guid='"+u+"']/DisplayName");if(nt===null){var tt=n.selectSingleNode("/Items/Item[@ItemType='View' and @Guid='"+u+"']/DisplayName");checkExists(tt)&&tt.parentNode.removeChild(tt);continue}else if(nt!==null&&et.indexOf(u)!=-1)continue;else if(nt!==null){var ht=g.selectSingleNode("/Items/Item[@ItemType='View' and @Guid='"+u+"']/DisplayName").text,rq=n.selectSingleNode("/Items/Item[(@ItemType='View') and (@Guid='"+u+"')]"),y=w+"/Events/Event[Handlers/Handler/Actions/Action[@Type='Popup'";y+=" and (@SubFormID='"+lt+"')";checkExists(v)&&(y+=" and (@InstanceID='"+v+"')");y+="]/Properties/Property[(Name='ViewID')]/Value='"+u+"']";var dt=rt.selectSingleNode(y),gt=" - ("+dt.selectSingleNode("Properties/Property[Name/text()='RuleFriendlyName']/Value").text+")",t=n.createElement("Item"),l=n.createElement("DisplayName"),a=n.createElement("Name"),nq=n.createCDATASection(r[q]),tq=n.createCDATASection(ht+gt);if(t.setAttribute("ItemType","View"),t.setAttribute("Guid",u),t.setAttribute("SubFormID",lt),a.appendChild(nq),l.appendChild(tq),t.appendChild(a),t.appendChild(l),n.selectSingleNode("Items").appendChild(t),v!==null){var at=n.createElement("InstanceID"),qq=n.createCDATASection(v);at.appendChild(qq);t.appendChild(at)}}}}var p=jQuery.Event();p.type=this.pluginReturnedId;p.detail={xml:n,type:this.dataType};jQuery("body").trigger(p);this.unitTestReturnMethod&&this.unitTestReturnMethod(p)}else{if(!this.Settings.viewID){popupManager.showWarning("No view ID was specified");return}var _this=this,f=this.Settings.skipViewRightsCheck;f===undefined&&(f=!0);jQuery.ajax({data:{method:"getItems",targetType:"View",targetID:this.Settings.viewID,resultTypes:"SubViews",includeHidden:f},dataType:"text",global:!1,url:applicationRoot+"Utilities/AJAXcall.ashx",type:"POST",async:!0,error:function(n,t){popupManager.showError(n+", "+t)},success:function(httpResponse){with(_this)_this.dataReturned(httpResponse)}})}},dataReturned:function(n){if(SourceCode.Forms.ExceptionHandler.isException(n)){SourceCode.Forms.ExceptionHandler.handleException(n);return}var q=parseXML(n);this.filterXmlUsingSettings(q);var t=jQuery.Event();t.type=this.pluginReturnedId;t.detail={xml:q,type:this.dataType,resultName:this.resultName};jQuery(document.body).trigger(t);this.unitTestReturnMethod&&this.unitTestReturnMethod(t)},equals:function(n){return(n instanceof SubViewContextPlugIn)?(this.resultName===n.resultName)?!0:!1:!1}});function SubFormContextPlugIn(n){this.unitTestReturnMethod=n}SubFormContextPlugIn.prototype={initialize:function(){if(this.Settings.isCurrent&&this.Settings.isCurrent==="True"){var pt=SourceCode.Forms.WizardContainer.currentRuleWizardContext.toLowerCase(),w,qt=SourceCode.Forms.WizardContainer.stateID;SourceCode.Forms.Designers.Common.Context.ensureDefinitionIsReadyForDependancyChecks(SourceCode.Forms.Designers.Rule.tmpContextDefinition);var rt=SourceCode.Forms.Designers.Rule.tmpContextDefinition;w=pt==="form"?"/SourceCode.Forms/Forms/Form/States/State"+(qt?"[@ID='"+qt+"']":"[@IsBase='True']"):"/SourceCode.Forms/Views/View";for(var o=rt.selectNodes(w+"/Events/Event[not(@SubFormID)]/Handlers/Handler/Actions/Action[@Type='Open']"),n=parseXML("<Items />"),b=jQuery("#"+this.Settings.controlID),u=[],ut=[],ft=[],et=[],wt=b.closest("li.action"),bt=wt.attr("id"),q=0;q<o.length;q++){var r=o[q].selectSingleNode("Properties/Property[Name='FormID']/Value").text;u.push(r);var kt=o[q].getAttribute("SubFormID");ft.push(kt);var dt=o[q].getAttribute("InstanceID");et.push(dt)}if(this.Settings.controlID||popupManager.showWarning("Invalid Configuration: No controlID supplied"),this.Settings.controlID&&b.closest("ul.rulesUl.handler:not(.rulesImageWrapper)")!=="ruleDefinitionRulesArea")for(var ot=jQuery("ul.rulesUl.handler:not(.rulesImageWrapper)").find("li.action:not([id="+bt+"])"),k=0;k<ot.length;k++){var s=ot.eq(k);if($chk(s.data("xml"))){var gt=s.data("xml").getAttribute("Type");if(gt==="Open"&&b[0].parentNode.parentNode.parentNode.id!==s.attr("id"))for(var st=jQuery(s.find("div.rule-item-wrapper>div")[0]).children("a"),d=0;d<st.length;d++){var h=jQuery(st[d]);if(h.data("xml").getAttribute("Name")==="Form"){var e=h.data("value");if(e&&u.indexOf(e)===-1){u.push(e);ut.push(e);var ht=h.text();n||(n=parseXML("<Items />"));var t=n.createElement("Item"),c=n.createElement("DisplayName"),l=n.createElement("Name"),ct=n.createTextNode(ht.xmlEncode());subformID=h.data("data").getAttribute("SubFormID");t.setAttribute("ItemType","Form");t.setAttribute("Guid",e);t.setAttribute("SubFormID",subformID);l.appendChild(ct);c.appendChild(ct);t.appendChild(l);t.appendChild(c);n.selectSingleNode("Items").appendChild(t)}}}}}if(u.length>0){var f=this.Settings.skipViewRightsCheck;f===undefined&&(f=!0);var g=jQuery.ajax({data:{method:"getItems",targetType:"Form",targetID:u.join(","),resultTypes:"Forms",includeHidden:f},url:applicationRoot+"Utilities/AJAXcall.ashx",type:"POST",async:!0,error:function(n,t){popupManager.showError(n+", "+t)},dataType:"text",global:!1,async:!1}).responseText;if(SourceCode.Forms.ExceptionHandler.isException(g)){SourceCode.Forms.ExceptionHandler.handleException(g);return}for(var a=parseXML(g),fq=a.selectNodes("/Items/Item[@ItemType='Form']"),q=0;q<u.length;q++){var r=u[q],nt=a.selectSingleNode("/Items/Item[@ItemType='Form' and @Guid='"+r+"']"),lt=ft[q],v=et[q];if(nt===null){var tt=n.selectSingleNode("/Items/Item[@ItemType='Form' and @Guid='"+r+"']");checkExists(tt)&&tt.parentNode.removeChild(tt);continue}else if(nt!==null&&ut.indexOf(r)!=-1)continue;if(nt!==null){var ht=a.selectSingleNode("/Items/Item[@ItemType='Form' and @Guid='"+r+"']/DisplayName").text,nq=a.selectSingleNode("/Items/Item[@ItemType='Form' and @Guid='"+r+"']/Name").text,eq=n.selectSingleNode("/Items/Item[(@ItemType='Form') and (@Guid='"+u[q]+"')]"),y=w+"/Events/Event[Handlers/Handler/Actions/Action[(@Type='Open')";y+=" and (@SubFormID='"+lt+"')";checkExists(v)&&(y+=" and (@InstanceID='"+v+"')");y+="]/Properties/Property[Name='FormID']/Value='"+r+"']";var at=rt.selectSingleNode(y);if(at!==null){var tq=" - ("+at.selectSingleNode("Properties/Property[Name/text()='RuleFriendlyName']/Value").text+")",t=n.createElement("Item"),c=n.createElement("DisplayName"),l=n.createElement("Name"),vt=n.createElement("SystemName"),qq=n.createCDATASection(r),rq=n.createCDATASection(ht+tq);if(t.setAttribute("ItemType","Form"),t.setAttribute("Guid",r),t.setAttribute("SubFormID",lt),l.appendChild(qq),c.appendChild(rq),vt.appendChild(n.createTextNode(nq)),t.appendChild(l),t.appendChild(c),t.appendChild(vt),n.selectSingleNode("Items").appendChild(t),v!==null){var yt=n.createElement("InstanceID"),uq=n.createCDATASection(v);yt.appendChild(uq);t.appendChild(yt)}}}}}var p=jQuery.Event();p.type=this.pluginReturnedId;p.detail={xml:n,type:this.dataType};jQuery("body").trigger(p);this.unitTestReturnMethod&&this.unitTestReturnMethod(p)}else{if(!this.Settings.formID){popupManager.showWarning("No form ID was specified");return}var _this=this,f=this.Settings.skipViewRightsCheck;f===undefined&&(f=!0);jQuery.ajax({data:{method:"getItems",targetType:"Form",targetID:this.Settings.formID,resultTypes:"SubForms",includeHidden:f},url:applicationRoot+"Utilities/AJAXcall.ashx",type:"POST",async:!0,error:function(n,t){popupManager.showError(n+", "+t)},dataType:"text",global:!1,success:function(httpResponse){with(_this)_this.dataReturned(httpResponse)}})}},dataReturned:function(n){if(SourceCode.Forms.ExceptionHandler.isException(n)){SourceCode.Forms.ExceptionHandler.handleException(n);return}var t=jQuery.Event();t.type=this.pluginReturnedId;t.detail={xml:parseXML(n),type:this.dataType,resultName:this.resultName};jQuery(document.body).trigger(t);this.unitTestReturnMethod&&this.unitTestReturnMethod(t)},equals:function(n){return(n instanceof SubFormContextPlugIn)?(this.resultName===n.resultName)?!0:!1:!1}};function ItemStatesContextPlugIn(n){this.unitTestReturnMethod=n}ItemStatesContextPlugIn.prototype={initialize:function(){var _this=this,n=function(){var n=cachedPluginIndex(_this);if(n!==-1){_this.dataReturned(getCachedPluginResult(n));return}jQuery.ajax({data:{method:"getItems",resultTypes:"ActionItemStates"},url:applicationRoot+"Utilities/AJAXcall.ashx",dataType:"text",type:"POST",async:!0,error:function(n,t){popupManager.showError(n+", "+t)},global:!1,success:function(httpResponse){with(_this)_this.dataReturned(httpResponse)}})};if(typeof _this.Settings.viewType!="undefined"){var t=SourceCode.Forms.WizardContainer.currentRuleWizardContext;(t==="View"||t==="Control")&&(_this.Settings.viewType==="List"||_this.Settings.viewType==="CaptureList")?n():popupManager.showNotification(Resources.CommonPhrases.NoItemsToDisplay)}else n()},dataReturned:function(n){if(SourceCode.Forms.ExceptionHandler.isException(n)){SourceCode.Forms.ExceptionHandler.handleException(n);return}this.cachedResult=n;addPlugInToCache(this);var q=parseXML(n);this.filterXmlUsingSettings(q);var t=jQuery.Event();t.type=this.pluginReturnedId;t.detail={xml:q,type:this.dataType,resultName:this.resultName};jQuery(document.body).trigger(t);this.unitTestReturnMethod&&this.unitTestReturnMethod(t)},equals:function(n){return(n instanceof ItemStatesContextPlugIn)?(this.resultName===n.resultName)?!0:!1:!1},filterXmlUsingSettings:function(n){if((!this.Settings.includeChangeStates||this.Settings.includeChangeStates==="False")&&(!this.Settings.includeAddRemoveStates||this.Settings.includeAddRemoveStates==="False")&&(!this.Settings.includeSelectionStates||this.Settings.includeSelectionStates==="False")&&(!this.Settings.includeAllState||this.Settings.includeAllState==="False")&&(!this.Settings.includeCustomState||this.Settings.includeCustomState==="False")&&(!this.Settings.includeCheckedStates||this.Settings.includeCheckedStates==="False"))return n;var t="";this.Settings.includeUnchangeStates&&this.Settings.includeUnchangeStates!=="False"||(t+="Name = 'Unchanged'");this.Settings.includeAllState&&this.Settings.includeAllState!=="False"||(t.length>0&&(t+=" or "),t+="Name = 'All'");this.Settings.includeCustomState&&this.Settings.includeCustomState!=="False"||(t.length>0&&(t+=" or "),t+="Name = 'Custom'");this.Settings.includeAddRemoveChangeStates&&this.Settings.includeAddRemoveChangeStates!=="False"||(t.length>0&&(t+=" or "),t+="Name = 'Added' or Name = 'Removed' or Name = 'Changed'");this.Settings.includeSelectionStates&&this.Settings.includeSelectionStates!=="False"||(t.length>0&&(t+=" or "),t+="Name = 'Selected' or Name = 'Unselected'");this.Settings.includeCheckedStates&&this.Settings.includeCheckedStates!=="False"||(t.length>0&&(t+=" or "),t+="Name = 'Checked' or Name = 'Unchecked'");this.Settings.viewType&&this.Settings.viewType==="Capture"?(t.length>0&&(t+=" or "),t+="Name = 'Added' or Name = 'Removed' or Name = 'Changed' or Name = 'Unchanged' or Name = 'Selected' or Name = 'Unselected'"):this.Settings.viewType&&(this.Settings.viewType==="CaptureList"||this.Settings.viewType==="List")&&(t.length>0&&(t+=" or "),t+="Name = 'Checked' or Name = 'Unchecked'");t.length>0&&removeXmlNodes(n,"/Items/Item["+t+"]")}};function ProcessContextPlugIn(n){this.unitTestReturnMethod=n}ProcessContextPlugIn.prototype={initialize:function(){this.Settings.dataType&&(this.dataType=this.Settings.dataType);var n=cachedPluginIndex(this);if(n!==-1){this.dataReturned(getCachedPluginResult(n));return}var _this=this;jQuery.ajax({data:{method:"getItems",resultTypes:this.Settings.resultTypes,targetId:this.Settings.workflowPath},url:applicationRoot+"Utilities/AJAXcall.ashx",dataType:"text",type:"POST",async:!0,error:function(n,t){popupManager.showError(n+", "+t)},global:!1,success:function(httpResponse){with(_this)_this.dataReturned(httpResponse)}})},dataReturned:function(n){if(SourceCode.Forms.ExceptionHandler.isException(n)){jQuery("#ruleWizardPopup").modalize(!1).showBusy(!1);SourceCode.Forms.ExceptionHandler.handleException(n);return}if(this.cachedResult=n,addPlugInToCache(this),this.dataType&&this.dataType==="context"){var q=GetContextTreeTransformer();this.Settings.objectDraggable&&q.addParameter("objectDraggable",this.Settings.objectDraggable);n=q.transformToText(n)}var t=jQuery.Event();t.type=this.pluginReturnedId;try{if(n=parseXML(n),this.dataType&&this.dataType==="context"&&n.documentElement.childNodes.length===0)throw new DOMException;}catch(r){return jQuery("#ruleWizardPopup").modalize(!1).showBusy(!1),popupManager.showNotification(Resources.RuleDesigner.NoItemsToDisplayNoRightsRemoved),!1}t.detail={xml:n,type:this.dataType,resultName:this.resultName};jQuery(document.body).trigger(t);this.unitTestReturnMethod&&this.unitTestReturnMethod(t)},equals:function(n){return(n instanceof ItemStatesContextPlugIn)?(this.resultName===n.resultName)?!0:!1:!1},filterXmlUsingSettings:function(n){var t=this.Settings.workflowPath.toString().split("\\");if(t.length===2)removeXmlNodes(n,"//Item[(@ItemType='ProcessFolder')and not(Name/text()='"+t[0]+"')]"),removeXmlNodes(n,"//Item[(@ItemType='ProcessSet')and not(Name/text()='"+t[0]+"\\\\"+t[1]+"')]");else if(t.length===3){var t=this.Settings.activityFullName.toString().split("\\");removeXmlNodes(n,"//Item[(@ItemType='ProcessFolder')and not(Name/text()='"+t[0]+"')]");removeXmlNodes(n,"//Item[(@ItemType='ProcessSet')and not(Name/text()='"+t[0]+"\\\\"+t[1]+"')]");removeXmlNodes(n,"//Item[(@ItemType='Activity')and not(Name/text()='"+t[2]+"')]")}}};function RulePlugIn(){this.dataType="text"}RulePlugIn.prototype={initialize:function(){this.dataReturned(this.getData())},getData:function(){var l=SourceCode.Forms.WizardContainer.currentRuleWizardContext,n=parseXML("<Items />"),rt=$chk(SourceCode.Forms.WizardContainer.ruleID)?SourceCode.Forms.WizardContainer.ruleID:"",a=SourceCode.Forms.WizardContainer.stateID,u="SourceCode.Forms";l==="View"||l==="Control"?u+="/Views/View/":(u+="/Forms/Form/States/State",u+=$chk(a)?"[@ID='"+a+"']":"[@IsBase='True']");u+="/Events/Event[(@ID!='"+rt+"') and (@Type='User')]";for(var v=SourceCode.Forms.Designers.Rule.tmpContextDefinition.selectNodes(u),s=0;s<v.length;s++){var t=v[s],y=t.selectSingleNode("Properties/Property[Name = 'RuleFriendlyName']/Value"),e=y===null?null:y.text;if(e!==null){var h=t.getAttribute("ID"),ut=t.getAttribute("DefinitionID")?t.getAttribute("DefinitionID"):h,o=t.getAttribute("SubFormID")?t.getAttribute("SubFormID"):"",f=t.getAttribute("InstanceID")?t.getAttribute("InstanceID"):"",c=t.getAttribute("SubFormInstanceID")?t.getAttribute("SubFormInstanceID"):"",ft=t.selectSingleNode("Name")?t.selectSingleNode("Name").text:"";if(checkExistsNotEmptyGuid(o)){var et=".//Action[(@Type='Open' or @Type='Popup') and @SubFormID='"+o+"']",p=SourceCode.Forms.Designers.Rule.tmpContextDefinition.selectSingleNode(et),w=p.getAttribute("InstanceID")?p.getAttribute("InstanceID"):"";w!==f&&(c=f,f=w)}var b="Rule",q=n.createElement("Item"),k=n.createElement("Name"),d=n.createElement("SystemName"),g=n.createElement("Value"),nt=n.createElement("DisplayName"),tt=n.createElement("Data"),r=n.createElement("Item"),qt=n.createElement("Name");q.setAttribute("ItemType",b);q.setAttribute("Guid",h);q.setAttribute("InstanceID",f);q.setAttribute("SubFormID",o);q.setAttribute("SubFormInstanceID",c);k.appendChild(n.createCDATASection(e));d.appendChild(n.createCDATASection(ft));nt.appendChild(n.createCDATASection(e));g.appendChild(n.createCDATASection(ut));qt.appendChild(n.createCDATASection(e));r.setAttribute("ItemType",b);r.setAttribute("Guid",h);r.setAttribute("InstanceID",f);r.setAttribute("SubFormID",o);r.setAttribute("SubFormInstanceID",c);tt.appendChild(r);r.appendChild(qt);q.appendChild(k);q.appendChild(d);q.appendChild(nt);q.appendChild(g);q.appendChild(tt);n.documentElement.appendChild(q)}}return n.xml},dataReturned:function(n){if(SourceCode.Forms.ExceptionHandler.isException(n)){SourceCode.Forms.ExceptionHandler.handleException(n);return}var q=parseXML(n);this.filterXmlUsingSettings(q);var t=jQuery.Event();t.type=this.pluginReturnedId;t.detail={xml:q,type:this.dataType,resultName:this.resultName};jQuery(document.body).trigger(t)},filterXmlUsingSettings:function(n){checkExistsNotEmpty(this.Settings)&&checkExistsNotEmpty(this.Settings.eventName)&&removeXmlNodes(n,"//Item[SystemName!='"+this.Settings.eventName+"']")},equals:function(n){return(n instanceof RulePlugIn)?(this.resultName===n.resultName)?!0:!1:!1}};function WorkflowStripLocationPlugIn(){this.dataType="text"}WorkflowStripLocationPlugIn.prototype={initialize:function(){for(var n=parseXML("<Items />"),r=["none","top","bottom"],o=[this.Settings.noneResourceName,this.Settings.topResourceName,this.Settings.bottomResourceName],t=0;t<r.length;t++){var q=n.createElement("Item"),u=n.createElement("Name"),f=n.createElement("DisplayName"),e=n.createElement("Value"),s=n.createCDATASection(r[t]),h=n.createCDATASection(o[t]),c=n.createCDATASection(r[t]);q.setAttribute("ItemType","WorkflowStripLocationType");u.appendChild(s);f.appendChild(h);e.appendChild(c);q.appendChild(u);q.appendChild(f);q.appendChild(e);n.selectSingleNode("Items").appendChild(q)}this.dataReturned(n.xml)},dataReturned:function(n){if(SourceCode.Forms.ExceptionHandler.isException(n)){SourceCode.Forms.ExceptionHandler.handleException(n);return}var t=jQuery.Event();t.type=this.pluginReturnedId;t.detail={xml:parseXML(n),type:this.dataType,resultName:this.resultName};jQuery(document.body).trigger(t)},equals:function(n){return(n instanceof WorkflowStripLocationPlugIn)?(this.resultName===n.resultName)?!0:!1:!1}};function ExecutionTypePlugIn(n){this.unitTestReturnMethod=n;this.dataType="text"}ExecutionTypePlugIn.prototype={initialize:function(){var f=cachedPluginIndex(this);if(f!==-1){this.dataReturned(getCachedPluginResult(f));return}var n=parseXML("<Items />"),u=jQuery.ajax({data:{method:"getItems",resultTypes:"ActionExecutionTypes"},url:applicationRoot+"Utilities/AJAXcall.ashx",type:"POST",async:!0,error:function(n,t){popupManager.showError(n+", "+t)},dataType:"text",global:!1,async:!1}).responseText;if(SourceCode.Forms.ExceptionHandler.isException(u)){SourceCode.Forms.ExceptionHandler.handleException(u);return}for(var h=parseXML(u),r=h.selectNodes("/Items/Item[@ItemType='ActionExecutionType']"),t=0;t<r.length;t++){var q=n.createElement("Item"),e=n.createElement("Name"),o=n.createElement("DisplayName"),s=n.createElement("Value"),c=n.createCDATASection(r[t].selectSingleNode("Name").text),l=n.createCDATASection(r[t].selectSingleNode("DisplayName").text),a=n.createCDATASection(r[t].selectSingleNode("Value").text);q.appendChild(e);q.appendChild(o);q.appendChild(s);q.setAttribute("ItemType","ActionExecutionType");e.appendChild(c);o.appendChild(l);s.appendChild(a);n.selectSingleNode("Items").appendChild(q)}this.dataReturned(n.xml)},dataReturned:function(n){if(SourceCode.Forms.ExceptionHandler.isException(n)){SourceCode.Forms.ExceptionHandler.handleException(n);return}this.cachedResult=n;addPlugInToCache(this);var t=jQuery.Event();t.type=this.pluginReturnedId;t.detail={xml:parseXML(n),type:this.dataType,resultName:this.resultName};jQuery(document.body).trigger(t);this.unitTestReturnMethod&&this.unitTestReturnMethod(t)},equals:function(n){return(n instanceof ExecutionTypePlugIn)?(this.resultName===n.resultName)?!0:!1:!1}};function SubformSettingsPlugin(){this.dataType="text"}SubformSettingsPlugin.prototype={initialize:function(){for(var n=parseXML("<Items><\/Items>"),r=[{Name:"Heading",Icon:"text",DisplayName:this.Settings.headingResourceName},{Name:"SubformWidth",Icon:"width",DisplayName:this.Settings.widthResourceName},{Name:"SubformHeight",Icon:"height",DisplayName:this.Settings.heightResourceName},{Name:"SubformVerticalAlign",Icon:"vertical-align",DisplayName:this.Settings.verticalAlignResourceName}],u=n.selectSingleNode("Items"),q=0;q<r.length;q++){var t=n.createElement("Item"),f=n.createElement("Name"),e=n.createElement("DisplayName"),o=n.createCDATASection(r[q].Name),s=n.createCDATASection(r[q].DisplayName);t.setAttribute("ItemType","Setting");t.setAttribute("ActionPropertyCollection","Properties");t.setAttribute("Icon",r[q].Icon);f.appendChild(o);e.appendChild(s);t.appendChild(f);t.appendChild(e);u.appendChild(t)}this.dataReturned(u.xml)},dataReturned:function(n){if(SourceCode.Forms.ExceptionHandler.isException(n)){SourceCode.Forms.ExceptionHandler.handleException(n);return}var t=jQuery.Event();t.type=this.pluginReturnedId;t.detail={xml:parseXML(n),type:this.dataType,resultName:this.resultName};jQuery(document.body).trigger(t)},equals:function(n){return(n instanceof SubformSettingsPlugin)?(this.resultName===n.resultName)?!0:!1:!1}};
/*!
 ~/Rules/Script/ConditionWidget.js
*/
function ConditionWidget(){}ConditionWidget.prototype={_isRuntime:!1,initialize:function(n){if(this._isRuntime=SourceCode.Forms.Layout.isRuntime(),n){var q=jQuery('<div id="ConditionWidgetPC" class="pane-container vertical"><\/div>').appendTo(n),t={};t.height="50%";t.resizable=!1;var r=jQuery('<div id="ConditionGridDiv" class="pane" data-options="'+jQuery.toJSON(t).htmlEncode()+'"><\/div>').appendTo(q);t={};t.divResize="none";t={};t.height="30%";t.resizable=!1;var u=jQuery('<div id="ExpressionDiv" class="pane" data-options="'+jQuery.toJSON(t).htmlEncode()+'"><\/div>').appendTo(q);t={};t.divResize="none";t={};t.resizable=!1;var f=jQuery('<div id="PreviewDiv" class="pane" data-options="'+jQuery.toJSON(t).htmlEncode()+'"><\/div>').appendTo(q);this.expressionValues=[];this.innerEquations=[];this.dropElements=[];this.conditionGrid=new ConditionGrid;this.conditionGrid.parentWidget=this;this.conditionGrid.initialize(r);this.expressionWidget=new ExpressionWidget;this.expressionWidget.parentWidget=this;this.expressionWidget.initialize(u);this.previewWidget=new PreviewWidget;this.previewWidget.parentWidget=this;this.previewWidget.initialize(f);this.previewText="";this.expressionOperators=[{display:Resources.CommonActions.And,value:"And",icon:"And"},{display:Resources.CommonActions.Or,value:"Or",icon:"Or"}];this.equationOperators=[{display:Resources.CommonActions.EqualsText,value:"Equals",icon:"equals",preview:Resources.CommonActions.EqualsTextPreview,left:!0,right:!0},{display:Resources.CommonActions.NotEqualsText,value:"NotEquals",icon:"not-equals",preview:Resources.CommonActions.NotEqualsTextPreview,left:!0,right:!0},{display:Resources.CommonActions.GreaterThanText,value:"GreaterThan",icon:"greater-than",preview:Resources.CommonActions.GreaterThanTextPreview,left:!0,right:!0},{display:Resources.CommonActions.LessThanText,value:"LessThan",icon:"less-than",preview:Resources.CommonActions.LessThanTextPreview,left:!0,right:!0},{display:Resources.CommonActions.GreaterThanEqualsText,value:"GreaterThanEquals",icon:"greater-than-equals",preview:Resources.CommonActions.GreaterThanEqualsTextPreview,left:!0,right:!0},{display:Resources.CommonActions.LessThanEqualsText,value:"LessThanEquals",icon:"less-than-equals",preview:Resources.CommonActions.LessThanEqualsTextPreview,left:!0,right:!0},{display:Resources.CommonActions.ContainsText,value:"Contains",icon:"contains",preview:Resources.CommonActions.ContainsTextPreview,left:!0,right:!0},{display:Resources.CommonActions.StartsWithText,value:"StartsWith",icon:"starts-with",preview:Resources.CommonActions.StartsWithTextPreview,left:!0,right:!0},{display:Resources.CommonActions.EndsWithText,value:"EndsWith",icon:"ends-with",preview:Resources.CommonActions.EndsWithTextPreview,left:!0,right:!0},{display:Resources.CommonActions.IsEmptyText,value:"IsBlank",icon:"text-blank",preview:Resources.CommonActions.IsEmptyTextPreview,left:!0,right:!1},{display:Resources.CommonActions.IsNotEmptyText,value:"IsNotBlank",icon:"text-not-blank",preview:Resources.CommonActions.IsNotEmptyTextPreview,left:!0,right:!1}];$(n).find(".pane-container").on("panecontainercreate",n,function(n){n.data.find(".pane-container").panecontainer("refresh");n.data.find(".grid").grid("synccolumns")})}},load:function(n){if(checkExists(n)&&n.length>0){var r=$xml(n),t=r.firstChild,q=t?t.firstChild:null;q&&(this.sourceXml=n,this.innerEquations=[],this.expressionValues=[],this.equationNumber=0,this.evaluateExpressionValue(q),this.innerEquations.length>0&&this.expressionValues.length>0&&(this.conditionGrid.load(this.innerEquations),this.conditionGrid.save(),this.expressionWidget.load(this.expressionValues),this.previewWidget.load(this.innerEquations,this.expressionValues)))}},reload:function(){this.previewWidget.load(this.innerEquations,this.expressionValues)},getExpressionOperatorItem:function(n){var t=this.expressionOperators.filter(function(t){return t.value===n});return t[0]},getEquationOperatorItem:function(n){var t=this.equationOperators.filter(function(t){return t.value===n});return t[0]},evaluateExpressionValue:function(n){var r=null,u=this.getExpressionOperatorItem(n.tagName);checkExists(u)||(r=this.getEquationOperatorItem(n.tagName));var t=n.firstChild,q=n.lastChild,f=null,e=null;if(t.tagName==="Left"&&(t=t.firstChild,q=q.firstChild),t.parentNode.tagName==="Bracket"){this.expressionValues.push({grouping:"("});this.evaluateExpressionValue(t);this.expressionValues.push({grouping:")"});return}if(t.tagName!=="Item"?this.evaluateExpressionValue(t):f=t,checkExists(u)&&this.expressionValues.push({expression:u}),n.childNodes.length===1&&(q=null),checkExists(q)&&(q.tagName!=="Item"?this.evaluateExpressionValue(q):e=q),checkExists(r)){var o=this._verifyExistenceInArray(this.innerEquations,{left:f,operator:r,right:e});o===-1?(this.equationNumber=this.equationNumber+1,this.innerEquations.push({left:f,operator:r,right:e,number:this.equationNumber}),this.expressionValues.push({number:this.equationNumber})):this.expressionValues.push({number:this.innerEquations[o].number})}},_verifyExistenceInArray:function(n,t){for(var r=-1,u={operator:t.operator,left:t.left.xml,right:checkExists(t.right)?t.right.xml:null},q=0,f=n.length;q<f;q++){var e={operator:n[q].operator,left:n[q].left.xml,right:checkExists(n[q].right)?n[q].right.xml:null};if($.compare(u,e)){r=q;break}}return r},constructXml:function(n){for(var o=!0,f=!1,h=n.expressionValues,a=n.innerEquations,u=$xml("<Conditions />"),t=$sn(u,"Conditions"),c=0,l,s=0;s<h.length;s++){var r=h[s],e;if(r.number){var v=a.filter(function(n){return n.number===r.number}),q=v[0];if(e=u.createElement(q.operator.value),!checkExists(q.left)){o=!1;break}if(!this._isRuntime&&q.left.selectNodes("..//Item"+SourceCode.Forms.Designers.Common.getXPathValidationStatusCondition()).length>0){f=!0;break}var y=this._formatEquationNode(q.left);if(e.appendChild(y.cloneNode(!0)),!checkExists(q.right)&&q.operator.right===!0){o=!1;break}if(!this._isRuntime&&checkExists(q.right)&&q.right.selectNodes("..//Item"+SourceCode.Forms.Designers.Common.getXPathValidationStatusCondition()).length>0){f=!0;break}if(checkExists(q.right)){var p=this._formatEquationNode(q.right);e.appendChild(p.cloneNode(!0))}t.appendChild(e);t.childNodes.length===2&&(t=t.parentNode)}else if(r.expression)t.childNodes.length===2&&(t=t.parentNode),l=t.removeChild(t.firstChild),t=t.appendChild(u.createElement(r.expression.value)),t.appendChild(l);else if(r.grouping)switch(r.grouping){case"(":c++;t=t.appendChild(u.createElement("Bracket"));break;case")":for(c--;t.tagName.toLowerCase()!=="bracket"&&checkExists(t.parentNode)&&t.parentNode.tagName.toLowerCase()!=="conditions";)t=t.parentNode;t=t.parentNode}}if(o&&!f)return{value:u.xml,display:n.previewText};if(f)popupManager.showError(Resources.Filtering.InvalidCondition,Resources.Filtering.InvalidCondition);else{var w={headerText:Resources.Filtering.ConditionsValidationTitle,message:Resources.Filtering.ConditionsValidationMessage};popupManager.showNotification(w)}return!1},_formatEquationNode:function(n){var f=["InstanceID","SubFormID","SubFormInstanceID"];this.addPrefixToAttributesOnXmlNode(n,"Source",f);this.mergeSubFormInstanceID(n);var r=[n];n.getAttribute("SourceType")==="Value"&&n.selectNodes(".//SourceValue").length>0&&(r=n.selectNodes("SourceValue/Item"));for(var q=0,q=0;q<r.length;q++){var t=r[q];if(this.addPrefixToAttributesOnXmlNode(t,"Source",f),this.mergeSubFormInstanceID(t),checkExists(t.getAttribute("TargetPath"))){t.removeAttribute("id");t.removeAttribute("Name");var u=t.getAttribute("SourceID").split("_");checkExists(u)&&u.length===2&&t.setAttribute("SourceID",u[1])}}return n},addPrefixToAttributesOnXmlNode:function(n,t,q){if(checkExists(n)&&checkExists(q)&&q.length!==0)for(var r=0,u="",r=0;r<q.length;r++)u=n.getAttribute(q[r]),checkExists(u)&&(n.setAttribute("{0}{1}".format(t,q[r]),u),n.removeAttribute(q[r]))},mergeSubFormInstanceID:function(n){if(checkExists(n)){var t=n.getAttribute("SourceSubFormInstanceID"),q=n.getAttribute("SourceInstanceID");checkExistsNotEmptyGuid(q)&&checkExistsNotEmpty(q)||!(checkExistsNotEmptyGuid(t)||checkExistsNotEmpty(t))||(n.setAttribute("SourceInstanceID",t),n.removeAttribute("SourceSubFormInstanceID"))}},setConfigurationXml:function(n,t){this.targetContextContainer=t;n&&(n.xml?this.load(n.xml):this.load(n))},getConfigurationXML:function(){var n=this.expressionWidget._validateGroupings(this.expressionWidget);return n?this.constructXml(this):(popupManager.showWarning(Resources.Filtering.UnclosedParenthesisValidationMessage),!1)},dispose:function(){jQuery("#ConditionGridDiv").remove();jQuery("#ExpressionDiv").remove();jQuery("#PreviewDiv").remove()},getSettings:function(){return{dropTolerance:"pointer",dropElements:this.dropElements}}};function ConditionGrid(){}ConditionGrid.prototype={_isRuntime:!1,initialize:function(n){this._isRuntime=SourceCode.Forms.Layout.isRuntime();var t=this;this.allowMultipleItems=this.parentWidget.options&&this.parentWidget.options.allowMultipleItems?this.parentWidget.options.allowMultipleItems:!1;var u=Resources.CommonLabels.ConditionsText;t.Heading&&(u=t.Heading);var e=SCGrid.html({id:"ConditionGrid",header:u,fullsize:!0,toolbars:1,scrolling:!0,resources:{emptygrid:Resources.CommonPhrases.EmptyGridMessageText},columns:[{display:Resources.CommonLabels.RowNumberLabelText,name:"numberColumn",width:"30px",sortable:!1,align:"center",datatype:"number"},{display:Resources.CommonLabels.LeftLabelText,name:"leftColumn",width:"150px",sortable:!1,align:"left",datatype:"text"},{display:Resources.CommonLabels.OperatorLabelText,name:"operatorColumn",width:"190px",sortable:!1,align:"left",datatype:"text"},{display:Resources.CommonLabels.RightLabelText,name:"rightColumn",width:"150px",sortable:!1,align:"left",datatype:"text",modulus:!0}]}),r=jQuery(e).appendTo(n);t._grid=jQuery(r).grid();var o={rowselect:t._rowSelected.bind(t)};t._grid.grid("option",o);t.leftDropboxes=[];t.rightDropboxes=[];var q=jQuery(r).grid("fetch","toolbars").toolbargroup("fetch","toolbars").eq(0).toolbar();q.toolbar("add","button",{id:"addButton_ConditionWidget",icon:"add",text:Resources.CommonActions.AddText,description:Resources.Filtering.AddConditionTooltip});q.toolbar("add","button",{id:"deleteButton_ConditionWidget",icon:"delete",text:Resources.CommonActions.RemoveText,description:Resources.Filtering.RemoveConditionTooltip,disabled:!0});q.find(".toolbar-button").each(function(){switch($(this).attr("id")){case"addButton_ConditionWidget":$(this).find(".button-text").before('<svg width="16" height="16"><use xlink:href="#svg-icon-add" /><\/svg>');break;case"deleteButton_ConditionWidget":$(this).find(".button-text").before('<svg width="16" height="16"><use xlink:href="#svg-icon-delete" /><\/svg>')}$(this).addClass("style-aware")});var f=q.toolbar("fetch","buttons");jQuery(f[0]).on("click",t,t.addCondition);jQuery(f[1]).on("click",t,t.deleteCondition);return r},_rowSelected:function(){$("#deleteButton_ConditionWidget").removeClass("disabled")},load:function(n){this._grid.grid("fetch","rows").length>0&&(this._grid.grid("clear"),this.leftDropboxes=[],this.rightDropboxes=[]);for(var r=n.length,t=0;t<r;t++){var q=n[t];this.addRow(this,q.number,q)}this.parentWidget.targetContextContainer&&(this.parentWidget.targetContextContainer.targetContextCanvas("add","dropElements",this.parentWidget.dropElements),this.parentWidget.targetContextContainer.targetContextCanvas("addDragDrop"));setTimeout(function(){this._grid.grid("synccolumns");SourceCode.Forms.Browser.webkit&&(this._grid.hide(),setTimeout(function(){this._grid.show()}.bind(this),0))}.bind(this),0)},addCondition:function(n){var t=this;n&&n.data&&(t=n.data);t.addRow(t);checkExists(t.parentWidget.expressionWidget)&&($("#addButton_ExpressionWidget").removeClass("disabled"),t.parentWidget.expressionWidget.addExpression())},addRow:function(n,t,q){var c=n._grid;checkExists(t)&&parseInt(t)||(t=jQuery(c).grid("fetch","rows").length+1);var e=[],u=SCTextbox.html({id:"txtLeft"+t}),r=SCTextbox.html({id:"txtRight"+t}),f="<select id='selOperator"+t+"' class='input-control icon-control'><\/select>";e.push({display:t,value:t});e.push({cellclass:"edit-mode",html:u});e.push({cellclass:"edit-mode",html:f});e.push({cellclass:"edit-mode",html:r});jQuery(c).grid("add","row",e);f=jQuery("#selOperator"+t);for(var s=n.parentWidget.equationOperators,o=0;o<s.length;o++){var h=document.createElement("option");h.innerHTML=s[o].display;h.value=s[o].value;h.className=s[o].icon;jQuery(f)[0].appendChild(h)}u=jQuery("#txtLeft"+t);r=jQuery("#txtRight"+t);u=new DropTextBox({existingElement:u.parent("div.input-control-wrapper").parent(),watermarkText:Resources.CommonActions.DropOrTypeHereText,onChangedDelegate:function(){n.save()}});r=new DropTextBox({existingElement:r.parent("div.input-control-wrapper").parent(),watermarkText:Resources.CommonActions.DropOrTypeHereText,allowMultipleItems:this.allowMultipleItems,onChangedDelegate:function(){n.save()}});n.leftDropboxes.push(u);n.rightDropboxes.push(r);n.parentWidget.dropElements.push(u);n.parentWidget.dropElements.push(r);checkExists(q)?(n._deconstructItemXml(u,q.left),f[0].value=q.operator.value,q.operator.right===!0?n._deconstructItemXml(r,q.right):(r.clear(),r.disable())):(n.parentWidget.targetContextContainer&&(n.parentWidget.targetContextContainer.targetContextCanvas("add","dropElements",n.parentWidget.dropElements),n.parentWidget.targetContextContainer.targetContextCanvas("addDragDrop")),n.save());jQuery(f).on("change",{control:f,widget:n,right:r},n._changeOperator).dropdown();jQuery(f).dropdown("refresh");this._bindActiveEvents(u.element.find("input"));this._bindActiveEvents(r.element.find("input"))},_bindActiveEvents:function(n){n.on("focus",function(){jQuery(this).closest(".text-input").addClass("active")});n.on("focusout",function(){jQuery(this).closest(".text-input").removeClass("active")})},_changeOperator:function(n){var t=this;n&&n.data&&(t=n.data);var e=t.control,r=t.widget,o=e[0].value,u=r.parentWidget.getEquationOperatorItem(o),q=t.right,f=q.isEnabled();u.right===!1&&f?(q.clear(),q.disable()):u.right!==!0||f||q.enable();r.save()},deleteCondition:function(n){var t=this;if(n&&n.data&&(t=n.data),!$("#deleteButton_ConditionWidget").hasClass("disabled")){var q=t._grid,r=q.grid("fetch","selected-rows");if(r.length>0){var u={headerText:Resources.Filtering.ConditionWidgetRemoveNotificationHeader,message:Resources.Filtering.ConditionWidgetRemoveNotificationText,onAccept:function(){t._removeConditionCompletely(t)}.bind(t)};popupManager.showConfirmation(u)}$("#deleteButton_ConditionWidget").addClass("disabled")}},_removeConditionCompletely:function(n){popupManager.closeLast();var u=n._grid.grid("fetch","selected-rows"),r=u[0].rowIndex+1,t=n.parentWidget.innerEquations;t=t.filter(function(n){return n.number!==r});for(var q=0;q<t.length;q++)t[q].number>r&&t[q].number--;n.load(t);n.parentWidget.innerEquations=t;n.parentWidget.expressionWidget.removeExpressionInstance(r);n.parentWidget.reload()},_constructItemXml:function(n){var a=null,f=$xml("<Item/>"),u=f.documentElement;if(n.containsText&&checkExists(n.text)&&n.text.length>0){u.setAttribute("SourceType","Value");u.setAttribute("DataType","Text");var w=f.createElement("SourceValue");u.appendChild(w);var d=f.createTextNode(n.text);return w.appendChild(d),u}var q=[];if(n.multipleValues&&n.dropObjects.length>0)q=n.dropObjects,q=q.filter(n=>n);else if(checkExists(n.dropObject))Array.isArray(n.dropObject)?q=n.dropObject:q.push(n.dropObject);else return null;u.setAttribute("SourceType","Value");for(var l=f.createElement("SourceValue"),v=0;v<q.length;v++){var t=f.createElement("Item"),e=q[v];if(e.data){jQuery.each(e.data,function(n,q){t.setAttribute(n,q)});var o=t.getAttribute("ItemType");if(o)switch(o.toLowerCase()){case"methodreturnedproperty":o="ObjectProperty"}t.setAttribute("SourceType",o);var r=null;(o==="ViewParameter"||o==="FormParameter")&&(r=t.getAttribute("Name"));var y=t.getAttribute("SourceName"),s=t.getAttribute("Name");s===null&&(s=e.value);checkExistsNotEmpty(s)&&y!=s&&t.setAttribute("SourceName",s);y=t.getAttribute("SourceDisplayName");var h=t.getAttribute("DisplayName");if(h===null&&(h=e.display),checkExistsNotEmpty(h)&&y!=h&&t.setAttribute("SourceDisplayName",h),!checkExists(r)&&(r=t.getAttribute("Guid"),checkExists(r)||(r=t.getAttribute("Name")),!this._isRuntime&&!checkExists(r)&&SourceCode.Forms.DependencyHelper.hasValidationStatusError(t))){var b=t.getAttribute("ValidationMessages");if(checkExists(b)){var g=SourceCode.Forms.Services.AnalyzerResourcesService(),p=g.parseValidationMessage(b);checkExists(p[0])&&checkExists(p[0].guid)&&(r=p[0].guid)}}t.setAttribute("SourceID",r||"");var c="text",k=t.getAttribute("DataType")?t.getAttribute("DataType"):t.getAttribute("SubType");if(k)switch(k.toLowerCase()){case"autonumber":case"number":case"decimal":c="number";break;case"datetime":c="datetime";break;case"yesno":case"boolean":c="boolean";break;case"guid":case"autoguid":c="guid"}t.setAttribute("DataType",c);q.length==1?a=t:l.appendChild(t)}else e.length>0&&(t.setAttribute("DataType","Text"),t.setAttribute("SourceType","Value"),t.appendChild(f.createTextNode(e)),l.appendChild(t))}return l.childNodes.length>0&&(u.appendChild(l),a=u),a},_deconstructItemXml:function(n,t){if($chk(t)){var f=function(n,t,q){var l=function(n,t,q,r){return checkExistsNotEmpty(t)&&t!=="00000000-0000-0000-0000-000000000000"?(n.SubFormID=t,checkExistsNotEmpty(q)&&q!=="00000000-0000-0000-0000-000000000000"&&checkExists(r.getAttribute("SourceSubFormInstanceID"))&&(n.SubFormInstanceID=q)):checkExistsNotEmpty(q)&&q!=="00000000-0000-0000-0000-000000000000"&&(n.InstanceID=q),n};if($chk(q)){var h=q.getAttribute("SourceType"),r={};if(!n._isRuntime&&SourceCode.Forms.DependencyHelper.hasValidationStatusError(q)){if(q.getAttribute("SourceID")===null)return;var w=n._buildDraggingNodeForErrorItem(q);t.push(w)}else if(h!=="Value"){var e=q.getAttribute("SourceID"),c=e;if((h==="ViewParameter"||h==="FormParameter")&&(!checkExistsNotEmpty(e)||e.isValidGuid())){var y=q.getAttribute("Name");checkExists(y)&&(e=y)}var o=q.getAttribute("SourceSubFormID")?q.getAttribute("SourceSubFormID"):null,u=q.getAttribute("SourceInstanceID")?q.getAttribute("SourceInstanceID"):null,a={id:e};a=l(a,o,u,q);var f=n.parentWidget.targetContextContainer.targetContextCanvas("getDraggingNode",a);if(checkExists(f))t.push(f);else{var p=q.getAttribute("SourcePath")?q.getAttribute("SourcePath"):null;checkExists(q.getAttribute("SourceID"))&&(checkExists(o)&&o!=="00000000-0000-0000-0000-000000000000"?(r.SubFormID=o,checkExists(u)&&u!=="00000000-0000-0000-0000-000000000000"&&(r.SubFormInstanceID=u)):checkExists(u)&&u!=="00000000-0000-0000-0000-000000000000"&&(r.InstanceID=u),c.isValidGuid()&&(r.Guid=c),r.id=c,r.ItemType=h);var v=r,s={id:e,SourceID:c,SourcePath:p};s=l(s,o,u,q);f=n.parentWidget.targetContextContainer.targetContextCanvas("getPartialDraggingNode",v,s);f||checkExists(q.getAttribute("Name"))&&(f=n.parentWidget.targetContextContainer.targetContextCanvas("getElementInContextTree",q.getAttribute("Name"),!0));f||(h==="ControlProperty"||h==="ControlField")&&(e=q.getAttribute("id")?q.getAttribute("id"):q.getAttribute("Name"),r.id=q.getAttribute("SourcePath"),r.ItemType="Control",checkExists(o)&&o!=="00000000-0000-0000-0000-000000000000"||(r.SubFormID=null,r.SubFormInstanceID=null),checkExists(u)&&u!=="00000000-0000-0000-0000-000000000000"||(r.InstanceID=null),v=r,s={id:e,SourceID:c,SourcePath:p},s=l(s,o,u,q),f=n.parentWidget.targetContextContainer.targetContextCanvas("getPartialDraggingNode",v,s));checkExists(f)&&t.push(f)}}else t.push(q.text);return t}},e=t.getAttribute("SourceType");if(!this._isRuntime&&e!=="Value"&&SourceCode.Forms.DependencyHelper.hasValidationStatusError(t)){if(t.getAttribute("SourceID")===null)return;var o=this._buildDraggingNodeForErrorItem(t);n.setValue(o);return}if(e==="Value"){var r=t.selectNodes("SourceValue/Item");if(r&&r.length>0){for(var q=[],u=0;u<r.length;u++){var s=r[u];f(this,q,s)}q.length>0&&n.setValue(q)}else checkExists($sn(t,"SourceValue"))&&n.setValue($sn(t,"SourceValue").text)}else{var q=[];f(this,q,t);q.length>0&&n.setValue(q)}}},_buildDraggingNodeForErrorItem:function(n){var t={},o=n.getAttribute("ValidationStatus"),q=n.getAttribute("ValidationMessages"),f=SourceCode.Forms.Services.AnalyzerResourcesService(),r=n.getAttribute("SourceType"),e=n.getAttribute("SourceID"),s=n.getAttribute("SourceSubFormID"),u=n.getAttribute("SourceInstanceID"),h=n.getAttribute("DataType");if(t.value=n.selectSingleNode("Display")!==null?n.selectSingleNode("Display").text:"",t.value===""&&(t.value=SourceCode.Forms.Designers.Common.getItemDisplayName(n)),t.display=t.value,t.tooltip=t.value,t.text=t.value,t.icon=SourceCode.Forms.Designers.Common.getItemTypeIcon(r,"")+" error",t.data={},t.data.tooltip=t.tooltip,t.data.icon=t.icon,checkExists(h)&&(t.data.DataType=h),checkExists(e)&&(t.data.Guid=e,t.data.id=e),checkExistsNotEmpty(s)?(t.data.SubFormID=s,checkExistsNotEmpty(u)&&(t.data.SubFormInstanceID=u)):checkExistsNotEmpty(u)&&(t.data.InstanceID=u),checkExists(r)&&(t.data.ItemType=r),t.status=SourceCode.Forms.DependencyHelper.getMainValidationStatus(o),t.data.ValidationStatus=o,checkExists(f)&&checkExistsNotEmpty(q)){t.tooltip=f.getValidationMessages(q).join("\n");t.data.ValidationMessages=q;t.data.tooltip=t.tooltip;var c=f.parseValidationMessage(q)[0];t.icon=SourceCode.Forms.Designers.Common.getItemTypeIcon(r,c.subType)+" error";t.data.icon=t.icon}return t},save:function(){for(var f=this._grid.grid("fetch","rows").length,t=[],n=1;n<=f;n++){var q=this.leftDropboxes[n-1],r=jQuery("#selOperator"+n),u=this.rightDropboxes[n-1];if(checkExists(q)&&checkExists(r)&&checkExists(u)){var e=this.parentWidget.getEquationOperatorItem(r[0].value);t.push({number:n,left:this._constructItemXml(q),operator:e,right:this._constructItemXml(u)})}}this.parentWidget.innerEquations=t;this.parentWidget.reload()}};function ExpressionWidget(){}ExpressionWidget.prototype={initialize:function(n){var r=Resources.CommonLabels.ExpressionsText;this.Heading&&(r=this.Heading);var f='<div id="watermarkDivs" class="panel-watermark">'+Resources.CommonPhrases.NoItemsToDisplay+"<\/div>",e=SCPanel.html({id:"ExpressionPanel",header:r,fullsize:!0,toolbars:1,scrolling:!0,content:f}),q=jQuery(e).appendTo(n);this._panel=jQuery(q).panel().panel("fetch","body");var t=jQuery(q).panel("fetch","toolbars").eq(0);checkExists(t)&&t.hasClass("toolbar-wrapper")&&(t=t.closest(".toolbar"));t.toolbar();t.toolbar("add","button",{id:"addButton_ExpressionWidget",icon:"add",text:Resources.CommonActions.AddText,description:Resources.Filtering.AddExpressionTooltip,disabled:!0});t.toolbar("add","button",{id:"deleteButton_ExpressionWidget",icon:"delete",text:Resources.CommonActions.RemoveText,description:Resources.Filtering.RemoveExpressionTooltip,disabled:!0});t.find(".toolbar-button").each(function(){switch($(this).attr("id")){case"addButton_ExpressionWidget":$(this).find(".button-text").before('<svg width="16" height="16"><use xlink:href="#svg-icon-add" /><\/svg>');break;case"deleteButton_ExpressionWidget":$(this).find(".button-text").before('<svg width="16" height="16"><use xlink:href="#svg-icon-delete" /><\/svg>')}$(this).addClass("style-aware")});var u=t.toolbar("fetch","buttons");jQuery(u[0]).on("click",this,this.addExtraExpression);jQuery(u[1]).on("click",this,this._removeLastExpression);return q},load:function(n){var u=this._panel;this._panel.children().each(function(){var n=$(this);n.is("#watermarkDivs")||n.remove()});for(var q=n.length,t=0;t<q;t++){var r=n[t];$("#addButton_ExpressionWidget").removeClass("disabled");this.addExpression(r)}q===0&&$("#watermarkDivs").show()},addExpression:function(n){var t=this.parentWidget.conditionGrid._grid.grid("fetch","rows").length,q=this._panel;if(!$("#addButton_ExpressionWidget").hasClass("disabled")){if(checkExists(n)&&n.grouping){var r=n.grouping,u;r==="("?(q.children(".grouping-button").length===0&&t>0&&this._addGroupingButton(this),u=this._addGroupingButton(this)):u=q.children(".grouping-button").last();this._updateGroupingButtonDisplay(u,r,this);r===")"&&this._addGroupingButton(this)}else{if(q.children(".grouping-button").length===0&&t>0&&this._addGroupingButton(this),checkExists(n)){if(n.number){var f=this._addDropdown(this,"expression-number");this._updateExpressionSelectorDropdown(f,t,n.number)}else if(n.expression){var f=this._addDropdown(this,"expression-operator");this._updateExpressionOperatorDropdown(f,n.expression.value)}}else{if(q.children(".grouping-button").length>1&&t>0){var f=this._addDropdown(this,"expression-operator");this._updateExpressionOperatorDropdown(f);this._addGroupingButton(this)}var o=this._addDropdown(this,"expression-number");this._updateExpressionSelectorDropdown(o,t,t);o.appendTo(q);this._updateExpressionSelectorCounts(q,t)}t>0&&this._addGroupingButton(this);n||this.save()}q.children(".grouping-button").length>2&&$("#deleteButton_ExpressionWidget").removeClass("disabled");for(var s=q.find("#watermarkDivs"),e=0;e<s.length;e++)jQuery(s[e]).hide()}},_removeLastExpression:function(n){var q=this;n&&n.data&&(q=n.data);for(var t=q.parentWidget.expressionValues,n=t.length-1,u=null,r=n;r>0;r--)if(t[r].number){u=t[r];n=r;break}if(t.remove(u),n<t.length&&t[n].expression?(t.remove(t[n]),n=n-2):t[n-1].expression?(t.remove(t[n-1]),n=n-2):n--,n>=0&&n+1<t.length&&t[n].grouping&&t[n+1].grouping){var f=t[n+1].grouping,e=t[n].grouping;f!==e&&(t.remove(t[n+1]),t.remove(t[n]),n<t.length&&t[n].expression?t.remove(t[n]):n>0&&t[n-1].expression&&t.remove(t[n-1]))}q.parentWidget.expressionValues=t;q.load(t);q.parentWidget.reload()},_updateExpressionOperatorDropdown:function(n,t){for(var r=this.parentWidget.expressionOperators,q=0;q<r.length;q++){var u=document.createElement("option");u.innerHTML=r[q].display;u.value=r[q].value;u.className=r[q].icon;jQuery(n)[0].appendChild(u)}checkExists(t)&&(jQuery(n)[0].value=t);jQuery(n).dropdown("refresh")},_updateExpressionSelectorDropdown:function(n,t,q){for(var r=1;r<=t;r++){var u=document.createElement("option");u.innerHTML=r;u.value=r;jQuery(n)[0].appendChild(u)}checkExists(q)&&(jQuery(n)[0].value=q);jQuery(n).dropdown("refresh")},_updateExpressionSelectorCounts:function(n,t){for(var e=n.find(".expression-number"),u=0;u<e.length;u++){var q=e[u];if(q.length===t)break;for(var o=q.length+1,r=o;r<=t;r++){var f=document.createElement("option");f.innerHTML=r;f.value=r;jQuery(q)[0].appendChild(f)}jQuery(q).dropdown("refresh")}},_addGroupingButton:function(n,t,q){var r=jQuery("<a href='javascript:void(0);' class=\"grouping-button expression-wrapper\"><\/a>");checkExists(t)&&checkExists(q)?t==="after"?r.insertAfter(q):r.insertBefore(q):r.appendTo(n._panel);r.on("click",{widget:n},n._changeGroupingButton);return r},_updateGroupingButtonDisplay:function(n,t,q){switch(t){case"(":n.addClass("open-grouping");break;case")":n.addClass("close-grouping")}n[0].innerHTML=t;n.addClass("changed-grouping").removeClass("available-grouping");n.off("click").on("click",{widget:q,control:n,character:t},q._resetGroupingButton)},_changeGroupingButton:function(n){var t=n.data.widget,q=this,f=jQuery(q).prevAll(".expression-wrapper"),e=jQuery(q).nextAll(".expression-wrapper"),r="",u=null,o=t._checkSiblingsForPositioning(f,e,"left");if(o)r="(",u="before";else{var s=t._checkSiblingsForPositioning(f,e,"right");s&&(r=")",u="after")}checkExists(u)&&(t._addGroupingButton(t,u,q),t._updateGroupingButtonDisplay(jQuery(q),r,t),t._determineClickableOptions(t,q,r),t.save())},_checkSiblingsForPositioning:function(n,t,q){var r=!1;return q==="left"?n.length===0?r=!0:jQuery(n[0]).hasClass("expression-operator")||jQuery(t[0]).hasClass("expression-number")||jQuery(t[0]).children("select").hasClass("expression-number")||jQuery(n[0]).children("select").hasClass("expression-operator")?r=!0:jQuery(t[0]).hasClass("changed-grouping")&&(r=!0):q==="right"&&(t.length===0?r=!0:jQuery(n[0]).hasClass("expression-number")||jQuery(t[0]).hasClass("expression-operator")||jQuery(n[0]).children("select").hasClass("expression-number")||jQuery(t[0]).children("select").hasClass("expression-operator")?r=!0:jQuery(n[0]).hasClass("changed-grouping")&&(r=!0)),r},_determineClickableOptions:function(n,t,q){var e=jQuery(t).find("~ .grouping-button:not(.changed-grouping)"),o=jQuery(t).prevAll(".grouping-button:not(.changed-grouping)");switch(q){case"(":for(var u=0;u<e.length;u++){var r=e[u],l=!1,s=jQuery(r).prevAll(".expression-wrapper"),h=jQuery(r).nextAll(".expression-wrapper"),c=n._checkSiblingsForPositioning(s,h,"right");if(c){jQuery(r).addClass("available-grouping").removeClass("unavailable-grouping");jQuery(r).off("click").on("click",{widget:n},n._changeGroupingButton)}else jQuery(r).addClass("unavailable-grouping").removeClass("available-grouping"),jQuery(r).off("click")}break;case")":for(var f=0;f<o.length;f++){var r=o[f],l=!1,s=jQuery(r).prevAll(".expression-wrapper"),h=jQuery(r).nextAll(".expression-wrapper"),c=n._checkSiblingsForPositioning(s,h,"left");if(c){jQuery(r).addClass("available-grouping").removeClass("unavailable-grouping");jQuery(r).off("click").on("click",{widget:n},n._changeGroupingButton)}else jQuery(r).addClass("unavailable-grouping").removeClass("available-grouping"),jQuery(r).off("click")}}n.groupingCompleted=n.groupingCompleted===!1?!0:!1;n.groupingCompleted&&n._resetSiblingClickables(t,n)},_resetGroupingButton:function(n){var t=n.data.widget,q=n.data.control,r=n.data.character;(jQuery(q).hasClass("changed-grouping")||jQuery(q).hasClass("available-grouping"))&&(t.groupingCompleted=!0,t._resetSiblingClickables(q,t));var u=t._validateGroupings(t);if(u)switch(r){case"(":var f=jQuery(q).nextAll(".close-grouping");f.addClass("available-grouping");break;case")":var e=jQuery(q).prevAll(".open-grouping");e.addClass("available-grouping")}jQuery(q).remove();t.save()},_resetSiblingClickables:function(n,t){var q=jQuery(n).siblings(".grouping-button");q.addClass("all-grouping").removeClass("available-grouping").removeClass("unavailable-grouping");jQuery(n).siblings(".grouping-button:not(.changed-grouping)").off("click").on("click",{widget:t},t._changeGroupingButton)},_addDropdown:function(n,t){var r=jQuery("<div><\/div>").appendTo(n._panel);r.addClass("expression-dropdown-container").addClass("expression-wrapper");var q=jQuery("<select><\/select>").appendTo(r).dropdown();q.addClass(t);jQuery(q).on("change",function(){n.save()});return q},addExtraExpression:function(n){var t=this;n&&n.data&&(t=n.data);$("#addButton_ExpressionWidget").hasClass("disabled")||t.addExpression()},removeExpressionInstance:function(n){for(var t=this.parentWidget.expressionValues,q=0;q<t.length;q++){var r=t[q];if(checkExists(r)&&r.number)if(n<r.number)r.number=t[q].number-1;else if(n===r.number&&(t.remove(r),t.length>0&&(q<t.length&&t[q].expression?(t.remove(t[q]),q=q-2):t[q-1].expression?(t.remove(t[q-1]),q=q-2):q--,q>=0&&q+1<t.length&&t[q].grouping&&t[q+1].grouping))){var u=t[q+1].grouping,f=t[q].grouping;u!==f&&(t.remove(t[q+1]),t.remove(t[q]),q<t.length&&t[q].expression?(t.remove(t[q]),q--):t[q-1].expression&&(t.remove(t[q-1]),q--),q=q-2)}}t.length===0&&($("#deleteButton_ExpressionWidget").addClass("disabled"),this.parentWidget.innerEquations.length===0&&$("#addButton_ExpressionWidget").addClass("disabled"));t.length===1&&($("#deleteButton_ExpressionWidget").addClass("disabled"),$("#addButton_ExpressionWidget").removeClass("disabled"));this.parentWidget.expressionValues=t;this.load(t);this.parentWidget.reload()},_validateGroupings:function(n){for(var r=n._panel.find(".expression-wrapper.changed-grouping"),t=0,q=0;q<r.length;q++){var u=jQuery(r[q]);u.hasClass("open-grouping")?t++:u.hasClass("close-grouping")&&t--}return t!==0?!1:!0},save:function(){var f=this._validateGroupings(this);if(f){for(var u=this._panel.find(".expression-wrapper"),t=[],r=0;r<u.length;r++){var q=jQuery(u[r]);if(q.hasClass("changed-grouping"))t.push({grouping:q[0].innerHTML});else{var n=q.children("select");if(n.length===0&&(n=q.next("select")),n.length>0)if(n.hasClass("expression-number"))t.push({number:parseInt(n[0].value,10)});else if(n.hasClass("expression-operator")){var e=this.parentWidget.getExpressionOperatorItem(n[0].value);t.push({expression:e})}}}this.parentWidget.expressionValues=t;this.parentWidget.reload()}}};function PreviewWidget(){}PreviewWidget.prototype={_isRuntime:!1,initialize:function(n){this._isRuntime=SourceCode.Forms.Layout.isRuntime();var t=Resources.CommonLabels.PreviewText;this.Heading&&(t=this.Heading);var r='<div id="previewWatermarkDivs" class="panel-watermark">'+Resources.CommonPhrases.NoItemsToDisplay+"<\/div>",u=SCPanel.html({id:"previewWidget",header:t,fullsize:!0,toolbars:0,scrolling:!0,content:r}),q=jQuery(u).appendTo(n);return jQuery(q).panel(),this.panel=jQuery("#previewWidget").panel("fetch","body"),q},load:function(n,t){this.panel.children().each(function(){var n=$(this);n.is("#previewWatermarkDivs")||n.remove()});this.parentWidget.previewText="";for(var r=t.length,q=0;q<r;q++)t[q].number?this._constructEquationText(n[t[q].number-1]):t[q].expression?this._constructExpressionText(t[q].expression):t[q].grouping&&this._constructGroupingText(t[q].grouping);r===0?($("#previewWatermarkDivs").show(),$("#deleteButton_ExpressionWidget").addClass("disabled"),this.parentWidget.innerEquations.length===0&&$("#addButton_ExpressionWidget").addClass("disabled")):r===1?($("#deleteButton_ExpressionWidget").addClass("disabled"),$("#addButton_ExpressionWidget").removeClass("disabled"),$("#previewWatermarkDivs").hide()):$("#previewWatermarkDivs").hide()},_constructEquationText:function(n){var t=this._deconstructEquationItemXml(n.left),q=this._deconstructEquationItemXml(n.right),r=jQuery("<span>"+t.htmlEncode()+"&nbsp;"+n.operator.preview+"&nbsp;"+q.htmlEncode()+"<\/span>");r.addClass("previewText");this.parentWidget.previewText+=t+" "+n.operator.preview+" "+q;r.appendTo(this.panel)},_constructExpressionText:function(n){var t=jQuery("<span>&nbsp;"+n.display+"&nbsp;<\/span>");this.parentWidget.previewText+=" "+n.display+" ";t.appendTo(this.panel)},_constructGroupingText:function(n){var t=jQuery("<span>"+n+"<\/span>");this.parentWidget.previewText+=n;t.appendTo(this.panel)},_deconstructEquationItemXml:function(n){var t="";if(!checkExists(n))return t;if(n.getAttribute("SourceType")==="Value"){var q=n.selectNodes("SourceValue/Item");if(q.length>0)for(var r=0;r<q.length;r++)t+=this._describeDeconstructEquationItemXml(q[r]);else t+=this._describeDeconstructEquationItemXml(n)}else t+=this._describeDeconstructEquationItemXml(n);return t},_describeDeconstructEquationItemXml:function(n){var t="";if(!checkExists(n))return t;var q=n.getAttribute("SourceType");return q==="Value"&&checkExistsNotEmpty(n.text)?t+=n.text:q==="ViewParameter"||q==="FormParameter"?t+=n.getAttribute("SourceID"):this._isRuntime?n.getAttribute("SourceDisplayName")!==null?t+=n.getAttribute("SourceDisplayName"):n.getAttribute("DisplayName")!==null?t+=n.getAttribute("DisplayName"):n.getAttribute("SourceName")!==null&&(t+=n.getAttribute("SourceName")):t+=SourceCode.Forms.Designers.Common.getItemDisplayName(n),t}};
/*!
 ~/Rules/Script/ConfigurationWidget.js
*/
var focussedTokenbox;function ConfigurationWidget(){}ConfigurationWidget.prototype={_scalePercentage:.8,containerData:null,initialize:function(){if(this.pluginReturnedId="".generateGuid()+".pluginReturned",this.forcedClick!==!0){jQuery("#ruleWizardPopup").modalize(!0).showBusy(!0);this.pluginsCount=0;var pluginsMethods=[],r=[];this.pluginsReturned=0;this.contextsXml||(this.contextsXml=parseXML("<nodes/>"));this.targetXml=parseXML("<Item/>");jQuery(document.body).on(this.pluginReturnedId,this.pluginReturn.bind(this));var f=this.Settings.length;if(!$chk(f)){var o=this.Settings.Target,s=[],e={};e.Contexts=this.Settings.Contexts;s[0]=e;this.Settings=s;f=1;checkExists(o)&&(e.Target=o)}for(var n=0;n<f;n++){var h=this.Settings[n].Target?this.Settings[n].Target.Parameters.pluginName:null,targetPluginMethod=this.Settings[n].Target?this.Settings[n].Target.Parameters.pluginMethod:null,targetPlugin=null;if(h&&targetPluginMethod){var l=getMethodByName(h,getWindowObj());targetPlugin=new l;targetPlugin.Settings=this.Settings[n].Target.Parameters;targetPlugin.dataType="target";targetPlugin.resultName=this.Settings[n].ResultName;targetPlugin.pluginReturnedId=this.pluginReturnedId;with(targetPlugin)var t=getMethodByName(targetPluginMethod,targetPlugin).bind(targetPlugin);pluginsMethods.push(t);r.push(targetPlugin);this.pluginsCount++}for(var a=this.Settings[n].Contexts.length,q=0;q<a;q++){var v=this.Settings[n].Contexts[q].PlugIn,pluginMethod=this.Settings[n].Contexts[q].Method,y=getMethodByName(v,getWindowObj()),plugin=new y;if(plugin.Settings=this.Settings[n].Contexts[q].Parameters,plugin.resultName=this.Settings[n].ResultName,plugin.pluginReturnedId=this.pluginReturnedId,targetPlugin&&plugin.equals&&plugin.equals(targetPlugin,!1,!0)&&targetPlugin.dataType!=="target|context")targetPlugin.dataType="target|context",this.pluginsCount++;else{for(var c=!1,u=0;u<r.length;u++)if(r[u].equals&&r[u].equals(plugin,!1,!0)){c=!0;break}if(!c){with(plugin){var t=getMethodByName(pluginMethod,plugin).bind(plugin);pluginsMethods.push(t)}r.push(plugin);this.pluginsCount++}}}}pluginsMethods.length===0&&this.load();for(var q=0;q<pluginsMethods.length;q++){var p=pluginsMethods[q];p.call()}pluginsMethods.length=0;r.length=0}},load:function(){var t=this;if(typeof t.pluginReturnedId!="undefined"&&t.pluginReturnedId!==null&&t.pluginReturnedId!==""&&jQuery(document.body).off(t.pluginReturnedId),jQuery("#ruleWizardPopup").modalize(!1).showBusy(!1),this.silentMap!==!0){var h=this.Settings.length,g=document.body;if(h===1){var u=0;if(this.targetXml){if(this.Settings[0].Target&&this.Settings[0].Target.Parameters.filterTypes){for(var q="",c=this.Settings[0].Target.Parameters.filterTypes.split("|"),f=0;f<c.length;f++)q.length>0&&(q+=" or "),q+="@ItemType = '"+c[f]+"'";u=this.targetXml.selectNodes("//Item["+q+"]").length}else u=this.targetXml.selectNodes("//Item").length;if(u===0&&(!checkExists(this.ignoreEmptyItemList)||this.ignoreEmptyItemList.toLowerCase()!=="true")&&!checkExists(t.value)){popupManager.showWarning(Resources.CommonPhrases.NoItemsToDisplay);return}}var l=Resources.Filtering.RulesWizardPopupHeader;this.PopupHeading&&(l=this.PopupHeading);var a=!1;this.PopupMaximizable&&(a=this.PopupMaximizable===!0||this.PopupMaximizable.toLowerCase()==="true"?!0:!1);var v=Resources.Filtering.FilterWidgetContextHeading;this.ContextHeading&&(v=this.ContextHeading);var n=null;if(this.openPopup){if(checkExists(this.Settings[0].Target)&&checkExists(this.Settings[0].Target.Widget)){switch(this.Settings[0].Target.Widget){case"BrowserNavigateMappingWidget":this.HelpID=7057;break;case"FormNavigateMappingWidget":this.HelpID=7058;break;case"ControlPropertiesMappingWidget":this.HelpID=7063}checkExists(this.TargetWidget)||(this.TargetWidget=this.Settings[0].Target.Widget)}var p=this.HelpID?this.HelpID:7053,y="";this.TargetWidget==="ConditionWidget"&&(y="id-condition-widget");n=jQuery("<div><\/div>");popupManager.showPopup({id:this.TargetWidget+"Dialog",buttons:[{type:"help",click:function(){HelpHelper.runHelp(p)}},{text:Resources.WizardButtons.OKButtonText,click:this.popupOkClick.bind(this)},{text:Resources.WizardButtons.CancelButtonText,click:this.popupCancelClick.bind(this)}],headerText:l,content:n,modalize:!0,width:Math.floor(jQuery(window).width()*this._scalePercentage),height:Math.floor(jQuery(window).height()*this._scalePercentage),maximizable:a,onMaximize:checkExists(this.PopupOnMaximize)?this.PopupOnMaximize:$.noop,onRestore:checkExists(this.PopupOnRestore)?this.PopupOnRestore:$.noop,onClose:this.popupOnClose.bind(this),cssClass:y,removeContent:!0});n.find(".pane-container").panecontainer();this.container=n}else n=this.container;var e=!0;$chk(this.Settings[0].Target)&&$chk(this.Settings[0].Target.Parameters.showContext)&&this.Settings[0].Target.Parameters.showContext.toLowerCase()==="false"?e=!1:$chk(this.TargetWidgetOptions)&&$chk(this.TargetWidgetOptions.showContext)&&this.TargetWidgetOptions.showContext.toLowerCase()==="false"&&(e=!1);n.targetContextCanvas({contextTreeTitle:v,isTreeRightAligned:!0,showContext:e,Settings:this.Settings});var w=this.Settings[0].Target?getMethodByName(this.Settings[0].Target.Widget,getWindowObj()):getMethodByName(this.TargetWidget,getWindowObj());this.mappingWidget=new w;this.mappingWidget.targetXml=this.targetXml;this.mappingWidget.Settings=this.Settings[0].Target?this.Settings[0].Target.Parameters:null;this.mappingWidget.filterTypes=this.Settings[0].Target?this.Settings[0].Target.Parameters.filterTypes:null;this.mappingWidget.resultTypes=this.Settings[0].Target?this.Settings[0].Target.Parameters.resultTypes:null;this.mappingWidget.TargetHeading=this.TargetHeading;this.mappingWidget.contextsXml=this.contextsXml;this.mappingWidget.Collections=this.Settings[0].Collections;this.mappingWidget.basicTargetContextCanvas=n;this.mappingWidget.controlID=this.controlID;this.mappingWidget.containerData=this.containerData;typeof this.TargetWidgetOptions=="string"&&(this.mappingWidget.options=JSON.parse(this.TargetWidgetOptions));var b=n.targetContextCanvas("option","targetCanvas"),initMethod=null;with(this.mappingWidget)initMethod=this.Settings[0].Target?getMethodByName(this.Settings[0].Target.Method,this.mappingWidget).bind(this.mappingWidget):getMethodByName(this.TargetWidgetMethod,this.mappingWidget).bind(this.mappingWidget);this.mappingWidget.initCallBack&&(this.mappingWidget.initCallBack=function(){t.afterPluginInit(n)});initMethod(b);this.mappingWidget.initCallBack||t.afterPluginInit(n);jQuery("#ruleWizardPopup").modalize(!1).showBusy(!1)}else{for(var o=parseXML("<Settings />"),r=0;r<h;r++){var s=o.createElement("Setting");s.setAttribute("Name",this.Settings[r].Name);s.setAttribute("ResultName",this.Settings[r].ResultName);o.documentElement.appendChild(s)}var k={targetXml:encodeURIComponent(this.targetXml.xml),contextsXml:encodeURIComponent(this.contextsXml.xml),settingsXml:encodeURIComponent(o.xml)},d={url:applicationRoot+"Rules/Mappings.aspx",type:"POST",cache:!1,data:k,async:!1,success:function(n,q){t.loadAdvancedWizardPartialPageSuccess(n,q)},error:function(n,q){t.loadAdvancedWizardPartialPageError(n,q)}};jQuery.ajax(d)}}},updated:function(){typeof this.mappingWidget.updated=="function"&&this.mappingWidget.updated()},loadAdvancedWizardPartialPageError:function(){},loadAdvancedWizardPartialPageSuccess:function(n){var _this=this,u=document.body,t=jQuery('<div id="rulesWizardContainerWrapper" class="wrapper"><\/div>');t.empty().html(n);var q=Resources.Filtering.RulesWizardPopupHeader;this.PopupHeading&&(q=this.PopupHeading);_this.mappingWidget=new AdvancedMappingWidget;var r=jQuery.popupManager.showPopup({content:t,modalize:!0,draggable:!0,id:"ruleWizardMappingPopup",headerText:q,height:Math.floor(jQuery(window).height()*this._scalePercentage),maximizable:!0,showHeaderButtons:!0,width:Math.floor(jQuery(window).width()*this._scalePercentage),buttons:[{type:"help",click:function(){var t=jQuery("#RuleMappingWizard .wizard-step-content.active"),q=t.attr("id").replaceAll("RuleMappingWizard_","").replaceAll("_wizard_step",""),n=7053;switch(q){case"Filter":n=7054;break;case"Order":n=7055;break;case"Settings":n=7056}HelpHelper.runHelp(n)}},{text:Resources.WizardButtons.PreviousButtonText,type:"backward"},{text:Resources.WizardButtons.ForwardButtonText,type:"forward"},{text:Resources.WizardButtons.FinishButtonText,type:"finish"},{text:Resources.WizardButtons.CancelButtonText,type:"cancel",id:"cancelRulesWizardButton"}],onClose:this.popupOnClose.bind(this.mappingWidget),removeContent:!0});r.show();jQuery("#RuleMappingWizard").wizard({buttons:r.children(".popup-footer").find("a.button"),cancel:function(){with(_this)_this.mappingWidget.popupCancelClick()},finish:function(){with(_this)_this.mappingWidget.popupFinishClick()},validate:this.mappingWidget.popupValidateClick.bind(this.mappingWidget),show:function(){window.setTimeout(function(){jQuery("#RuleMappingWizard").find(".wizard-step-content.active").find(".pane-container").panecontainer();_this.mappingWidget.updated()},20)}});_this._setupAdvancedMappingWidget()},_setupAdvancedMappingWidget:function(){this.mappingWidget.ContextHeading=checkExistsNotEmpty(this.ContextHeading)?this.ContextHeading:Resources.Filtering.FilterWidgetContextHeading;this.mappingWidget.Settings=this.Settings;this.mappingWidget.targetXml=this.targetXml;this.mappingWidget.contextsXml=this.contextsXml;this.mappingWidget.controlID=this.controlID;this.mappingWidget.value=this.value;this.mappingWidget.containerData=this.containerData;this.mappingWidget.TargetHeading=this.TargetHeading;this.mappingWidget.wizard=jQuery("#RuleMappingWizard");this.mappingWidget.initialize()},afterPluginInit:function(n){if(this.mappingWidget.getSettings){var t=this.mappingWidget.getSettings();t.dropTolerance&&n.targetContextCanvas("option","dropTolerance",t.dropTolerance);t.dropElements&&t.dropElements.length>0&&(n.targetContextCanvas("removeDragDrop"),n.targetContextCanvas("add","dropElements",t.dropElements),n.targetContextCanvas("addDragDrop"))}n.targetContextCanvas("add","contextXML",this.contextsXml);n.targetContextCanvas("attemptToExpandContextTree");this.mappingWidget.setConfigurationXml(this.value,n);n.find(".pane-container").panecontainer();n.find(".pane-container").children(".pane:first-child").find(".toolbar").length===0&&n.find(".pane-container").children(".pane:last-child").css("top","0px")},pluginReturn:function(n){var t=this,r=n.detail.xml,f=n.detail.type,u=n.detail.resultName;if(t.pluginsReturned++,r.documentElement){var q;if(f==="context"){var o=r.documentElement.getAttribute("ItemType"),s=r.documentElement.getAttribute("text"),e=t._getContextTreePosition(t.contextsXml.documentElement,o,s);q=r.documentElement.cloneNode(!0);$chk(u)&&q.setAttribute("ResultName",u);e===t.contextsXml.documentElement.childNodes.length?t.contextsXml.documentElement.appendChild(q):t.contextsXml.documentElement.insertBefore(q,t.contextsXml.documentElement.childNodes[e])}else f==="target"&&(q=r.documentElement.cloneNode(!0),$chk(u)&&q.setAttribute("ResultName",u),t.targetXml.documentElement.appendChild(q))}t.pluginsReturned===t.pluginsCount&&(jQuery("#ruleWizardPopup").modalize(!1).showBusy(!1),t.load())},save:function(){var n=this.mappingWidget.getConfigurationXML();if(typeof n=="boolean"&&n===!1)return!1;$chk(this.returnDisplay)?(this.display=n.returnDisplay,this.value=n.value):n.display?(this.display=n.display,this.value=n.value):this.value=n;var t=this.onWidgetCompleted(this);return typeof t=="undefined"||t===null||t===!0?(this.container&&this.container.isWidget("targetContextCanvas")&&this.container.targetContextCanvas("destroy"),this.mappingWidget&&this.mappingWidget.dispose(),!0):!1},onWidgetCompleted:function(n){SourceCode.Forms.Designers.Rule.onWidgetCompleted(n)},popupOkClick:function(){var n=this.save();return n&&this.openPopup&&(this.successFullyConfigured=!0,popupManager.closeLast()),n},popupCancelClick:function(){this.openPopup?popupManager.closeLast():(this.container&&this.container.isWidget("targetContextCanvas")&&this.container.targetContextCanvas("destroy"),this.mappingWidget&&this.mappingWidget.dispose())},popupOnClose:function(){if(this.container&&this.container.isWidget("targetContextCanvas")&&this.container.targetContextCanvas("destroy"),this.mappingWidget&&this.mappingWidget.dispose(),!this.successFullyConfigured&&checkExists(SourceCode.Forms.Designers)&&checkExists(SourceCode.Forms.Designers.Rule))SourceCode.Forms.Designers.Rule.onWidgetCancelled(this)},_getContextTreePosition:function(n,t,q){q=q.toLowerCase();var f=0;switch(t){case"SystemValues":f=0;break;case"Form":case"View":var r=n.selectNodes("node[@ItemType='"+t+"']");if(r.length===0){if(t==="View")return n.childNodes.length;var e=n.selectSingleNode("node[@ItemType='View']");return e?ConfigurationWidget.prototype._getNodePosition(n.childNodes,e):n.childNodes.length}for(var o=r.length,u=0;u<o;u++){var s=r[u].getAttribute("text").toLowerCase();if(q<s)return ConfigurationWidget.prototype._getNodePosition(n.childNodes,r[u])}return ConfigurationWidget.prototype._getNodePosition(n.childNodes,r[o-1])+1;default:f=n.childNodes.length}return f},_getNodePosition:function(n,t){for(var r=n.length,q=0;q<r;q++)if(n[q]===t)return q;return-1}};TargetContextCanvas={_viewContextSettings:null,_create:function(){this.draggingTree=null;this.draggingNode=null;var u={};u.autosize=!0;this.options.dragTolerance||(this.options.dragTolerance="pointer");this.treeBorder=jQuery('<div class="mapping-tree-section"><\/div>');this.treeBorder.closest(".popup-body-content").append(this.ghostItem);this.contentBorder=jQuery('<div class="mapping-content-section"><\/div>');this.paneContainer=jQuery('<div class="pane-container vertical"><div class="pane" data-options="'+jQuery.toJSON(u).htmlEncode()+'"><\/div><div class="pane"><\/div><\/div>');this.options.isTreeRightAligned&&(this.treeBorder.addClass("rightAlign"),this.contentBorder.addClass("rightAlign"));this.element.addClass("wrapper").addClass("target-context-canvas");this.element.append(this.paneContainer);this.element.children(".pane-container").children(".pane:last-child").append(this.treeBorder);this.element.children(".pane-container").children(".pane:last-child").append(this.contentBorder);var q=jQuery('<div class="mapping-tab-context-tree-section"><\/div>'),r=jQuery("<div><\/div>");this.treeBorder.append(r);r.panel({fullsize:!0,header:this.options.contextTreeTitle,scrolling:!0});this.treeBorder.addClass("notab");q.addClass("notab");r.panel("fetch","body").append(q);var e=this;if(this.contextTree=jQuery('<ul class="tree collapsed-root"><li class="root children open"><a href="javascript:;">Root<\/a><\/li><\/ul>').appendTo(q).tree({autoExpand:!0,draggable:"a:not(.not-draggable)",buildTooltip:!0,refreshDraggingPositions:!1,renderObjectModel:!0,treedragoptions:{scroll:!1,draggableWidgetName:"SFCdraggable"}}),this.options.contextXML&&this.options.contextXML.xml){this.contextTree.tree("loadXML",this.options.contextXML);this.contextTree.on("treeexpand",function(n,t){e.partialLoadContextTree(t)})}if(this.options.showContext===undefined||this.options.showContext||(this.treeBorder.hide(),this.contentBorder.css("left","0px"),this.contentBorder.removeClass("rightAlign")),this._viewContextSettings=null,checkExists(this.options.Settings)&&Array.isArray(this.options.Settings))for(var f=0;f<this.options.Settings.length;f++){var n=this.options.Settings[0];if(checkExists(n.Contexts)&&Array.isArray(n.Contexts)){for(var t=n.Contexts.length;t--;t>=0)if(n.Contexts[t].PlugIn==="ViewContextPlugIn"){this._viewContextSettings=n.Contexts[t].Parameters;break}if(checkExists(this._viewContextSettings))break}}},setContextNode:function(n){if(!getNodeAttribute("ItemType",n,!1,checkExists))return!1;var t={};t.text=t.display=getNodeAttribute("text",n,null,checkExistsNotEmpty);t.hasChildren=n.childNodes.length>0;t.icon=getNodeAttribute("icon",n,null,checkExists);t.id=getNodeAttribute("id",n,null,checkExists);t.name=getNodeAttribute("Name",n,null,checkExists);t.data={};for(var q=0,u=n.attributes.length;q<u;q++)t.data[n.attributes[q].name]=n.attributes[q].value;t.value=getNodeAttribute("id",n,getNodeAttribute("Name",n,null,checkExists),checkExists);for(var r=t.display;checkExists(n.parentNode)&&getNodeAttribute("text",n.parentNode,!1,checkExists);)n=n.parentNode,r=getNodeAttribute("text",n,getNodeAttribute("ItemType",n,"",checkExistsNotEmpty),checkExistsNotEmpty)+" - "+r;return t.tooltip=r,t},setDraggingNode:function(n){if(!n.ItemType)return!1;var t=$.extend({},n);return t.hasChildren=checkExists(n.children)&&n.children.length>0,t.display=n.text,t.value=n.id?n.id:n.name,t.data=$.extend({},n),t},getContextNode:function(n){for(var q=n.item,f=n.document,r="//node",t=0,e=q.attributes.length;t<e;t++)q.attributes[t].name!=="ContextType"&&q.attributes[t].value!=="context"&&q.attributes[t].value!=="00000000-0000-0000-0000-000000000000"&&checkExistsNotEmpty(q.attributes[t].value)&&(r+="[@"+q.attributes[t].name+"='"+q.attributes[t].value+"']");var u=f.selectSingleNode(r);return $chk(u)?this.setContextNode(u):null},getDraggingNode:function(n){var t=this.contextTree.tree("findModelObject",n);return t!==null?this.setDraggingNode(t):null},getPartialDraggingNode:function(n,t){var q=this.contextTree.tree("findModelObject",n);return q&&this.partialPopulateTreeModel({metadata:q}),this.getDraggingNode(t)},findModelObject:function(n){return this.contextTree.tree("findModelObject",n)},getDragElement:function(n){this.ghostItem=jQuery('<div style="" class="tree"><li class="mapping-tab-drag-item"><a class="mapping-tab-drag-item-a"><\/a><\/li><\/div>');this.ghostItem.hide();this.ghostItem.hide();var t=this.ghostItem.find("li").eq(0),q=t.find("a").eq(0);return this.draggingTree=this.contextTree,this.draggingNode=this.setDraggingNode(jQuery(n.target).parent().metadata()),t.addClass(this.draggingNode.data.icon),q.text(this.draggingNode.text),this.ghostItem.show(),this.ghostItem},attemptToExpandContextTree:function(){var n=this,t=this.contextTree.tree("find","root");t.find("> ul >li.children").each(function(){var t=jQuery(this);t.metadata()&&t.metadata().id!=="environmentFieldsRoot"&&t.metadata().id!=="systemValuesRoot"&&n.contextTree.tree("expand",t)})},getElementInContextTree:function(){var n=arguments[0],q=arguments[1],t=null;return checkExists(n)?(t=q?this.contextTree.tree("findModelObject",{Name:n}):this.contextTree.tree("findModelObject",{id:n}),t!==null?this.setDraggingNode(t):null):null},option:function(){if(arguments[0]==="targetCanvas")return this.contentBorder},add:function(){var n=this;if(arguments[0]==="dropElement")this.options.dropElements||(this.options.dropElements=[]),this.options.dropElements.push(arguments[1]);else if(arguments[0]==="dropElements")this.options.dropElements=arguments[1];else if(arguments[0]==="contextXML"){this.options.contextXML=arguments[1];this.contextTree.tree("loadXML",this.options.contextXML);this.contextTree.on("treeexpand",function(t,q){n.partialLoadContextTree(q)})}},partialPopulateTreeModel:function(n){var t=n.metadata;if(checkExists(t)&&checkExists(t.dynamic)&&!t.dynamicloaded&&t.ItemType==="Control"){var u=t.InstanceID,q=t.SubFormID,r=t.SubFormInstanceID;u!==""&&checkExists(q)||(u="00000000-0000-0000-0000-000000000000");q!==""&&checkExists(q)||(q="00000000-0000-0000-0000-000000000000");r!==""&&checkExists(r)||(r="00000000-0000-0000-0000-000000000000");var f=SourceCode.Forms.Designers.Common._getTransformedControlTypePropertyXml({id:t.id,subType:t.SubType,node:null,subformId:q,instanceId:u,subformInstanceID:r,metadata:t}),e=$("nodes > node",f);this.contextTree.tree("partialLoadXmlIntoModel",{nodes:e,modelObj:t})}},partialLoadContextTree:function(n){var q=n.node,o=n.tree,t=q.metadata(),e=null;if(checkExists(t.dynamic)&&q.hasClass("children")&&!q.hasClass("dynamicloaded")){e=q.children("ul").children();var h=t.ItemType;if(h==="Control"){var c=t.Guid,l=t.SubType,r=t.InstanceID,u=t.SubFormID,f=t.SubFormInstanceID;r!==""&&checkExists(r)||(r="00000000-0000-0000-0000-000000000000");u!==""&&checkExists(u)||(u="00000000-0000-0000-0000-000000000000");f!==""&&checkExists(f)||(f="00000000-0000-0000-0000-000000000000");var a=SourceCode.Forms.Designers.Common._getTransformedControlTypePropertyXml({id:c,subType:l,node:n.node,subformId:u,instanceId:r,subformInstanceID:f,metadata:t,viewContextSettings:this._viewContextSettings});if(t.open=!0,o.tree("loadXML",a,q,!1,t),e.length>0){var s=q.children("ul").children(),v=$(s[s.length-1]);e.insertAfter(v)}o.tree("applyDragHandlers",q);q.addClass("dynamicloaded")}}},addDragDrop:function(){var _this=this;with(_this){this.dropElements=[];for(var length=this.options.dropElements.length,j=0;j<length;j++)typeof this.options.dropElements[j]=="object"?this.dropElements.push(this.options.dropElements[j].element):this.dropElements.push(this.options.dropElements[j]);jQuery(this.dropElements).droppable({accept:".ui-draggable",tolerance:this.options.dragTolerance,drop:function(n,t){var creatLineObject=!1;if(creatLineObject=$(n.target).closest("li").length>0&&$(n.target).closest("li").metadata()&&$(n.target).closest("li").metadata()&&$(n.target).closest("li").metadata().ItemType==="ProcessItemReference"?checkExists(t.draggable.parent().metadata().ItemType)&&t.draggable.parent().metadata().ItemType==="ViewSource"?!0:!1:checkExists(t.draggable.parent().metadata().ItemType)&&t.draggable.parent().metadata().ItemType==="ViewSource"?!1:!0,creatLineObject===!1)return!1;var _draggingNode=_this.setDraggingNode(t.draggable.parent().metadata());$(n.target).trigger("dropDragElement",[_draggingNode,{left:n.clientX,top:n.clientY}])},addClasses:!1})}},removeDragDrop:function(){this.dropElements&&(jQuery(this.dropElements).droppable("destroy"),jQuery(this.dropElements).empty())}};jQuery.widget("ui.targetContextCanvas",TargetContextCanvas);jQuery.ui.targetContextCanvas.getter="getDraggingNode getElementInContextTree";function AdvancedMappingWidget(){}AdvancedMappingWidget.prototype={initialize:function(){var n=this;n.mappingWidgets=[];for(var q=0;q<n.Settings.length;q++){var o=n.wizard.wizard("find","step",q),u=jQuery("<div class='wrapper'><\/div>"),t=n.Settings[q],c=jQuery(SourceCode.Forms.Controls.ToolbarGroup.html()).toolbargroup().toolbargroup("addtoolbar");o.find(".pane-container > .pane:first-child").append(c);u.appendTo(o);var s=!0;t.Target.Parameters.showContext!==undefined&&t.Target.Parameters.showContext.toLowerCase()==="false"&&(s=!1);u.targetContextCanvas({contextTreeTitle:n.ContextHeading,isTreeRightAligned:!0,showContext:s});for(var h=parseXML(this.contextsXml.xml),e=h.selectNodes("nodes/node[@ResultName!='"+t.ResultName+"']"),f=e.length-1;f>=0;f--)e[f].parentNode.removeChild(e[f]);var l=t.Target?getMethodByName(t.Target.Widget,getWindowObj()):getMethodByName(n.TargetWidget,getWindowObj()),r=new l;r.initCallBack&&(r.initCallBack=function(){n.afterPluginInit(u,t,r,q)});this._setupMappingWidget(r,t,h,q,u.targetContextCanvas("option","targetCanvas"));r.initCallBack||n.afterPluginInit(u,t,r,q)}jQuery("#ruleWizardPopup").modalize(!1).showBusy(!1)},_setupMappingWidget:function(mappingWidget,currentSettings,n,t,q){mappingWidget.targetXml=this.targetXml;mappingWidget.Settings=currentSettings.Target?currentSettings.Target.Parameters:null;mappingWidget.filterTypes=currentSettings.Target?currentSettings.Target.Parameters.filterTypes:null;mappingWidget.resultTypes=currentSettings.Target?currentSettings.Target.Parameters.resultTypes:null;mappingWidget.TargetHeading=this.TargetHeading;mappingWidget.ResultName=currentSettings.ResultName;mappingWidget.Collections=currentSettings.Collections;mappingWidget.contextsXml=n;mappingWidget.wizard=this.wizard;mappingWidget.wizardStep=t;mappingWidget.containerData=this.containerData;var initMethod=null;with(mappingWidget)initMethod=currentSettings.Target?getMethodByName(currentSettings.Target.Method,mappingWidget).bind(mappingWidget):getMethodByName(this.TargetWidgetMethod,mappingWidget).bind(mappingWidget);initMethod(q)},afterPluginInit:function(n,t,q,r){var f=this;if(q.getSettings){var u=q.getSettings();u.dropTolerance&&n.targetContextCanvas("option","dropTolerance",u.dropTolerance);u.dropElements&&u.dropElements.length>0&&(n.targetContextCanvas("removeDragDrop"),n.targetContextCanvas("add","dropElements",u.dropElements),n.targetContextCanvas("addDragDrop"))}n.targetContextCanvas("add","contextXML",q.contextsXml);n.targetContextCanvas("attemptToExpandContextTree");var e;$chk(f.value)&&(e=parseXML(f.value).selectNodes("Mappings/Mapping[@Type='"+t.ResultName+"']"));var o=parseXML("<Mappings><\/Mappings>");if($chk(e))for(var s=0;s<e.length;s++)o.documentElement.appendChild(e[s].cloneNode(!0));var h=q.setConfigurationXml(o.xml,n);if(h!==!0){var c=o.selectSingleNode("//Item[@Invalid='true']");(c!==null||h===!1)&&f.wizard.wizard("updateStepState",r,"error","small")}f.mappingWidgets.push(q)},updated:function(){for(var n=0;n<this.mappingWidgets.length;n++)typeof this.mappingWidgets[n].updated=="function"&&this.mappingWidgets[n].updated()},save:function(){for(var n=parseXML("<Mappings/>"),t=!1,q=0;q<this.mappingWidgets.length;q++){var r=this.mappingWidgets[q],u=r.getConfigurationXML();if(u===!1)return u;var e=parseXML(u);t=e.selectNodes('//Item[@Invalid = "true"]').length>0?!0:t;for(var o=e.selectNodes("Mappings/Mapping"),f=0;f<o.length;f++){var s=o[f];s.setAttribute("Type",r.ResultName);n.documentElement.appendChild(s)}r.dispose()}t&&n.documentElement.setAttribute("Invalid","true");this.value=n.xml;SourceCode.Forms.Designers.Rule.onWidgetCompleted(this);return!0},popupFinishClick:function(){var n=this.save();n?(this.successFullyConfigured=!0,popupManager.closeLast({removeContent:!0})):jQuery("#RuleMappingWizard").wizard("removeOverlay")},popupCancelClick:function(){popupManager.closeLast({removeContent:!0,cancelOnClose:!0,cancelClose:!1});SourceCode.Forms.Designers.Rule.isHiddenDesigner&&SourceCode.Forms.Designers.View._closeRuleWizard(!0)},popupOnClose:function(){for(var n=0;n<this.mappingWidgets.length;n++){var t=this.mappingWidgets[n];t.dispose()}if(jQuery("#RuleMappingWizard").wizard("destroy"),!this.successFullyConfigured)SourceCode.Forms.Designers.Rule.onWidgetCancelled(this)},popupValidateClick:function(n,t){var q=this.mappingWidgets.filter(function(t){return t.wizardStep===n});q=q.length>0?q[0]:null;q===null&&(q=this.mappingWidgets[n]);var r=q.getConfigurationXML();return typeof r=="boolean"&&r===!1?(checkExists(t)&&typeof t=="function"&&t(!1),!1):(checkExists(t)&&typeof t=="function"&&t(!0),!0)}};
/*!
 ~/Rules/Script/FilterWidget.js
*/
function FilterWidget(){}var FilterWidgetProtoType={_isRuntime:!1,analyzerService:null,initialize:function(n){if(this._isRuntime=SourceCode.Forms.Layout.isRuntime(),this._parentElement=n,this._isRuntime===!1&&(this.analyzerService=SourceCode.Forms.Services.AnalyzerResourcesService()),this.targetXml){this._transformXml();var t=this.targetXml.selectNodes("Items/Item[@ItemType='MethodReturnedProperty']");t.length>0?(this._populateToolbar(),this._buildUI()):this.wizard&&this.wizardStep&&this.wizard.wizard("hide","step",this.wizardStep)}},_buildUI:function(){var n=this,t={url:applicationRoot+"Rules/Filter.aspx",type:"GET",cache:!1,data:{},dataType:"text",async:!1,success:function(t,q,r){n._buildUIAjaxSuccess.call(n,t,q,r)}};jQuery.ajax(t)},_buildUIAjaxSuccess:function(n){var q=this,r=n;this._parentElement.append(r);this._parentElement.find(".pane-container").panecontainer();this._parentElement.find(".panel").panel();var u={rowselect:this._rowSelected.bind(this)},t=this._parentElement.find(".grid").grid(u);t.on("change",".operator",function(){q._operatorDropDownChange($(this))});this._populateDropDowns();window.setTimeout(function(){t.grid("synccolumns")},100);this.initCallBack()},updated:function(){this._parentElement.find(".grid").grid("syncWidths")},dispose:function(){this._parentElement.remove()},_transformXml:function(){var n=new XslTransform;n.importStylesheet(applicationRoot+"Rules/XSLT/FilterOrder.xslt");$chk(this.ResultName)&&n.addParameter("ResultName",this.ResultName);this.Settings.subformID&&n.addParameter("SubFormID",this.Settings.subformID);this.targetXml=parseXML(n.transformToText(this.targetXml))},_populateDropDowns:function(){var e=this.targetXml.selectNodes("Items/Item[@ItemType='MethodReturnedProperty']");if(e.length===0){this.wizard&&this.wizardStep&&this.wizard.wizard("hide","step",this.wizardStep);return}var n=this.targetXml.selectNodes("Items/Item[@ItemType='ViewField']");this.usesFields=!0;n.length===0&&(this.usesFields=!1,n=e);var o=this._parentElement.find(".filterTemplateFieldDropDown");o.empty();for(var t=0;t<n.length;t++){var f=n[t].selectSingleNode("Name"),s=n[t].selectSingleNode("DisplayName"),h=n[t].getAttribute("Guid")?n[t].getAttribute("Guid"):f.text,l=s.text,a=n[t].selectSingleNode("ToolTip").text,v=n[t].getAttribute("Icon"),q=$("<option><\/option>").val(h).html(l.htmlEncode()).addClass(v).attr("title",a);o.append(q);var u=n[t].getAttribute("ItemType");u&&u.toLowerCase()==="methodreturnedproperty"&&(u="ObjectProperty");q.data("SourceType",u);q.data("SourceID",h);q.data("ObjectGuid",n[t].getAttribute("ContextGuid"));q.data("SubFormID",n[t].getAttribute("SubFormID"));q.data("InstanceID",n[t].getAttribute("InstanceID"));q.data("Name",checkExists(f)?f.text:"");q.data("DisplayName",s.text);var r="text",c=n[t].getAttribute("SubType");if(c)switch(c.toLowerCase()){case"autonumber":case"number":case"decimal":r="number";break;case"datetime":r="datetime";break;case"yesno":case"boolean":r="boolean";break;case"guid":case"autoguid":r="guid"}q.data("DataType",r)}},_setSimpleToolbar:function(n){var q=this,t=n.closest(".wrapper.target-context-canvas").find(".toolbar");t.length>0&&t.parent().remove();t=jQuery(SourceCode.Forms.Controls.Toolbar.html());t.toolbar();t.toolbar("add","button",{id:"addButton_FilterWidget",icon:"add",text:Resources.CommonActions.AddText,description:Resources.Filtering.AddFilterText,disabled:!1});t.toolbar("add","button",{id:"clearButton_FilterWidget",icon:"delete",text:Resources.CommonActions.RemoveText,description:Resources.Filtering.RemoveFilterText,disabled:!0});t.toolbar("add","button",{id:"clearAllButton_FilterWidget",icon:"delete-all",text:Resources.CommonActions.RemoveAllText,description:Resources.Filtering.RemoveAllFilterText,disabled:!0});t.toolbar("add","button",{id:"advancedButton_FilterWidget",icon:"advanced-filter",text:Resources.CommonActions.AdvancedText,description:Resources.Filtering.AdvancedFilterText,disabled:!1});t.find(".toolbar-button").each(function(){switch($(this).attr("id")){case"addButton_FilterWidget":$(this).find(".button-text").before('<svg width="16" height="16"><use xlink:href="#svg-icon-add" /><\/svg>');break;case"clearButton_FilterWidget":$(this).find(".button-text").before('<svg width="16" height="16"><use xlink:href="#svg-icon-delete" /><\/svg>');break;case"clearAllButton_FilterWidget":$(this).find(".button-text").before('<svg width="16" height="16"><use xlink:href="#svg-icon-delete-all" /><\/svg>');break;case"advancedButton_FilterWidget":$(this).find(".button-text").before('<svg width="16" height="16"><use xlink:href="#svg-icon-advanced-filter" /><\/svg>')}$(this).addClass("style-aware")});var u=jQuery('<div class="toolbars single"><\/div>');u.append(t);n.closest(".pane-container").children(".pane:first-child").append(u);var r=t.toolbar("fetch","buttons");jQuery(r[0]).on("click",q._addFilterRow.bind(q));jQuery(r[1]).on("click",q._removeFilterRow.bind(q));jQuery(r[2]).on("click",q._removeAllFilterRows.bind(q));jQuery(r[3]).on("click",q._advancedNewFilterClick.bind(q))},_setAdvancedToolbar:function(n){var q=this,t=n.closest(".wrapper.target-context-canvas").find(".toolbar");t.length>0&&t.parent().remove();t=jQuery(SourceCode.Forms.Controls.Toolbar.html());t.toolbar();t.toolbar("add","button",{id:"editButton_FilterWidget",icon:"edit",text:Resources.CommonActions.EditText,description:Resources.CommonActions.EditText,disabled:!1});t.toolbar("add","button",{id:"removeButton_FilterWidget",icon:"remove",text:Resources.CommonActions.RemoveText,description:Resources.CommonActions.RemoveText,disabled:!1});t.find(".toolbar-button").each(function(){switch($(this).attr("id")){case"editButton_FilterWidget":$(this).find(".button-text").before('<svg width="16" height="16"><use xlink:href="#svg-icon-edit" /><\/svg>');break;case"removeButton_FilterWidget":$(this).find(".button-text").before('<svg width="16" height="16"><use xlink:href="#svg-icon-delete" /><\/svg>')}$(this).addClass("style-aware")});var r=jQuery('<div class="toolbars single"><\/div>');r.append(t);n.closest(".pane-container").children(".pane:first-child").append(r);var u=t.toolbar("fetch","buttons");jQuery(u[0]).on("click",q._editFilterRow.bind(q));jQuery(u[1]).on("click",q._changeToBasic.bind(q))},_populateToolbar:function(){this._setSimpleToolbar(this._parentElement)},initCallBack:function(){},setConfigurationXml:function(n,t){if(n){var et=parseXML(n),u=et.selectSingleNode("/Mappings/Mapping/Filter");if(u){var b=u.getAttribute("isSimple");if(b&&b==="True"){var k=this._parentElement.find(".grid").grid(),d=u;u.selectSingleNode("And")&&(d=u.selectSingleNode("And"));for(var o=d.selectNodes("./*"),s=0;s<o.length;s++){var ot=o[s].nodeName,g=o[s].selectNodes("./*"),r="",h="",c="",q=null;this._populateDropDowns();for(var a=0;a<g.length;a++)if(q=g[a],c=q.getAttribute("SourceType"),c==="Value"){h=[];var f,nt=q.selectSingleNode("SourceValue");if(checkExists(nt))for(var tt=nt.selectNodes("Item"),v=0;v<tt.length;v++)f=this._fromSourceValue(tt[v],t),checkExists(f)&&h.push(f);else f=this._fromSourceValue(q,t),checkExists(f)&&h.push(f)}else if(r=q.getAttribute("SourceID"),this._isRuntime===!1&&(q.getAttribute("Invalid")==="true"||SourceCode.Forms.DependencyHelper.hasValidationStatusError(q))){var st=q.getAttribute("ValidationStatus"),qt=this._parentElement.find(".filterTemplateFieldDropDown"),y=q.getAttribute("ValidationMessages"),rt=q.getAttribute("SourceID")?q.getAttribute("SourceID"):q.getAttribute("SourceName");rt+="_Invalid";r+="_Invalid";var ht=SourceCode.Forms.Designers.Common.getItemDisplayName(q),p="";if(checkExists(y)){var ct=SourceCode.Forms.Services.AnalyzerResourcesService();p=ct.getValidationMessages(y).join("\n")}var l=$("<option><\/option>").val(rt).html(ht.htmlEncode()).addClass("error").attr("title",p);l.data("ValidationStatus",st);l.data("ValidationMessages",y);l.data("tooltip",p);qt.append(l);qt.on("change",this.updateDropDownFields.bind(this))}else if(c==="ObjectProperty"&&this.usesFields){var e=q.getAttribute("Name");if(!checkExistsNotEmpty(e)){var ut=this.targetXml.selectSingleNode("Items/Item[@ItemType='MethodReturnedProperty'][Name='{0}']".format(r));checkExists(ut)&&(e=ut.getAttribute("ContextGuid")+"_"+r)}if(checkExistsNotEmpty(e)){var w=e.split("_"),lt=w[0];w.shift();var at=w.join("_");r=this.targetXml.selectSingleNode("Items/Item[(FieldObject='{0}' or @FieldObject='{0}' or (ObjectGuid='{1}' and Name='{2}')) and @ItemType='ViewField']/@Guid".format(e,lt,at)).text}}else c!=="ViewField"||this.usesFields||(r=this.targetXml.selectSingleNode("Items/Item[@ItemType='ViewField' and @Guid='{0}']/Name".format(r)).text);var ft=this._parentElement.find(".filterTemplateFieldDropDown");ft.removeClass("filterTemplateFieldDropDown");k.grid("add","edit-template",[r,ot,h]);ft.addClass("filterTemplateFieldDropDown");this._operatorDropDownChange(k.find("#operatorDropDown"))}o.length>0&&$("#clearAllButton_FilterWidget").removeClass("disabled");(SourceCode.Forms.Browser.webkit||SourceCode.Forms.Browser.msie)&&setTimeout(function(){this._parentElement.find(".grid").grid("synccolumns");SourceCode.Forms.Browser.msie&&(this._parentElement.find(".grid").hide(),setTimeout(function(){this._parentElement.find(".grid").show()}.bind(this),0))}.bind(this),0)}else this.previewContainer=$("#advancedFilterPreview"),$("#simpleFilterGrid").hide(),this.previewContainer.show(),this._setAdvancedToolbar(this._parentElement),this.conditions="<Conditions>{0}<\/Conditions>".format(u.childNodes[0].xml),this.previewContainer.html(this._translateConditionsToFriendlyText())}}},updateDropDownFields:function(n){var t=$(n.currentTarget),u=t.children(".selected");if(!u.hasClass("error"))for(var r=t.children(".error"),q=0;q<r.length;q++)$(r[q]).remove();t.dropdown("refresh")},getConfigurationXML:function(){var n="";if($("#simpleFilterGrid").css("display")!=="none")n=this._getSimpleMappingXml("Filter");else{var r=parseXML(this.conditions).firstChild.firstChild;r&&(n="<Filter>{0}<\/Filter>".format(r.xml))}if(checkExists(SourceCode)&&checkExists(SourceCode.Forms)&&checkExists(SourceCode.Forms.Designers)&&checkExists(SourceCode.Forms.Designers.Rule)&&checkExists(SourceCode.Forms.Designers.Rule.EventHelper)&&checkExists(SourceCode.Forms.Designers.Rule.EventHelper.checkIfControlFilterIsValid)&&n!==""){var q=parseXML(n),t=q.selectNodes("//Item[not(@SourceType)]").length===0;if(t===!0&&checkExists(this.Settings.viewControlID)&&(t=SourceCode.Forms.Designers.Rule.EventHelper.checkIfControlFilterIsValid(q.documentElement,this.Settings.viewControlID)),t&&(t=q.selectNodes(".//Item"+SourceCode.Forms.Designers.Common.getXPathValidationStatusCondition()).length===0),t===!1)return popupManager.showError(Resources.Filtering.InvalidFilter,Resources.Filtering.InvalidFilter),!1}return'<Mappings><Mapping Type="{0}" ActionPropertyCollection="Properties">{1}<\/Mapping><\/Mappings>'.format(this.ResultName,n)},_getSimpleMappingXml:function(n){var r="",h=this._parentElement.find(".grid").grid(),o=h.grid("fetch","rows"),u=o.length;r=u===0?"":u>1?'<{0} isSimple="True"><And>{1}<\/And><\/{0}>':'<{0} isSimple="True">{1}<\/{0}>';r=r.format(n,"{0}");for(var s="",f=0;f<u;f++){var e=$(o[f]),t=e.find(".input-control.field option:selected"),q="<Item";checkExistsNotEmpty(t.data("SourceType"))&&(q+=" SourceType='{0}'".format(t.data("SourceType")));checkExistsNotEmpty(t.data("SourceID"))&&(q+=" SourceID='{0}'".format(t.data("SourceID").xmlEncode()));checkExistsNotEmpty(t.data("DataType"))&&(q+=" DataType='{0}'".format(t.data("DataType")));checkExistsNotEmpty(t.data("ObjectGuid"))&&(q+=" Name='{0}_{1}'".format(t.data("ObjectGuid"),t.data("SourceID").xmlEncode()));checkExistsNotEmpty(t.data("SubFormID"))&&(q+=" SourceSubFormID='{0}'".format(t.data("SubFormID")));checkExistsNotEmpty(t.data("InstanceID"))&&(q+=" SourceInstanceID='{0}'".format(t.data("InstanceID")));checkExistsNotEmpty(t.data("Name"))&&(q+=" SourceName='{0}'".format(t.data("Name").xmlEncode()));checkExistsNotEmpty(t.data("DisplayName"))&&(q+=" SourceDisplayName='{0}'".format(t.data("DisplayName").xmlEncode()));checkExistsNotEmpty(t.data("ValidationStatus"))&&(q+=" ValidationStatus='{0}'".format(t.data("ValidationStatus")),checkExistsNotEmpty(t.data("ValidationMessages"))&&(q+=" ValidationMessages='{0}'".format(t.data("ValidationMessages"))));q+=checkExistsNotEmpty(t.text())?">{0}<\/Item>".format(t.text().xmlEncode()):"><\/Item>";var c=e.find(".input-control.operator").val(),l=e.find(".input-control.value").tokenbox("value"),a='<Item SourceType="Value">{0}<\/Item>'.format(this._toSourceValue(l));s+="<{0}>{1}{2}<\/{0}>".format(c,q,a)}return r.format(s)},_convertSimpleXml:function(n){if(checkExists(n)&&n.length>0){var r=$xml(n),t=r.firstChild;if(checkExists(t))for(t=t.firstChild;t.childNodes.length>2;){for(var q=t.insertBefore(r.createElement(t.tagName),t.childNodes[1]);t.childNodes.length>2;)checkExists(q.firstChild)?q.insertBefore(t.lastChild,q.lastChild):q.appendChild(t.lastChild);t=q}n=r.xml}return n},_editFilterRow:function(){this._openAdvancedFilterPopup()},_addFilterRow:function(){var t=this,n=this._parentElement.find(".grid");n.grid("add","edit-template");$("#clearAllButton_FilterWidget").removeClass("disabled")},_rowSelected:function(){$("#clearButton_FilterWidget").removeClass("disabled");$("#clearAllButton_FilterWidget").removeClass("disabled")},_removeFilterRow:function(){this._parentElement.find(".grid").grid("remove","selected-rows");$("#clearButton_FilterWidget").addClass("disabled");var n=this._parentElement.find(".grid").grid("fetch","rows");n.length===0&&$("#clearAllButton_FilterWidget").addClass("disabled")},_removeAllFilterRows:function(){this._parentElement.find(".grid").grid("clear");$("#clearButton_FilterWidget").addClass("disabled");$("#clearAllButton_FilterWidget").addClass("disabled")},_changeToAdvanced:function(n){this.previewContainer=$("#advancedFilterPreview");this.previewContainer[0].innerHTML=n.htmlEncode();$("#simpleFilterGrid").hide();this.previewContainer.show();this._setAdvancedToolbar(this._parentElement)},_changeToBasic:function(){this.previewContainer=$("#advancedFilterPreview");this.previewContainer[0].innerHTML="";this.previewContainer.hide();$("#simpleFilterGrid").show().grid("synccolumns");this._setSimpleToolbar(this._parentElement)},_operatorDropDownChange:function(n){for(var t=0,u=n.length;t<u;t++){var r=$(n[t]).val(),q=$(n[t]).closest("tr").find(".input-control.value");r==="IsBlank"||r==="IsNotBlank"?(q.tokenbox("clear"),q.tokenbox("disable")):q.tokenbox("enable")}},_generateFilter:function(){return this._getSimpleMappingXml("Conditions")},_advancedNewFilterClick:function(){this.previewContainer=$("#advancedFilterPreview");var n=this._generateFilter();n&&n!==""?(this.conditions=n.xml?n.xml:n,this.previewContainer[0].innerHTML=this._translateConditionsToFriendlyText()):(this.previewContainer[0].innerHTML="",this.conditions=null);this._openAdvancedFilterPopup()},_translateConditionsToFriendlyText:function(){var n="",q=$xml(this.conditions),t=q.firstChild.firstChild;return t&&(n=this._evaluateConditionNode(t,!0)),n},_evaluateConditionNode:function(n,t){var q="";if(n.tagName==="Item")if(n.getAttribute("SourceType")==="Value")if(n.selectSingleNode("SourceValue/Item")===null)q+=$sn(n,"SourceValue").text.htmlEncode();else for(var u=n.selectNodes("SourceValue/Item"),r=0;r<u.length;r++)q+=this._constructItemXml(u[r]);else q+=this._constructItemXml(n);else n.tagName==="Bracket"?(q+=" (",q+=this._evaluateConditionNode(n.firstChild,!0),q+=")"):n.childNodes.length>0&&(t||(q+="("),q+=this._evaluateConditionNode(n.firstChild,!0),q+=" "+n.tagName,n.childNodes.length>1&&(q+=" "+this._evaluateConditionNode(n.lastChild,!0)),t||(q+=")"));return q},_constructItemXml:function(n){var t="";if(!checkExists(n))return t;var q=n.getAttribute("SourceType");return q==="Value"?t+=n.text.htmlEncode():q==="ViewParameter"||q==="FormParameter"?t+=n.getAttribute("SourceID").htmlEncode():n.getAttribute("SourceDisplayName")!==null?t+=n.getAttribute("SourceDisplayName").htmlEncode():n.getAttribute("DisplayName")!==null?t+=n.getAttribute("DisplayName").htmlEncode():n.getAttribute("SourceName")!==null?t+=n.getAttribute("SourceName").htmlEncode():n.getAttribute("Name")!==null&&(t+=n.getAttribute("Name").htmlEncode()),t},_onAdvancedFilterPopupResize:function(){this.configWidget.container.find(".pane-container:visible").panecontainer("refresh")},_openAdvancedFilterPopup:function(){var n=new FilterConfigurationWidget;n.onWidgetCompleted=this._onWidgetCompleted.bind(this);n.value=this.conditions;n.container="";n.openPopup=!0;n.PopupMaximizable=!0;n.PopupOnMaximize=this._onAdvancedFilterPopupResize.bind(this);n.PopupOnRestore=this._onAdvancedFilterPopupResize.bind(this);n.PopupHeading=Resources.Filtering.FilterWidgetPopupHeading;n.ContextHeading=Resources.Filtering.FilterWidgetContextHeading;n.TargetHeading=Resources.Filtering.FilterWidgetTargetHeading;n.TargetWidget="ConditionWidget";n.TargetWidgetMethod="initialize";n.TargetWidgetOptions='{ "allowMultipleItems": true }';n.HelpID=this.Settings.HelpID?this.Settings.HelpID:"7054";n.contextsXml=this.contextsXml;var t={};t.ResultName="Filter";t.Contexts=[];n.Settings=t;n.value=this._convertSimpleXml(n.value);n.initialize();this.configWidget=n;this.configWidget.parentWidget=this},_onWidgetCompleted:function(n){var q=n.display,t=n.value,u=n.data;q||(q=t.display,u=t.data,t=t.value);var f=$xml(t),r=f.firstChild,e=r?r.firstChild:null;e?(this._changeToAdvanced(q),this.conditions=t):(this._removeAllFilterRows(),this._changeToBasic(),this.conditions=null)},_toSourceValue:function(n){var t="<SourceValue>";return $.each(n,function(n,q){if(q.type==="value")t+='<Item SourceType="Value"><![CDATA['+q.data+"]\]><\/Item>";else{if(t+="<Item",q.data.SourceType)t+=' SourceType="'+q.data.SourceType+'"';else if(q.data.ItemType){var u=q.data.ItemType;u&&u.toLowerCase()==="methodreturnedproperty"&&(u="ObjectProperty");t+=' SourceType="'+u+'"'}if(q.data.DataType)t+=' DataType="'+q.data.DataType+'"';else if(q.data.SubType){var o="text";switch(q.data.SubType.toLowerCase()){case"autonumber":case"number":case"decimal":o="number";break;case"datetime":o="datetime";break;case"yesno":case"boolean":o="boolean";break;case"guid":case"autoguid":o="guid"}t+=' DataType="'+o+'"'}var f=null;u==="ViewParameter"||u==="FormParameter"?f=q.data.Name:q.data.SourceID?f=q.data.SourceID:q.data.Guid?f=q.data.Guid:q.data.Name&&(f=q.data.Name);checkExists(f)&&(t+=' SourceID="{0}"'.format(f.xmlEncode()));checkExists(q.data.Name)&&(t+=' SourceName="'+q.data.Name+'"');checkExists(q.data.DisplayName)&&(t+=' SourceDisplayName="'+q.data.DisplayName+'"');var e=null,r=null,s=null;checkExistsNotEmpty(q.data.SourceInstanceID)?e=q.data.SourceInstanceID:checkExistsNotEmpty(q.data.InstanceID)&&(e=q.data.InstanceID);checkExistsNotEmpty(q.data.SourceSubFormID)?r=q.data.SourceSubFormID:checkExistsNotEmpty(q.data.SubFormID)&&(r=q.data.SubFormID);checkExistsNotEmpty(q.data.SourceSubFormInstanceID)?s=q.data.SourceSubFormInstanceID:checkExistsNotEmpty(q.data.SubFormInstanceID)&&(s=q.data.SubFormInstanceID);checkExistsNotEmpty(r)&&checkExistsNotEmpty(e)?(t+=' SourceInstanceID="'+e+'"',t+=' SourceSubFormID="'+r+'"'):checkExistsNotEmpty(r)&&checkExistsNotEmpty(s)?(t+=' SourceInstanceID="'+s+'"',t+=' SourceSubFormID="'+r+'"'):checkExistsNotEmpty(r)?t+=' SourceSubFormID="'+r+'"':checkExistsNotEmpty(e)&&(t+=' SourceInstanceID="'+e+'"');(q.data.ItemType==="ControlProperty"||q.data.ItemType==="ControlField")&&(t+=' SourcePath="'+q.data.SourcePath+'"');checkExistsNotEmpty(q.data.ValidationStatus)&&(t+=' ValidationStatus="{0}"'.format(q.data.ValidationStatus),checkExistsNotEmpty(q.data.ValidationMessages)&&(t+=' ValidationMessages="{0}"'.format(q.data.ValidationMessages)));t+=">";q.data.DisplayName&&(t+=q.data.DisplayName.xmlEncode());t+="<\/Item>"}}),t+="<\/SourceValue>"},_fromSourceValue:function(n,t){var a=null,f=this;if($chk(n)){if(n.getAttribute("SourceType")==="Value")a={type:"value",data:n.firstChild.nodeValue,text:n.firstChild.nodeValue};else{var q={type:"context",data:{}},r=null,u=n.getAttribute("SourceType"),e=n.getAttribute("SourceID");if((u==="ViewParameter"||u==="FormParameter")&&(!checkExistsNotEmpty(e)||e.isValidGuid())&&(e=n.getAttribute("Name"),checkExistsNotEmpty(e)||(e=n.text)),r=t.targetContextCanvas("getDraggingNode",{id:e}),$.each(n.attributes,function(n,t){q.data[t.name]=t.value}),checkExistsNotEmpty(q.data.DisplayName)||(checkExistsNotEmpty(n.text)?q.data.DisplayName=n.text:f._isRuntime?(q.data.DisplayName=getNodeAttribute("SourceDisplayName",n,null,checkExistsNotEmpty),q.data.DisplayName===null&&(q.data.DisplayName=getNodeAttribute("SourceName",n,null,checkExistsNotEmpty)),q.data.DisplayName===null&&(q.data.DisplayName=Resources.ObjectNames.ItemSingular)):q.data.DisplayName=SourceCode.Forms.Designers.Common.getItemDisplayName(n)),q.text=q.data.DisplayName,!checkExists(r)&&(u==="ControlProperty"||u==="ControlField")){var h=n.getAttribute("InstanceID"),c=n.getAttribute("SubFormID"),b=n.getAttribute("SourceID"),y=n.getAttribute("SourcePath"),k=n.getAttribute("Guid");checkExists(h)&&h==="00000000-0000-0000-0000-000000000000"&&(h=null);checkExists(c)&&c==="00000000-0000-0000-0000-000000000000"&&(c=null);var o={id:y,SubFormID:c,InstanceID:h};checkExists(o.SubFormID)&&checkExists(o.InstanceID)&&(o.SubFormInstanceID=o.InstanceID,o.InstanceID=null);var s={id:k,SourceID:b,SourcePath:y,SubFormID:c,InstanceID:h};checkExists(s.SubFormID)&&checkExists(s.InstanceID)&&(s.SubFormInstanceID=s.InstanceID,s.InstanceID=null);r=t.targetContextCanvas("getPartialDraggingNode",o,s);checkExists(r)&&(q.text=r.text,q.data=r.data)}if(checkExists(r)){var p="",v=n.text;checkExists(r.icon)&&(p=r.icon);checkExists(r.display)&&(v=r.display);q.data.icon=p;q.text=v;q.data.DisplayName=v;q.data.SourceSubFormID=r.SubFormID;q.data.SourceSubFormInstanceID=r.SubFormInstanceID;q.data.SourceInstanceID=r.InstanceID}else f._isRuntime===!1?(q.data.icon="error",q.tooltip=Resources.ExpressionBuilder.UnresolvedObjectText.format(f.analyzerService.getReferenceType(u))):q=null;if(f._isRuntime===!1&&(n.getAttribute("Invalid")==="true"||SourceCode.Forms.DependencyHelper.hasValidationStatusError(n))){var w=n.getAttribute("ValidationStatus");q.status=SourceCode.Forms.DependencyHelper.getMainValidationStatus(w);var l=n.getAttribute("ValidationMessages");if(checkExists(l)){q.data.ValidationMessages=l;q.tooltip=f.analyzerService.getValidationMessages(l).join("\n");var d=f.analyzerService.parseValidationMessage(l)[0];q.data.icon=SourceCode.Forms.Designers.Common.getItemTypeIcon(u,d.subType)+" error"}else q.data.icon=SourceCode.Forms.Designers.Common.getItemTypeIcon(u,"")+" error";q.data.ValidationStatus=w}checkExists(q)&&(a=q)}return a}}};jQuery.extend(FilterWidget.prototype,FilterWidgetProtoType);function FilterConfigurationWidget(){}var FilterConfigurationWidgetProtoType={onWidgetCompleted:function(n){var q=n.display,r=n.value,u=n.data,t=n.parentWidget;t.previewContainer[0].innerHTML=q;t.conditions=$xml(r)}};jQuery.extend(FilterConfigurationWidget.prototype,ConfigurationWidget.prototype,FilterConfigurationWidgetProtoType);
/*!
 ~/Rules/Script/OrderWidget.js
*/
function OrderWidget(){}var OrderWidgetProtoType={initialize:function(n){if(this._parentElement=n,this.targetXml){this._transformXml();var t=this.targetXml.selectNodes("Items/Item[@ItemType='MethodReturnedProperty']");t.length>0?(this._populateToolbar(),this._buildUI()):this.wizard&&this.wizardStep&&this.wizard.wizard("hide","step",this.wizardStep)}},_transformXml:function(){var n=new XslTransform;n.importStylesheet(applicationRoot+"Rules/XSLT/FilterOrder.xslt");$chk(this.ResultName)&&n.addParameter("ResultName",this.ResultName);this.targetXml=parseXML(n.transformToText(this.targetXml))},_buildUI:function(){var n=this,t={url:applicationRoot+"Rules/Order.aspx",type:"GET",cache:!1,data:{},dataType:"text",async:!1,success:function(t,q,r){n._buildUIAjaxSuccess.call(n,t,q,r)}};jQuery.ajax(t)},_buildUIAjaxSuccess:function(n){var r=n;this._parentElement.append(r);this._parentElement.find(".pane-container").panecontainer();this._parentElement.find(".panel").panel();var u={rowselect:this._rowSelected.bind(this)};this._parentElement.find(".grid").grid().grid("option",u);this._populateDropDowns();var q=this.toolbar;q.toolbar();var t=q.toolbar("fetch","buttons");jQuery(t[0]).on("click",this._addOrderRow.bind(this));jQuery(t[1]).on("click",this._removeOrderRow.bind(this));jQuery(t[2]).on("click",this._removeAllOrderRows.bind(this));jQuery(t[3]).on("click",this._moveUp.bind(this));jQuery(t[4]).on("click",this._moveDown.bind(this));this.initCallBack()},updated:function(){this._parentElement.find(".grid").grid("syncWidths")},dispose:function(){},_populateToolbar:function(){if(this.toolbar=this._parentElement.closest(".wrapper.target-context-canvas").find(".toolbar"),this.toolbar.length===0){var n=jQuery('<div class="toolbars single"><\/div>');this.toolbar=jQuery(SourceCode.Forms.Controls.Toolbar.html());this.toolbar.toolbar();this.toolbar.toolbar("add","button",{id:"addButton_OrderWidget",icon:"add",text:Resources.CommonActions.AddText,description:Resources.Filtering.AddOrderText,disabled:!1});this.toolbar.toolbar("add","button",{id:"clearButton_OrderWidget",icon:"delete",text:Resources.CommonActions.RemoveText,description:Resources.Filtering.RemoveOrderText,disabled:!0});this.toolbar.toolbar("add","button",{id:"clearAllButton_OrderWidget",icon:"delete-all",text:Resources.CommonActions.RemoveAllText,description:Resources.Filtering.RemoveAllOrderText,disabled:!0});this.toolbar.toolbar("add","button",{id:"upButton_OrderWidget",icon:"move-up",text:Resources.CommonActions.MoveUpText,description:Resources.Filtering.MoveUpOrderText,disabled:!0});this.toolbar.toolbar("add","button",{id:"downButton_OrderWidget",icon:"move-down",text:Resources.CommonActions.MoveDownText,description:Resources.Filtering.MoveDownOrderText,disabled:!0});this.toolbar.find(".toolbar-button").each(function(){switch($(this).attr("id")){case"addButton_OrderWidget":$(this).find(".button-text").before('<svg width="16" height="16"><use xlink:href="#svg-icon-add" /><\/svg>');break;case"clearButton_OrderWidget":$(this).find(".button-text").before('<svg width="16" height="16"><use xlink:href="#svg-icon-delete" /><\/svg>');break;case"clearAllButton_OrderWidget":$(this).find(".button-text").before('<svg width="16" height="16"><use xlink:href="#svg-icon-delete-all" /><\/svg>');break;case"upButton_OrderWidget":$(this).find(".button-text").before('<svg width="16" height="16"><use xlink:href="#svg-icon-move-up" /><\/svg>');break;case"downButton_OrderWidget":$(this).find(".button-text").before('<svg width="16" height="16"><use xlink:href="#svg-icon-move-down" /><\/svg>')}$(this).addClass("style-aware")});n.append(this.toolbar);this._parentElement.closest(".pane-container").children(".pane:first-child").append(n)}this.toolbar.toolbar()},initCallBack:function(){},setConfigurationXml:function(n){if(n){var u=parseXML(n),r=u.selectSingleNode("/Mappings/Mapping/Sorters");if(r){for(var f=this._parentElement.find(".grid").grid(),e=r,t=e.childNodes,q=0;q<t.length;q++){var o=t[q].getAttribute("SourceID"),s=t[q].getAttribute("Direction");f.grid("add","edit-template",[o,s])}t.length>0&&$("#clearAllButton_OrderWidget").removeClass("disabled");(SourceCode.Forms.Browser.webkit||SourceCode.Forms.Browser.msie)&&setTimeout(function(){this._parentElement.find(".grid").grid("synccolumns");SourceCode.Forms.Browser.msie&&(this._parentElement.find(".grid").hide(),setTimeout(function(){this._parentElement.find(".grid").show()}.bind(this),0))}.bind(this),0)}}},getConfigurationXML:function(){for(var n="<Sorters>{0}<\/Sorters>",h=this._parentElement.find(".grid").grid(),u=h.grid("fetch","rows"),f=u.length,e="",t=0;t<f;t++){var q=$(u[t]),o=q.find(".input-control.sort-column option:selected"),c=q.find(".input-control.sort-column").val(),l=q.find(".input-control.sort-order").val();e+='<Sorter SourceType="{0}" SourceID="{1}" SourceName="{1}" SourceDisplayName="{3}" Direction="{2}" />'.format(o.data("SourceType"),c.xmlEncode(),l,o.data("DisplayName").xmlEncode())}if(f===0)n="";else if(n=n.format(e),checkExists(SourceCode)&&checkExists(SourceCode.Forms)&&checkExists(SourceCode.Forms.Designers)&&checkExists(SourceCode.Forms.Designers.Rule)&&checkExists(SourceCode.Forms.Designers.Rule.EventHelper)&&checkExists(SourceCode.Forms.Designers.Rule.EventHelper.checkIfControlFilterIsValid)){var s=parseXML(n),r=s.selectNodes("//Sorter[@SourceType='undefined' or @SourceID='null']").length===0;if(r===!0&&checkExists(this.Settings.viewControlID)&&(r=SourceCode.Forms.Designers.Rule.EventHelper.checkIfControlOrderIsValid(s.documentElement,this.Settings.viewControlID)),r===!1)return popupManager.showError(Resources.Filtering.InvalidOrder,Resources.Filtering.InvalidOrder),!1}return'<Mappings><Mapping Type="{0}" ActionPropertyCollection="Properties">{1}<\/Mapping><\/Mappings>'.format(this.ResultName,n)},_populateDropDowns:function(){var e=this.targetXml.selectNodes("Items/Item[@ItemType='MethodReturnedProperty']");if(e.length===0){this.wizard&&this.wizardStep&&this.wizard.wizard("hide","step",this.wizardStep);return}var n=this.targetXml.selectNodes("Items/Item[@ItemType='ViewField']");n.length===0&&(n=e);for(var f=$("#sortColumnDropDown"),t=0;t<n.length;t++){var o=n[t].getAttribute("Guid")?n[t].getAttribute("Guid"):n[t].selectSingleNode("Name").text,s=n[t].selectSingleNode("DisplayName").text,c=n[t].selectSingleNode("ToolTip").text,l=n[t].getAttribute("Icon"),q=$("<option><\/option>").val(o).html(s.htmlEncode()).addClass(l).attr("title",c);f.append(q);var u=n[t].getAttribute("ItemType");if(u)switch(u.toLowerCase()){case"methodreturnedproperty":u="ObjectProperty"}q.data("SourceType",u);q.data("DisplayName",s);q.data("SourceID",o);var r="text",h=n[t].getAttribute("SubType");if(h)switch(h.toLowerCase()){case"autonumber":case"number":case"decimal":r="number";break;case"datetime":r="datetime";break;case"yesno":case"boolean":r="boolean";break;case"guid":case"autoguid":r="guid"}q.data("DataType",r)}f.isWidget("dropdown")&&f.dropdown("refresh")},_addOrderRow:function(){var t=this._parentElement.find(".grid");t.grid("add","edit-template");$("#clearAllButton_OrderWidget").removeClass("disabled");var n=this._parentElement.find(".grid").grid("fetch","selected-rows");n.length>0&&this._rowSelected(n[0])},_rowSelected:function(n){$("#clearButton_OrderWidget").removeClass("disabled");$("#clearAllButton_OrderWidget").removeClass("disabled");$(n).prev("tr").length>0?$("#upButton_OrderWidget").removeClass("disabled"):$("#upButton_OrderWidget").addClass("disabled");$(n).next("tr").length>0?$("#downButton_OrderWidget").removeClass("disabled"):$("#downButton_OrderWidget").addClass("disabled")},_rowDeSelected:function(){$("#clearButton_OrderWidget").addClass("disabled");$("#upButton_OrderWidget").addClass("disabled");$("#downButton_OrderWidget").addClass("disabled")},_removeOrderRow:function(){this._parentElement.find(".grid").grid("remove","selected-rows");this._rowDeSelected()},_removeAllOrderRows:function(){this._parentElement.find(".grid").grid("clear");this._rowDeSelected();$("#clearAllButton_OrderWidget").addClass("disabled")},_moveUp:function(){var n=this._parentElement.find(".grid").grid("fetch","selected-rows"),t=n.prev();n.after(t);n.length>0&&this._rowSelected(n[0])},_moveDown:function(){var n=this._parentElement.find(".grid").grid("fetch","selected-rows"),t=n.next();n.before(t);n.length>0&&this._rowSelected(n[0])}};jQuery.extend(OrderWidget.prototype,OrderWidgetProtoType);
/*!
 ~/Rules/Script/RuntimeFilterOrderWidget.js
*/
function RuntimeFilterOrderWidget(){}var RuntimeFilterOrderWidgetProtoType={editFunction:"new",itemsLoaded:0,initialize:function(n){n||(n=$("body").append("<div><\/div>"));this.parentElement=n;this._buildUI(n)},setConfigurationXml:function(n){var u='<Mappings><Mapping Type="{0}">{1}<\/Mapping><\/Mappings>',t=parseXML(n);if(t){$("#FilterName").val(t.childNodes[0].getAttribute("name")).triggerHandler("focus");var q=t.selectSingleNode("FilterCriteria/Filter");q&&q.xml&&(this.filterXml=u.format("Filter",q.xml));var r=t.selectSingleNode("FilterCriteria/Sorters");r&&r.xml&&(this.orderXml=u.format("Order",r.xml))}},getFilterName:function(){return $("#FilterName").val()},getConfigurationXML:function(){this.filterConfigWidget.save();this.orderConfigWidget.save();var r=$("#FilterName").val(),t="",q="";if(this.filterXml){var n=this.filterXml.selectSingleNode("Mappings/Mapping/Filter");n&&n.xml&&(t=n.xml)}if(this.orderXml){var n=this.orderXml.selectSingleNode("Mappings/Mapping/Sorters");n&&n.xml&&(q=n.xml)}return'<FilterCriteria name="{0}">{1}{2}<\/FilterCriteria>'.format(r.htmlEncode(),t,q)},_buildUI:function(){var n={editFunction:this.editFunction},t={url:applicationRoot+"Rules/RuntimeFilterOrder.aspx",type:"GET",cache:!1,data:n,dataType:"text",async:!1,success:this._partialPageLoaded.bind(this)};jQuery.ajax(t)},_partialPageLoaded:function(n){var t=$(n);this.parentElement.replaceWith(t);this.parentElement=t;this.parentElement.showBusyModal(!0);this.parentElement.find(".pane-container").panecontainer();this.parentElement.find(".panel").panel();var q=this.parentElement.find("#FilterTabBox");this.Tabs=q.children("ul").children("li").find("a.tab");this.Tabs.on("click",this.TabClick.bind(this));jQuery("#FilterName").textbox().trigger("focus");this.initCallBack();this._createFilterTabContent();this._createOrderTabContent();this.parentElement.closest(".popup").attr("id","RuntimeFilterOrderWidgetDialog");this.parentElement.closest(".popup").addClass("id-filter-order-widget")},initCallBack:function(){},checkAllLoaded:function(){this.itemsLoaded!==0&&this.parentElement.showBusyModal(!1);this.itemsLoaded++},_createFilterTabContent:function(){var q=new RuntimeConfigurationWidget;q.value=this.filterXml;q.container=$("#FilterTab_Content");q.ContextHeading=Resources.Filtering.FilterWidgetContextHeading;q.TargetHeading="Filter";var r={};r.includeFields="True";checkExists(runtimeFilterFields)&&(r.useRuntimeSearchableFields="True",r.runtimeFilterFields=runtimeFilterFields[this.viewId]);r.pluginName="ViewContextPlugIn";r.pluginMethod="initialize";r.viewID=this.viewId;r.isCurrent="False";q.Parameters=r;var u={},c={};c.includeAll="True";u.Parameters=c;u.PlugIn="SystemVariablesContextPlugIn";u.Method="initialize";var f=[];if(f.push(u),SourceCode.Forms.Settings.AllowEnvironmentFields===!0){var e={};e.PlugIn="EnvironmentFieldsContextPlugIn";e.Method="initialize";e.Parameters={};f.push(e)}var o={};o.PlugIn="ViewContextPlugIn";o.Method="initialize";var t={};t.viewID=this.viewId;t.isCurrent="False";t.includeFields="True";checkExists(runtimeFilterFields)&&(t.useRuntimeSearchableFields="True",t.runtimeFilterFields=runtimeFilterFields[this.viewId]);t.includeInputControls="True";t.includeControls="True";t.includeListingControls="True";t.includeDisplayControls="True";t.includeActionControls="True";t.includeExecutionControls="True";t.includeParameters="True";o.Parameters=t;f.push(o);var n={};n.viewID=this.viewId;n.pluginName="ViewContextPlugIn";n.pluginMethod="initialize";n.isCurrent="False";n.includeFields="True";checkExists(runtimeFilterFields)&&(n.useRuntimeSearchableFields="True",n.runtimeFilterFields=runtimeFilterFields[this.viewId]);n.includeMethods="True";n.includeViewMethods="True";n.includeObjectDetails="True";n.includeResultProperties="True";n.includeControls="True";n.includeControlTypeEvents="True";n.FilterTypes="MethodReturnedProperty|ViewField";n.HelpID="7048";var s={};s.Parameters=n;s.Widget="FilterWidget";s.Method="initialize";var h={};h.Contexts=f;h.Target=s;h.ResultName="Filter";q.Settings=[h];q.initialize();this.filterConfigWidget=q;this.filterConfigWidget.parentWidget=this;this.filterConfigWidget.initCallBack=this.checkAllLoaded.bind(this)},_createOrderTabContent:function(){var t=new RuntimeConfigurationWidget;t.value=this.orderXml;t.container=$("#OrderTab_Content");t.ContextHeading=Resources.Filtering.FilterWidgetContextHeading;t.TargetHeading="Order";var q={};q.includeFields="True";checkExists(runtimeFilterFields)&&(q.useRuntimeSearchableFields="True",q.runtimeFilterFields=runtimeFilterFields[this.viewId]);q.pluginName="ViewContextPlugIn";q.pluginMethod="initialize";q.viewID=this.viewId;q.isCurrent="False";t.Parameters=q;var n={};n.viewID=this.viewId;n.pluginName="ViewContextPlugIn";n.pluginMethod="initialize";n.isCurrent="False";n.includeFields="True";checkExists(runtimeFilterFields)&&(n.useRuntimeSearchableFields="True",n.runtimeFilterFields=runtimeFilterFields[this.viewId]);n.includeMethods="True";n.includeViewMethods="True";n.includeObjectDetails="True";n.includeResultProperties="True";n.includeControls="True";n.includeControlTypeEvents="True";n.FilterTypes="MethodReturnedProperty|ViewField";n.showContext="False";n.HelpID="7048";var r={};r.Parameters=n;r.Widget="OrderWidget";r.Method="initialize";var u={};u.Contexts=[];u.Target=r;u.ResultName="Order";t.Settings=[u];t.initialize();this.orderConfigWidget=t;this.orderConfigWidget.parentWidget=this;this.orderConfigWidget.initCallBack=this.checkAllLoaded.bind(this)},TabClick:function(){var q=typeof arguments[0]!="undefined"&&arguments[0]!==null?arguments[0]:null,n=jQuery(q.target).closest(".tab"),t=this.Tabs.filter(".selected");if(n[0]!==t[0]){var u=jQuery("#"+t[0].id+"_Content");u.hide();t.removeClass("selected");var r=jQuery("#"+n[0].id+"_Content");r.show();n.addClass("selected");r.find(".pane-container").panecontainer("destroy").panecontainer();this.orderConfigWidget.updated();this.filterConfigWidget.updated()}q.preventDefault()}};jQuery.extend(RuntimeFilterOrderWidget.prototype,RuntimeFilterOrderWidgetProtoType);function RuntimeConfigurationWidget(){}var RuntimeConfigurationWidgetPrototype={onWidgetCompleted:function(n){var r=n.display,t=n.value,u=n.data,q=n.parentWidget;n.Settings[0].Target.Widget==="FilterWidget"?q.filterXml=$xml(t):q.orderXml=$xml(t)},afterPluginInit:function(){ConfigurationWidget.prototype.afterPluginInit.apply(this,arguments);checkExists(this.initCallBack)&&this.initCallBack()}};jQuery.extend(RuntimeConfigurationWidget.prototype,ConfigurationWidget.prototype,RuntimeConfigurationWidgetPrototype);
/*!
 ~/Script/SourceCode.Forms.DropTextBox.js
*/
function DropTextBox(n){this.initialize(this.options=jQuery.extend({allowMultipleItems:!1,allowTextInput:!0,defaultMultipleDropDivider:",",dropObject:null,element:null,existingElement:null,id:"",onChangedDelegate:null,onEnterPressDelegate:null,onFocusDelegate:null,required:!1,targetId:"",text:"",textType:"Text",validateDelegate:null,watermarkText:""},n))}DropTextBox.prototype={$dropItem:null,$textBox:null,containsText:!1,dropObject:null,dropObjects:null,element:null,text:null,_addTextBoxEvents:function(n){var t=this;n.on({focus:function(){t._internalFocusText.apply(t,[!0])},change:function(){t.changeText.call(t)},keypress:function(){t.keyPressText.apply(t,arguments)},keydown:function(){t.keyDownText.apply(t,arguments)},blur:function(){t._internalBlurText.apply(t,[!0])}});SourceCode.Forms.Browser.msie&&n.focusout()},_build:function(){var t=this.options.existingElement;t?this.element=jQuery(t):this.element.empty().append(jQuery(SCTextbox.html({rows:4})));var n=this,r=this.element.on("dropDragElement",function(){n.dropEvent.apply(n,arguments)}).find(".input-control-wrapper").empty().on({click:function(t){t.target===this&&n.focusText()},keydown:function(n){switch(n.which){case 35:n.preventDefault();jQuery(this).find(".drop-object.drop-text").last().trigger("focus").caret("end");break;case 36:n.preventDefault();jQuery(this).find(".drop-object.drop-text").first().trigger("focus").caret("start")}}}),q=jQuery("<div><\/div>").addClass("drop-textbox").appendTo(r);if(this.$dropItem=jQuery("<span><\/span>").attr("id",String.generateGuid()).addClass("drop-item").css("display","inline-block").appendTo(q).on("click",this,this.dropItemClick),this._addTextBoxEvents(this.$dropText=jQuery(document.createElement("input")).addClass("drop-text").appendTo(q)),this._changeDisplay(),this.options.allowMultipleItems){var u=document.getElementById("multipleItemDropTextBox");u||jQuery(document.createElement("span")).attr("id","multipleItemDropTextBox").css({visibility:"hidden",position:"absolute",left:0,top:300}).prependTo(document.body)}},_getTextBoxNextValue:function(n,t){var f="",q=n.val();if(t!==null&&this.options.allowTextInput){f=String.fromCharCode(t);var r,u;r=n.caret().start;u=n.caret().end;r>u&&(u=n.caret().start,r=n.caret().end);t!==null&&t===8||t===46?q=r===u?t===46?q.substring(0,r)+q.substring(r+1,q.length):q.substring(0,r-1)+q.substring(r,q.length):q=q.substring(0,r)+q.substring(u,q.length-1):r===u?q+=f:q=q.substring(0,r)+f+q.substring(u,q.length)}return q},_calculateTextBoxValueWidth:function(n,t){var r=this._getTextBoxNextValue(n,t),q=jQuery("#multipleItemDropTextBox");q[0].innerHTML=r.htmlEncode().replace(stringRegularExpressions.spacesReplacementRegex,"&nbsp;");n.width(q.innerWidth()+5)},_calculateTextBoxWidth:function(n){n.css("width","0px");for(var u=this.element.find(".drop-textbox"),t=u.children(),f=0,q=t.length-2;q>=0;q--)t[q].style.display!=="none"&&(f+=jQuery(t[q]).outerWidth(!0));var r=u.innerWidth()-f-29;if(r>0)n[0].style.width=r+"px";else if(r>-4)n[0].style.width="1px";else{var e=jQuery(t[t.length-2]).outerWidth();n[0].style.width=e>15?e-22+"px":""}},_change:function(n,t,q){if(this.$dropItem.empty().hide(),this.$dropText.width("100%"),this.options.allowMultipleItems)if(!t)n?(this.dropObjects.push(n),this._changeDisplay(!0)):(this._setEmptyText(),this._changeDisplay());else{var v=this.element.find(".drop-object"),f=this.element.find(".watermark");!f.length||f.removeClass("watermark").val("");for(var r=-1,c=-1,o=0;o<v.length;o++){var s=jQuery(v[o]),u=s.offset(),e=jQuery("#multipleItemDropTextBox");e[0].innerHTML=s.val().replace(/ /g,"&nbsp;");var b=e.innerWidth()+5+u.left;if(!!q&&q.left<=b&&q.left>=u.left){var k=s.outerHeight(!0)+u.top+5;if(u.top=u.top-5,q.top>=u.top&&q.top<=k){if(r=o,$type(this.dropObjects[r])==="string"){var y=q.left-u.left,e=jQuery("#multipleItemDropTextBox"),p=s.val(),w=0;e[0].innerHTML="";for(var h=0;h<p.length;h++){e[0].innerHTML+=p.charAt(h).replace(" ","&nbsp;");var u=e.innerWidth();if(y>=w&&y<=u){c=h;break}else w=u}}break}}}if(r===-1)this.dropObjects.push(t),this._changeDisplay(!0);else{if($type(this.dropObjects[r])==="string"){var n=this.dropObjects[r],l=n.substr(0,c),a=n.substr(c);l&&a?r+1!==this.dropObjects.length?(this.dropObjects[r]=l,this.dropObjects=this.dropObjects.insert(a,r+1),this.dropObjects=this.dropObjects.insert(t,r+1)):(this.dropObjects[r]=l,this.dropObjects.push(t),this.dropObjects.push(a)):r===0?(this.dropObjects=this.dropObjects.insert(this.options.defaultMultipleDropDivider,r+1),this.dropObjects=this.dropObjects.insert(t,r+1)):(this.dropObjects=this.dropObjects.insert(this.options.defaultMultipleDropDivider,r),this.dropObjects=this.dropObjects.insert(t,r))}else this.dropObjects=this.dropObjects.insert(this.options.defaultMultipleDropDivider,r),this.dropObjects=this.dropObjects.insert(t,r);this._setEmptyText();this._changeDisplay()}}else{var f=this.element.find(".watermark");!t&&!n?this.clear():f&&f.length>0&&f.removeClass("watermark").val("");this._calculateTextBoxWidth(this.$dropText);this.dropObject=t;this.containsText=!!n;this.text=n;this._changeDisplay()}},_changeDisplay:function(n){if(this.isEnabled())if(this.element.show(),this.options.allowMultipleItems){var s=this.dropObjects.length;if(s){this.$dropText.hide();this.$dropItem.hide();for(var h=this.element.find(".drop-textbox"),q,u=0;u<s;u++){n&&(u=s-1);var t=this.dropObjects[u];if($type(t)==="string")q?q.val(q.val()+t):(q=jQuery(document.createElement("input")).addClass("drop-object drop-text").width(5).val(t).appendTo(h),this._addTextBoxEvents(q)),t!==""&&t!==" "&&this._calculateTextBoxValueWidth(q);else if($chk(t)&&$chk(t.display)&&$chk(t.value)){var r=this.element.find(".drop-object.drop-text").last();r.length>0&&(r.width(5),!r.prevAll(".drop-object.drop-text").length||r.val()!==""?r.val()!==""&&this._calculateTextBoxValueWidth(r):(r.val(this.options.defaultMultipleDropDivider),this._calculateTextBoxValueWidth(r),this.dropObjects[u-1]=this.options.defaultMultipleDropDivider));var f=jQuery("<span><\/span>").addClass("drop-object drop-item").css("display","inline-block").html(t.display.htmlEncode()).attr("title",t.tooltip?t.tooltip:"").appendTo(h).data("dropobject",t);!t.icon||f.attr("icon",t.icon).addClass(t.icon);f.on("click",this,this.dropItemClick);q=jQuery(document.createElement("input")).addClass("drop-object drop-text").width(5).appendTo(h);this._addTextBoxEvents(q)}u===s-1&&($type(t)!=="string"&&(n||s===2)&&(q.val(""),this.dropObjects.push(""),u++),this._calculateTextBoxWidth(q),n?q.parent().textbox():h.textbox())}}else this._setEmptyText();s!==1||typeof this.dropObjects[0]!="string"||this.dropObjects[0]||q.addClass("watermark").val(this.options.watermarkText)}else if(!this.containsText&&(this.dropObject||this.text)){this.$dropText.val("");var f=this.$dropItem,e=f.attr("icon");!e||f.removeAttr(e).removeClass(e);var o=this.dropObject;if(Array.isArray(this.dropObject)&&(o=this.dropObject[0]),!!o){var c=o.display;if(!!c&&!!o.value){var l=o.tooltip;f.attr("title",l?l:c).html(c.htmlEncode()).show();e=o.icon;!e||f.attr("icon",e).addClass(e);f.data("dropobject",o)}}this.element.width()<50?setTimeout(function(){this._calculateTextBoxWidth(this.getLastVisibleInput())}.bind(this),40):this._calculateTextBoxWidth(this.getLastVisibleInput());this.element.find(".watermark").each(function(){$(this).text()===""&&$(this).removeClass("watermark")})}else(typeof this.text=="undefined"||this.text===null||this.text==="")&&this._setEmptyText()},_setEmptyText:function(){if(this.options.allowMultipleItems){this.$dropText.hide();this.$dropItem.empty().hide();this.element.find(".drop-object").remove();var t=this.dropObjects.length;if(!t){var n=jQuery(document.createElement("input")).addClass("drop-object drop-text watermark").appendTo(this.element.find(".drop-textbox"));this._addTextBoxEvents(n);this.dropObjects.push("");this._calculateTextBoxWidth(n)}}else this.text?this.$dropText.removeClass("watermark").val(this.text):this.$dropText.addClass("watermark"),this.$dropText.prop("readonly",!1),this.$dropText.width("100%"),this.$dropItem.empty().hide();this.element.find("input.watermark").val(this.options.watermarkText)},blurText:function(){var n=jQuery("");n=this.options.allowMultipleItems?this.element.find("input.drop-object.drop-text").last():this.$dropText;n.trigger("blur")},_internalBlurText:function(){if(this.containsText&&this.$dropText.val()==="")this.$dropText.addClass("watermark").val(this.options.watermarkText),this.dropObjects.length!==1||typeof this.dropObjects[0]!="string"||this.dropObjects[0]||this.element.find(".drop-object.drop-text").last().addClass("watermark").val(this.options.watermarkText);else if(!this.containsText&&this.dropObjects.length===0&&!this.dropObject){var n=this.element.find(".drop-object.drop-text").first();n.length===0&&(n=this.$dropText);n.addClass("watermark");n.val(this.options.watermarkText);n.width("100%")}this.element.find(".input-control").removeClass("active")},changeText:function(){var n=this.options,r=n.validateDelegate;if(!r||r(this.$dropText.val())){var q=this.$dropText;if(n.allowMultipleItems){for(var u=this.element.find(".drop-object"),t=u.length-1;t>=0;t--){var f=u.eq(t);f.is(".drop-text")&&(this.dropObjects[t]=f.val())}this._change()}else if(!q.is(".watermark")){var e=this.text=q.val();this.containsText||this._change(e)}if((this.text||this.dropObject||this.dropObjects.length>0)&&q.removeClass("watermark"),!!n.onChangedDelegate)n.onChangedDelegate(this)}},getLastVisibleInput:function(){return this.element.find("input").filter(function(){return jQuery(this).css("display")!=="none"}).last()},clear:function(){this.dropObjects.length=0;this.dropObject=null;this.text=null;this.dropObjects=[];this.$dropText.get(0).readOnly=!1;this._setEmptyText()},disable:function(){this.$dropText.addClass("watermark").prop("readonly",!0);this.$dropText.siblings("input").prop("readonly",!0);this.$dropText.first().closest(".input-control.text-input").addClass("disabled")},dropEvent:function(n,t,q){if(!this.$dropText.get(0).readOnly){if(!($chk(t)&&$chk(t.display)&&$chk(t.value))){var r=[];r[0]="OK:ClosePopup";r[1]="Close:ClosePopup";var u=$.popupManager.showError({headerText:"Runtime Error",message:"The object dropped onto the DropTextBox is not supported",type:"error",buttonArray:r})}if((!this.options.validateDelegate||this.options.validateDelegate(t))&&(this._change(null,t,q),!!this.options.onChangedDelegate))this.options.onChangedDelegate(this)}},dropItemClick:function(n){var t=jQuery(n.target);n.clientX<t.offset().left+Math.floor(t.outerWidth()/2)?t.prev().trigger("focus").caret("end"):t.next().trigger("focus").caret("start")},enable:function(){this.$dropText.prop("readonly",!1);this.$dropText.siblings("input").prop("readonly",!1);this.$dropText.first().closest(".input-control.text-input").removeClass("disabled")},_internalFocusText:function(){if(!this.$dropText.get(0).readOnly&&this.options.allowTextInput&&((!this.containsText||this.text)&&(this.options.allowMultipleItems||this.text||this.dropObject)||this.$dropText.removeClass("watermark").val(""),this.dropObjects.length>0)){var n=this.element.find(".watermark");n.length>0&&n.removeClass("watermark").val("")}if(this.element.find(".input-control").addClass("active"),!!this.options.onFocusDelegate)this.options.onFocusDelegate(this)},focusText:function(){var n=jQuery("");n=this.options.allowMultipleItems?this.element.find("input.drop-object.drop-text").last():this.$dropText;checkExists(SourceCode.Forms.Browser.msie)&&SourceCode.Forms.Browser.version===9&&(n[0].style.width="1px");n.trigger("focus").caret("end");checkExists(SourceCode.Forms.Browser.msie)&&SourceCode.Forms.Browser.version===9&&this._calculateTextBoxWidth(n)},hide:function(){this.element.hide()},initialize:function(n){this.element=$chk(n.element)?jQuery(n.element):null;this.id=n.id;this.dropObject=n.dropObject;this.text=n.text;this.targetId=n.targetId;this.multipleValues=!1;this.dropObjects=[];n.allowMultipleItems?(this.multipleValues=!0,this.containsText=!0,this.text=null,this.dropObject=null):this.dropObject?(this.containsText=!1,this.text=null):(this.containsText=!0,this.dropObject=null);this._build()},isEnabled:function(){return!this.$dropText.get(0).readOnly},keyPressText:function(n){var t=jQuery(n.target),u=n.which,q=u===0,f=!!t.nextAll(".drop-object.drop-text").length;if(this.containsText||this.options.allowMultipleItems||this.text||!this.options.allowTextInput||(this.$dropText.width("100%"),this.$dropItem.empty().hide()),f&&!q)this._calculateTextBoxValueWidth(t,n.which);else if(!q&&this.dropObjects.length>0){var e=this.element.find(".drop-object"),o=e.index(t);this.dropObjects[o]=this._getTextBoxNextValue(t,n.which)}var r=this.element.find(".drop-object.drop-text").last();r.length>0&&this._calculateTextBoxWidth(r)},keyDownText:function(n){var u=n.which,c=u===8,l=u===46,w=u===37,b=u===39,k=u===13,f=!1,e=!1;if(!this.containsText&&(c||l)&&(this._change(),!!this.options.onChangedDelegate))this.options.onChangedDelegate(this);if(k&&(this.changeText(n),!!this.options.onEnterPressDelegate))this.options.onEnterPressDelegate(this);if(this.options.allowMultipleItems){var q=jQuery(n.target),a=!!q.prevAll(".drop-object.drop-text").length;e=!!q.nextAll(".drop-object.drop-text").length;var v=q.caret().start===0,y=q.caret().start===q[0].value.length,o=q.caret().start!==q.caret().end;if(a&&c&&v&&!o){var r=this.element.find(".drop-object"),t=r.index(q)-1;this.dropObjects=this.dropObjects.removeAt(t+1);this.dropObjects=this.dropObjects.removeAt(t);var s=q.val();this.dropObjects[t-1]=this.dropObjects[t-1]+s;q.remove();r.eq(t).remove();r[t-1].value+=s;r.eq(t-1).trigger("focus").caret("end");this._calculateTextBoxValueWidth(jQuery(r[t-1]));f=!0;this.changeText()}else if(e&&l&&y&&!o){var r=this.element.find(".drop-object"),t=r.index(q)+1;this.dropObjects=this.dropObjects.removeAt(t);this.dropObjects=this.dropObjects.removeAt(t-1);var s=q.val();this.dropObjects[t-1]=s+this.dropObjects[t-1];var h=r[t+1];q.remove();jQuery(r[t]).remove();h.value=s+h.value;h.focus();this._calculateTextBoxValueWidth(jQuery(h));f=!0;this.changeText()}else if(a&&w&&v&&!o){var r=this.element.find(".drop-object"),t=r.index(q)-2;t>-1&&r.eq(t).trigger("focus").caret("end");f=!0}else if(e&&b&&y&&!o){var r=this.element.find(".drop-object"),t=r.index(q)+2;t<r.length&&r[t].focus();f=!0}}if(f)n.preventDefault();else if(e&&(l||c)){this._calculateTextBoxValueWidth(q,n.which);var r=this.element.find(".drop-object"),t=r.index(q);this.dropObjects[t]=this._getTextBoxNextValue(q,n.which)}var p=this.element.find(".drop-object.drop-text").last();p.length>0&&this._calculateTextBoxWidth(p);this.options.allowTextInput||n.preventDefault()},reset:function(){this.clear();this.blurText()},setTextType:function(n){this.options.textType=n},setValue:function(n){if(this.options.allowMultipleItems){if(this.containsText=!0,this.text=null,this.dropObject=null,n instanceof Array){for(var t=[],r=0;r<n.length;r++){var q=n[r],u=t.length,f=q instanceof Object,e=!u,h=r===n.length-1,o=t[u-1]instanceof Object,c=!f&&!e&&!o,l=f&&(o||e),a=f&&h;c?t[--u]=t[u].concat(q):l?(t.push(""),t.push(q)):a?(t.push(q),t.push("")):t.push(q)}this.dropObjects=t}else if(!!n){var s=this.dropObjects[this.dropObjects.length-1];$type(n)==="string"&&$type(s)==="string"?this.dropObjects[this.dropObjects.length-1]=s+n:this.dropObjects.push(n)}}else $type(n)==="string"?(this.text=n,this.dropObject=null,this.containsText=!0):n.allowUserEdit?(this.text=n.display,this.dropObject=n,this.containsText=!0):(this.text=null,this.dropObject=n,this.containsText=!1);this.options.allowTextInput||(this.element.find(".drop-object.drop-text.watermark").hide(),this.$dropText.show(),this._calculateTextBoxWidth(this.$dropText));this._setEmptyText();this._changeDisplay()},show:function(){this.element.show()}};function DroppedObject(n){jQuery.extend(this,{display:null,value:null,allowUserEdit:!1},n)};
/*!
 ~/Script/jquery.Forms.controls.twisty.js
*/
(function(n){(typeof SourceCode=="undefined"||SourceCode===null)&&(SourceCode={});(typeof SourceCode.Forms=="undefined"||SourceCode.Forms===null)&&(SourceCode.Forms={});(typeof SourceCode.Forms.Controls=="undefined"||SourceCode.Forms.Controls===null)&&(SourceCode.Forms.Controls={});SourceCode.Forms.Controls.Twisty={options:{subType:"STRING",items:"",setFunction:null,getDropItemsFunction:null,getSpinOptionsFunction:null,mappable:!0,radioGroup:[{disabled:!1,id:"twistyPropertyTrue",checked:!0,label:Resources.CommonLabels.YesLabelText},{disabled:!1,id:"twistyPropertyFalse",label:Resources.CommonLabels.NoLabelText}],radioLabel:"",defaultValues:["true","false","0","1","yes","no"],controlID:"",validationPattern:"",validationMessage:"",accept:".ui-draggable",readOnly:!1,readOnlyValue:"",readOnlyType:"no-icon",initializeServerControl:"",serverControl:"",isCurrent:!0,subformID:"",instanceID:"",hasIcon:!1,subformType:"",dropOptions:{drop:jQuery.noop(),focus:jQuery.noop(),keypress:jQuery.noop()}},_create:function(){this.mappingControl=null;this.control=null;this.element.addClass("twisty map");var t=this;if(this.options.subType=this.options.subType.toUpperCase(),this.options.mappable&&this._isToggleType()){this.element.append("<div class='input-control-buttons twisty-button'><span class='button-image'><\/span><\/div>");this.element.find(".twisty-button").on("click",function(n){t._toggleControl(n)})}else this.element.removeClass("twisty").addClass("without-twisty");this.options.readOnly&&(this.options.subType="READONLY");this._createMappableControl(n("<div class='mapping-control'><\/div>"),this.options.subType,this.options.mappable);this.mappingControl=this.element.find(".mapping-control");this.mappingControl.tokenbox({droppableEnabled:this.options.mappable,accept:this.options.accept,drop:this.options.dropOptions.drop,watermark:Resources.CommonPhrases.TokenboxWatermarkText,focus:this._controlFocus.bind(this),keypress:this.options.dropOptions.keypress,change:this._controlChange.bind(this)});this.mappingControl.siblings(".token-input").on("focusout",function(){t._dropBlur()});this._isToggleType()||(this.element.removeClass("map").addClass("drop"),this.options.mappable||this.mappingControl.tokenbox("disable"));this.options.mappable&&this.element.find(".mapping-control").droppable({tolerance:"pointer",drop:t._toggleDropControl.bind(t)})},_controlChange:function(){this._trigger("change")},_controlFocus:function(n){this._trigger("focus");typeof this.options.dropOptions.focus=="function"&&(checkExists(n.originalEvent)||(n.originalEvent=n),this.options.dropOptions.focus.apply(this,arguments))},_isToggleType:function(){return this.options.subType==="YESNO"||this.options.subType==="BOOLEAN"||this.options.subType==="BOOL"||this.options.subType==="COMPLEX"&&this.options.radioLabel!=="ControlExpression"||this.options.subType==="DROP"||this.options.subType==="READONLY"||this.options.subType==="SPIN"},setComplexPropertyValue:function(n,t){checkExists(n)&&n[1]!==null&&n[1][1].display!==""?(this._setIcons(n[1][1].icon),t.find("input").val(n[1][1].display),t.find("a").trigger("change"),this.options.complexValue=n[1][0].value):(this._setIcons(null),t.find("input").val(Resources.CommonLabels.NoneLabelText),this.options.complexValue="")},_setIcons:function(n){checkExists(this.control)&&(this.control.removeClass("icon-control"),checkExistsNotEmpty(this._iconsToReset)&&this.control.removeClass(this._iconsToReset),checkExistsNotEmpty(n)&&this.control.addClass("icon-control").addClass(n),this._iconsToReset=n)},_getDropOptions:function(){var n={},t=null;if(checkExistsNotEmpty(this.options.getDropItemsFunction)){try{t=evalFunction(this.options.getDropItemsFunction)}catch(r){t=null}typeof t=="function"&&(n=t())}else if(checkExists(this.options.items)){var q=this.options.items.split("+");n.displays=q[0].split("|");n.values=n.displays.length>0?q[1].split("|"):n.displays}return n},_createMappableControl:function(t,q,r){switch(q){case"BOOL":case"BOOLEAN":case"YESNO":var f=SCRadiobuttonGroup.html({collapsed:!1,id:"twistyPropertyRadioGroup_"+this.options.radioLabel});t.append(f);var h=t.find(".input-control-group.radio").addClass("twisty-radio-group");h.radiobuttongroup({change:this._controlChange.bind(this),focus:this._controlFocus.bind(this)});for(var f,c=0,d=this.options.radioGroup.length;c<d;c++)f=this.options.radioGroup[c],f.disabled=!r,f.id=f.id+"_"+this.options.radioLabel,f.name=this.options.radioLabel,h.radiobuttongroup("add",f);this.element.append(t);this.control=h;break;case"DROP":var g=this._getDropOptions(),e=this._buildDropOptions(g,t);t.append(n(e));this.element.append(t);e=this.element.find("select");e.toggleClass("icon-control",this.options.hasIcon);e.dropdown({allowEmptyFirstItem:!0});r||e.dropdown("disable");this.control=e;break;case"SPIN":var y={};r&&(y.inputsLength=1);var o=jQuery(SCSpinner.html(y));t.append(o);this.element.append(t);this.control=o;var p=o.find(".spinner-text-input"),s=this.options.getSpinOptionsFunction,l;if(checkExistsNotEmpty(s)){var w=s.contains(".")?evalFunction(s):this[s];if(checkExistsNotEmpty(w)){var a=w();checkExistsNotEmpty(a.eventsHandler)&&(l=a.eventsHandler);o.spinner(a)}else{console.error("function not found: "+s);return}}else{console.error("attribute GetSpinOptionsFunction not set");return}checkExistsNotEmpty(l)&&evalFunction(l)("scp",p,this.options.controlID);r||o.spinner("disable");p.trigger("blur");break;case"COMPLEX":var nt=SCLookupBox.html({disabled:!r});t.append(nt);t.find(".lookup-box").lookupbox({});t.find("input.input-control[type='text']").val(Resources.CommonLabels.NoneLabelText);t.find("input.input-control[type='text']").prop("readonly",!0);this.element.append(t);this.control=this.element.find(".lookup-box");var u=this.options.setFunction,v=this.options.initializeServerControl,tt=this.options.serverControl,qt=this.options.controlID,rt=this.options.isCurrent?"True":"False",ut=this.options.subformID,ft=this.options.subformType,et=this.options.contextType,ot=this.options.contextID,st=this.options.targetXml,b=this;if(checkExists(u)&&u!==""){var k=u.lastIndexOf(".");u=u.substr(k+1,u.length-k)}if(r)if(this.control.find("a").off("click"),checkExists(u)&&u!=="")this.control.find("a").on("click",function(n){var t=SourceCode.Forms.Designers.Common.Context[u];t(n,b,qt,rt,ut,ft,et,ot,st)});else if(checkExists(v)&&v!==""){this.control.find("a").attr("initializeServerControl",v);this.control.find("a").attr("serverControl",tt);this.control.find("a").on("click",{context:b},SourceCode.Forms.Designers.Common.Context._showInternalComplexPropertyPopup)}break;case"READONLY":var ht=n("<div class='readonly-property "+this.options.readOnlyType+"'>"+this.options.readOnlyValue+"<\/div>");t.append(ht);this.element.append(t);this.control=this.element.find("div.readonly-property");break;default:var ct=r?Resources.CommonPhrases.TextboxWatermarkText:"",lt=SCTextbox.html({disabled:!r,watermark:ct});t.append(lt);t.find(".text-input").textbox({});this.element.append(t);this.control=this.element.find(".text-input")}},_toggleControl:function(n){this._clearControls();this.element.is(".drop")?(this.element.removeClass("drop").addClass("map"),this.element.find(".button-image").removeClass("drop").addClass("map")):(this.element.removeClass("map").addClass("drop"),this.element.find(".button-image").removeClass("map").addClass("drop"));this._trigger("toggle",n,{control:this.control,twisty:this.element})},_toggleDropControl:function(n,t){var q=this.element.find(".mapping-control"),r=this.element.hasClass("drop");r||(this.element.removeClass("map").addClass("drop"),this.element.find(".button-image").removeClass("map").addClass("drop"),q.tokenbox("value",this._buildTokenboxValue(t.draggable.parent().metadata())),this._trigger("toggle",n,{control:this.control,twisty:this.element}));this.mappingControl.tokenbox("focus")},_buildDropOptions:function(t,q){q.append("<select class='input-control select-box'><\/select>");var u=q.find("select");if(checkExists(t)&&checkExists(t.displays)&&t.displays.length>0)for(var f="<option class='{2}' value='{0}'>{1}<\/option>",e=checkExists(t.iconClasses)&&t.iconClasses.length>=t.displays.length,r=0,o=t.displays.length;r<o;r++)e?u.append(n(f.format(t.values[r],t.displays[r],t.iconClasses[r]))):u.append(n(f.format(t.values[r],t.displays[r],t.values[r])));return u},_dropBlur:function(){var n=this.mappingControl.tokenbox("value");if(n.length===1&&n[0].type!=="context"&&checkExists(this.options.validationPattern)&&this.options.validationPattern!=="")validationFailedMsg=n[0].data.test(this.options.validationPattern),validationFailedMsg=validationFailedMsg?"":Resources.ControlProperties[this.options.validationMessage],validationFailedMsg!==""&&(popupManager.showError(validationFailedMsg),this.mappingControl.tokenbox("clear").tokenbox("focus"));else if(n.length===1&&n[0].type!=="context"&&(this.options.subType==="BOOL"||this.options.subType==="BOOLEAN"||this.options.subType==="YESNO")&&checkExists(this.options.defaultValues)&&!this.options.defaultValues.contains(n[0].data.toLowerCase())){var t=this.options.defaultValues.pop(),q=this.options.defaultValues.join(", ")+" or "+t;validationFailedMsg=Resources.ControlProperties.InvalidBoolValue.format(q);popupManager.showError(validationFailedMsg);this.mappingControl.tokenbox("clear").tokenbox("focus");this.options.defaultValues.push(t)}},_buildTokenboxValue:function(n){var t={},q=[];return t.type="context",t.text=n.DisplayName,t.data=n,q.push(t),q},clear:function(){this._clearControls()},reset:function(){this._isToggleType()&&this.element.removeClass("drop").addClass("map");this._clearControls()},_clearControls:function(){this.mappingControl.tokenbox("clear").tokenbox("blur");switch(this.options.subType){case"BOOL":case"BOOLEAN":case"YESNO":this.element.find(".input-control-group.radio").radiobuttongroup("clear");break;case"DROP":this.element.find("select").dropdown("SelectedIndex",0);this.element.find("select").dropdown("refreshDisplay");break;case"SPIN":this.control.spinner("reset");break;case"COMPLEX":this.setComplexPropertyValue(null,this.control)}},_getValue:function(){switch(this.options.subType){case"BOOL":case"BOOLEAN":case"YESNO":var n=this.control.radiobuttongroup("value"),n=n===Resources.CommonLabels.YesLabelText?"true":n===Resources.CommonLabels.NoLabelText?"false":n;return n;case"DROP":return this.control.dropdown("SelectedValue");case"SPIN":return this.control.spinner("value")[0];case"COMPLEX":return checkExists(this.options.complexValue)?this.options.complexValue:"";default:return this.mappingControl.tokenbox("value")}},_setValue:function(n){if(n.length===1&&(n[0].type==="value"||n[0].selectionType==="complex")){var t=this._determineControlForValue(n[0].data);switch(t.type){case"bool":case"boolean":var q=n[0].data.toLowerCase();if(t.defaultValue){var r=q==="true"||q==="1"||q==="yes";this.control.radiobuttongroup("value",r?Resources.CommonLabels.YesLabelText:Resources.CommonLabels.NoLabelText)}else checkExists(t.value)?this.control.radiobuttongroup("value",t.value):(this.element.is(".map")&&this.element.removeClass("map").addClass("drop"),this.mappingControl.tokenbox("value",n));break;case"drop":this.control.dropdown("SelectedValue",t.value);this.control.dropdown("refresh");break;case"spin":this.control.spinner("value",[t.value]);break;case"complex":this.setComplexPropertyValue(t.data,this.control);break;default:this.element.is(".map")&&this.element.removeClass("map").addClass("drop");this.mappingControl.tokenbox("value",n)}}else this.element.is(".map")&&this.element.removeClass("map").addClass("drop"),this.mappingControl.tokenbox("value",n)},_determineControlForValue:function(n){var t={};t.type=this.options.subType;t.defaultValue=!1;t.value="";switch(this.options.subType){case"BOOL":case"BOOLEAN":case"YESNO":n=n.toLowerCase();for(var q=0,f=this.options.defaultValues.length;q<f;q++)if(n===this.options.defaultValues[q]){t.defaultValue=!0;t.type="bool";break}if(!t.defaultValue)for(var q=0,f=this.options.radioGroup.length;q<f;q++)if(n===this.options.radioGroup[q].label.toLowerCase()){t.type="bool";t.value=this.options.radioGroup[q].label;break}break;case"COMPLEX":if(typeof n=="string"&&this.options.mappable&&this._isToggleType())t.type="string";else{var r=["",[{display:"",value:""},{display:"",icon:""}]];r[1][1].icon=n.icon;n.ItemType==="Expression"?(r[1][1].display=checkExistsNotEmpty(n.DisplayName)?n.DisplayName:n.text,r[1][0].display=checkExistsNotEmpty(n.DisplayName)?n.DisplayName:n.text,r[1][0].value=n):(r[1][1].display=n.display,r[1][0].display=n.value,r[1][0].value=n.value);t={type:"complex",data:r}}break;case"DROP":var u=this._getDropOptions(),o=n.toUpperCase();if(checkExists(u)&&checkExists(u.displays)&&u.displays.length>0)for(var q=0,f=u.values.length;q<f;q++){var e=u.values[q];if(o===e.toUpperCase()){t.type="drop";t.value=e;break}}break;case"SPIN":checkExists(n.toString())&&!this.control.spinner("validateValue",[n.toString()]).failedValidation?(t.type="spin",t.value=[n.toString()]):t.type="string"}return t},control:function(){return this.element.is(".map")?this.control:this.mappingControl},_getBoolValue:function(n){if(n.length===1&&n[0].type==="value"){var t=["true","1","yes"].contains(n[0].data.toLowerCase()).toString();n[0].data=t;n[0].text=t}return n},value:function(n){if(checkExists(n))this._setValue(n);else{var t={},q=[];return this.element.is(".map")?(t.value=this._getValue(),t.type=t.value.ItemType==="Expression"?"context":"value",t.data=t.value,q.push(t)):q=this.options.subType!=="BOOL"&&this.options.subType!=="BOOLEAN"&&this.options.subType!=="YESNO"?this.mappingControl.tokenbox("value"):this._getBoolValue(this.mappingControl.tokenbox("value")),q}}};typeof SCTwisty=="undefined"&&(SCTwisty=SourceCode.Forms.Controls.Twisty);n.widget("ui.twisty",SourceCode.Forms.Controls.Twisty);n.extend(n.ui.twisty,{getter:"value",setter:"value"})})(jQuery);
